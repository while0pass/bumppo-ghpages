!function(e,t,n){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n;!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===n&&i.firstChild?i.insertBefore(a,i.firstChild):i.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}('.bmpp-uiLayout{height:100vh}.bmpp-main,.bmpp-uiLayout{display:-webkit-box;display:-ms-flexbox;display:flex;width:100vw}.bmpp-main{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;overflow-y:scroll;padding-bottom:3em}.bmpp-mainWait{position:fixed;top:0;right:0;width:86vw;height:100vh;z-index:1001;border-left:.3em solid transparent!important}.bmpp-mainWait div{position:absolute!important;top:0!important;bottom:0!important;left:0!important;right:0!important}.bmpp-sidePane{-webkit-box-ordinal-group:1;-ms-flex-order:0;order:0;width:14vw;min-width:208px;min-width:13rem;border-left:1px solid rgba(34,36,38,.15);border-right:1px solid rgba(34,36,38,.15);overflow-y:hidden}.bmpp-sidePane_menuItem{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding:1em 1.5em!important;border-bottom:1px solid rgba(34,36,38,.15);border-right:.3em solid transparent!important;cursor:pointer}.bmpp-sidePane_menuItem.disabled{cursor:auto}.bmpp-sidePane_menuItem--current{border-right:.3em solid rgba(34,36,38,.25)!important;background-color:hsla(0,0%,98%,.75)!important}.bmpp-sidePane_menuItem--hover,.bmpp-sidePane_menuItem--hover.bmpp-sidePane_menuItem--current{border-right:.3em solid #767676!important;background-color:hsla(0,0%,98%,.75)!important}.bmpp-sidePane_menuItem--hover.bmpp-sidePane_menuItem--current.disabled,.bmpp-sidePane_menuItem--hover.disabled{border-right:.3em solid transparent!important;background-color:transparent!important}.bmpp-sidePane_menuItem .icon{position:absolute;right:1em}.bmpp-sidePane_menuItem .label{position:absolute;right:2em;font-size:.7em;color:grey}.bmpp-sidePane_menuItem .label.currentResults{color:green;font-weight:700}.bmpp-sidePane_searchButton{margin-left:.3em!important}.bmpp-paddedPane{width:55em;margin:3em auto auto 6em!important}.bmpp-propertiesPane{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch}.bmpp-propertiesPaneProps{height:calc(100vh - 3.2em);overflow-y:scroll;overflow-x:hidden}.bmpp-propertiesPaneDivider{height:1em;border-bottom:1px solid rgba(34,36,38,.05)}.bmpp-propertiesPaneButtons{height:2.2em;padding:1em 0 0 6em}.bmpp-resultsOptionsPane{width:55em;margin:3em auto auto 6em!important}.bmpp-nearLabelIcon{margin:0;padding:0;position:absolute;right:.2em;top:.8em}.bmpp-resultsPane{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch}.bmpp-resultsPane,.bmpp-resultsPane_video{display:-webkit-box;display:-ms-flexbox;display:flex}.bmpp-resultsPane_video{border-bottom:1px solid rgba(34,36,38,.15);background-color:#fff;height:193px!important;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;overflow:hidden}.bmpp-resultsPane_results{overflow-y:scroll}#bmpp-videoPlayer{-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;position:relative;width:342px;height:192px}.bmpp-videoCurtain{position:absolute;top:-1em;bottom:-1em;left:0;right:0;background-color:#000;background:radial-gradient(ellipse at top right,#007800 0,#002400 100%);z-index:1001}.bmpp-videoLoader{z-index:10001;visibility:visible;position:absolute;top:50%;left:50%;margin:-1.5em 0 0 -1.5em;width:3em;height:3em;-webkit-animation:segment-spin .6s linear;animation:segment-spin .6s linear;-webkit-animation-name:segment-spin;animation-name:segment-spin;-webkit-animation-duration:.6s;animation-duration:.6s;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-delay:0s;animation-delay:0s;-webkit-animation-iteration-count:infinite;-webkit-animation-direction:normal;animation-direction:normal;-webkit-animation-fill-mode:none;animation-fill-mode:none;-webkit-animation-play-state:running;animation-play-state:running;animation-iteration-count:infinite;border-radius:100rem;border-color:#fc0 #808 #080 rgba(0,136,0,.8);border-style:solid;border-width:.25em}.bmpp-resultsInfo{max-width:40em;padding:.7em 1em;font-size:smaller;position:relative}.bmpp-resultsInfo:after{display:block;content:"";width:100%;height:2em;position:absolute;bottom:0;background:-webkit-gradient(linear,left bottom,left top,from(#fff),color-stop(40%,#fff),to(hsla(0,0%,100%,0)));background:linear-gradient(0deg,#fff 0,#fff 40%,hsla(0,0%,100%,0))}.bmpp-videoChoices{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column nowrap;border-right:1px solid rgba(34,36,38,.15)}.bmpp-videoChoices,.bmpp-videoChoices div{display:-webkit-box;display:-ms-flexbox;display:flex}.bmpp-videoChoices div{border-bottom:1px solid rgba(34,36,38,.15);-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto;font-size:x-small;padding:0 .66em 0 1em;white-space:nowrap;-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;letter-spacing:.01em}.bmpp-videoChoices div:last-of-type{border-bottom:none}.bmpp-videoChoices div.disabled{color:rgba(34,36,38,.15);cursor:auto}.bmpp-videoChoices div:not(.disabled):not(.current):hover{background-color:rgba(34,36,38,.15)}.bmpp-videoChoices div.current{background-color:green;border-bottom-color:green;color:#fff;font-weight:700;letter-spacing:.05em}.bmpp-queryPane{display:-webkit-box;display:-ms-flexbox;display:flex;overflow:hidden}.bmpp-query,.bmpp-queryPane{-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto}.bmpp-query{max-width:70em;padding:3em 7em 0 0;-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}.bmpp-queryTree{-webkit-box-ordinal-group:1;-ms-flex-order:0;order:0;width:9em;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto}.bmpp-queryElement{min-height:10em}.bmpp-queryTreeHandles{position:absolute;right:auto;left:100%;top:.45em;width:6em;padding-left:1em}.bmpp-queryTreeHandles .ui.icon{cursor:pointer}.bmpp-queryTreeHandles.bmpp-queryTreeHandles2{left:calc(100% + 1em)}.bmpp-number{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row nowrap;flex-flow:row nowrap;-webkit-box-align:baseline;-ms-flex-align:baseline;align-items:baseline}.bmpp-number,.bmpp-number label{margin-right:1em}.bmpp-number .bmpp-numberControls{display:none}.bmpp-number:hover .bmpp-numberControls{display:block;width:40px;width:2.5rem;height:40px;height:2.5rem;right:0;top:.1em;position:absolute}.bmpp-number:hover .bmpp-numberControls .icon{width:40px;width:2.5rem;height:20px;height:1.25rem;-webkit-transition:opacity .3s ease,font-size .1s ease!important;transition:opacity .3s ease,font-size .1s ease!important;position:absolute;overflow:hidden}.bmpp-number:hover .bmpp-numberControls .icon:hover{font-size:large!important}.bmpp-number:hover .bmpp-numberControls .icon:last-of-type{top:50%}.bmpp-number:hover .bmpp-numberControls .icon:before{position:absolute;top:5%;bottom:0;left:0;right:0;line-height:0!important}.bmpp-number:hover .bmpp-numberControls .icon:first-of-type:before{bottom:5%;top:95%}.bmpp-queryDistances{margin:1em auto!important;position:relative}.bmpp-queryDistances--toOtherElement{margin-top:3em!important}.bmpp-queryDistances .bmpp-queryDistance{min-height:4em}.bmpp-queryDistances .bmpp-queryDistance .ui.form{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-align:baseline;-ms-flex-align:baseline;align-items:baseline}.bmpp-queryDistances .bmpp-queryDistance .ui.form .field{margin-right:1em}.bmpp-queryDistances .bmpp-queryDistance .ui.form .field.bmpp-units{width:8em!important}.bmpp-queryDistances .bmpp-queryDistance .ui.form .field.bmpp-points{width:14em!important}.bmpp-queryDistances .bmpp-queryDistance .ui.form .bmpp-units .text{border-bottom:1px dashed grey!important}.bmpp-queryDistances .bmpp-queryDistance .ui.form input[type=number]{width:6em!important}.bmpp-queryDistances .bmpp-queryDistance .ui.form .ui.selection.dropdown{height:2em!important;padding-top:.5em!important}.bmpp-queryDistances .bmpp-queryDistanceHelp{position:absolute;top:1em!important;right:.5em!important}.bmpp-subcorpusForm{height:12em}.bmpp-subcorpusForm header{cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.bmpp-subcorpusForm .ui.form{-webkit-column-count:auto!important;-webkit-column-width:10rem!important;columns:10rem!important}.bmpp-unitGroups{list-style:none;margin:0;padding:0}.bmpp-unitGroups li{font-style:italic;margin:0;-webkit-column-break-inside:avoid;break-inside:avoid}.bmpp-units{list-style:none;margin:.5em 0 1.5em;padding:0}.bmpp-units li{font-style:normal;line-height:1.5em;cursor:pointer}.bmpp-units li .unit{border-bottom:1px dotted #2185d0;color:#2185d0}.bmpp-units li .unitSelectionContainer{padding:0 .5em .2em}.bmpp-units li.active .unit{border-bottom:none;color:#fff}.bmpp-units li.active .unitSelectionContainer{background-color:#2185d0}.bmpp-channelSlug{width:6em!important}.bmpp-editUrl{font-size:smaller;border-bottom:1px dotted #2185d0;color:#2185d0;cursor:pointer}.bmpp-negativeNode{padding-top:3.4em!important}.bmpp-valueList{margin:0;padding:0;list-style:none}.bmpp-valueList li{margin-bottom:.5em}.bmpp-valueList .bmpp-valueList{padding:.7em 0 .5em 1.7em}.bmpp-listItemValue{color:#2c662d;padding:0 .1em}.bmpp-editableListItem{display:block!important;margin:.7em 0 0 2.4em}.bmpp-propertyHeader{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.bmpp-propertyHeader.clickable{cursor:copy}.bmpp-bannerPropname{color:grey;font-style:italic}.bmpp-bannerText{color:grey}.bmpp-searchResult{width:100%;display:grid;grid-template-columns:auto 1fr;-webkit-column-gap:.66em;column-gap:.66em;-webkit-box-align:baseline;-ms-flex-align:baseline;align-items:baseline}.bmpp-searchResult .divider{grid-column:1/span 2;border:none;border-top:1px solid rgba(34,36,38,.15);padding:.5em 0 0;margin:.5em 0 0}.bmpp-searchResult .bmpp-recordLabel{position:absolute!important;right:1em}.bmpp-searchResult .bmpp-recordLabel.bmpp-initialRecordLabel{top:1em}.bmpp-searchResult .bmpp-unitValue{text-align:right;color:green;font-size:smaller;cursor:pointer}.bmpp-searchResult .bmpp-transcription{cursor:pointer}.bmpp-searchResult .bmpp-context{color:grey;cursor:auto!important}.bmpp-unitTypeAndGroup{position:relative}.bmpp-unitTypeAndGroup .bmpp-unitType{position:relative;left:.5em;bottom:auto;white-space:nowrap;font-weight:400!important}.bmpp-unitTypeAndGroup .bmpp-unitTypeWithGroup{position:absolute;bottom:-.5em}header .bmpp-unitTypeAndGroup .bmpp-unitTypeWithGroup{bottom:-.4em}.bmpp-unitTypeAndGroup .bmpp-unitTypeGroup{color:grey;-webkit-font-feature-settings:"c2sc";font-feature-settings:"c2sc";font-variant:small-caps;font-size:smaller;font-weight:400!important;white-space:nowrap;position:absolute;top:-1em;left:.75em}header .bmpp-unitTypeAndGroup .bmpp-unitTypeGroup{font-size:x-small;top:-1em;left:1em}');"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function i(e,t){return e(t={exports:{}},t.exports),t.exports}var a=1e3,s=60*a,r=60*s,o=24*r,l=7*o,c=365.25*o,u=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*c;case"weeks":case"week":case"w":return n*l;case"days":case"day":case"d":return n*o;case"hours":case"hour":case"hrs":case"hr":case"h":return n*r;case"minutes":case"minute":case"mins":case"min":case"m":return n*s;case"seconds":case"second":case"secs":case"sec":case"s":return n*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&!1===isNaN(e))return t.long?function(e){var t=Math.abs(e);if(t>=o)return d(e,t,o,"day");if(t>=r)return d(e,t,r,"hour");if(t>=s)return d(e,t,s,"minute");if(t>=a)return d(e,t,a,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=o)return Math.round(e/o)+"d";if(t>=r)return Math.round(e/r)+"h";if(t>=s)return Math.round(e/s)+"m";if(t>=a)return Math.round(e/a)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function d(e,t,n,i){var a=t>=1.5*n;return Math.round(e/n)+" "+i+(a?"s":"")}var p=function(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let s;function r(...e){if(!r.enabled)return;const t=r,i=Number(new Date),a=i-(s||i);t.diff=a,t.prev=s,t.curr=i,s=i,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(i,a)=>{if("%%"===i)return i;o++;const s=n.formatters[a];if("function"==typeof s){const n=e[o];i=s.call(t,n),e.splice(o,1),o--}return i}),n.formatArgs.call(t,e),(t.log||n.log).apply(t,e)}return r.namespace=e,r.enabled=n.enabled(e),r.useColors=n.useColors(),r.color=t(e),r.destroy=i,r.extend=a,"function"==typeof n.init&&n.init(r),n.instances.push(r),r}function i(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function a(e,t){return n(this.namespace+(void 0===t?":":t)+e)}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){const e=[...n.names.map(s),...n.skips.map(s).map(e=>"-"+e)].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const i=("string"==typeof e?e:"").split(/[\s,]+/),a=i.length;for(t=0;t<a;t++)i[t]&&("-"===(e=i[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,i;for(t=0,i=n.skips.length;t<i;t++)if(n.skips[t].test(e))return!1;for(t=0,i=n.names.length;t<i;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=u,Object.keys(e).forEach(t=>{n[t]=e[t]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n},h=i(function(e,t){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let i=0,a=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(i++,"%c"===e&&(a=i))}),t.splice(a,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=p(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}),m=(h.log,h.formatArgs,h.save,h.load,h.useColors,h.storage,h.colors,h("bumppo:log"));h.disable();var f=i(function(e,t){e.exports=function(){var e=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)},t=m,n=o,i=function(e){return l(o(e))},a=l,s=h,r=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function o(e){for(var t,n=[],i=0,a=0,s="";null!=(t=r.exec(e));){var o=t[0],l=t[1],c=t.index;if(s+=e.slice(a,c),a=c+o.length,l)s+=l[1];else{s&&(n.push(s),s="");var d=t[2],p=t[3],h=t[4],m=t[5],f=t[6],v=t[7],b="+"===f||"*"===f,g="?"===f||"*"===f,y=d||"/",k=h||m||(v?".*":"[^"+y+"]+?");n.push({name:p||i++,prefix:d||"",delimiter:y,optional:g,repeat:b,pattern:u(k)})}}return a<e.length&&(s+=e.substr(a)),s&&n.push(s),n}function l(t){for(var n=new Array(t.length),i=0;i<t.length;i++)"object"==typeof t[i]&&(n[i]=new RegExp("^"+t[i].pattern+"$"));return function(i){for(var a="",s=i||{},r=0;r<t.length;r++){var o=t[r];if("string"!=typeof o){var l,c=s[o.name];if(null==c){if(o.optional)continue;throw new TypeError('Expected "'+o.name+'" to be defined')}if(e(c)){if(!o.repeat)throw new TypeError('Expected "'+o.name+'" to not repeat, but received "'+c+'"');if(0===c.length){if(o.optional)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var u=0;u<c.length;u++){if(l=encodeURIComponent(c[u]),!n[r].test(l))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but received "'+l+'"');a+=(0===u?o.prefix:o.delimiter)+l}}else{if(l=encodeURIComponent(c),!n[r].test(l))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but received "'+l+'"');a+=o.prefix+l}}else a+=o}return a}}function c(e){return e.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function u(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function d(e,t){return e.keys=t,e}function p(e){return e.sensitive?"":"i"}function h(e,t){for(var n=(t=t||{}).strict,i=!1!==t.end,a="",s=e[e.length-1],r="string"==typeof s&&/\/$/.test(s),o=0;o<e.length;o++){var l=e[o];if("string"==typeof l)a+=c(l);else{var u=c(l.prefix),d=l.pattern;l.repeat&&(d+="(?:"+u+d+")*"),d=l.optional?u?"(?:"+u+"("+d+"))?":"("+d+")?":u+"("+d+")",a+=d}}return n||(a=(r?a.slice(0,-2):a)+"(?:\\/(?=$))?"),a+=i?"$":n&&r?"":"(?=\\/|$)",new RegExp("^"+a,p(t))}function m(t,n,i){return e(n=n||[])?i||(i={}):(i=n,n=[]),t instanceof RegExp?function(e,t){var n=e.source.match(/\((?!\?)/g);if(n)for(var i=0;i<n.length;i++)t.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return d(e,t)}(t,n):e(t)?function(e,t,n){for(var i=[],a=0;a<e.length;a++)i.push(m(e[a],t,n).source);return d(new RegExp("(?:"+i.join("|")+")",p(n)),t)}(t,n,i):function(e,t,n){for(var i=o(e),a=h(i,n),s=0;s<i.length;s++)"string"!=typeof i[s]&&t.push(i[s]);return d(a,t)}(t,n,i)}t.parse=n,t.compile=i,t.tokensToFunction=a,t.tokensToRegExp=s;var f,v="undefined"!=typeof document,b="undefined"!=typeof window,g="undefined"!=typeof history,y="undefined"!=typeof process,k=v&&document.ontouchstart?"touchstart":"click",w=b&&!(!window.history.location&&!window.location);function x(){this.callbacks=[],this.exits=[],this.current="",this.len=0,this._decodeURLComponents=!0,this._base="",this._strict=!1,this._running=!1,this._hashbang=!1,this.clickHandler=this.clickHandler.bind(this),this._onpopstate=this._onpopstate.bind(this)}function _(e,t){if("function"==typeof e)return _.call(this,"*",e);if("function"==typeof t)for(var n=new C(e,null,this),i=1;i<arguments.length;++i)this.callbacks.push(n.middleware(arguments[i]));else"string"==typeof e?this["string"==typeof t?"redirect":"show"](e,t):this.start(e)}function T(e,t,n){var i=this.page=n||_,a=i._window,s=i._hashbang,r=i._getBase();"/"===e[0]&&0!==e.indexOf(r)&&(e=r+(s?"#!":"")+e);var o=e.indexOf("?");if(this.canonicalPath=e,this.path=e.replace(r,"")||"/",s&&(this.path=this.path.replace("#!","")||"/"),this.title=v&&a.document.title,this.state=t||{},this.state.path=e,this.querystring=~o?i._decodeURLEncodedURIComponent(e.slice(o+1)):"",this.pathname=i._decodeURLEncodedURIComponent(~o?e.slice(0,o):e),this.params={},this.hash="",!s){if(!~this.path.indexOf("#"))return;var l=this.path.split("#");this.path=this.pathname=l[0],this.hash=i._decodeURLEncodedURIComponent(l[1])||"",this.querystring=this.querystring.split("#")[0]}}function C(e,n,i){this.page=i||P;var a=n||{};a.strict=a.strict||i._strict,this.path="*"===e?"(.*)":e,this.method="GET",this.regexp=t(this.path,this.keys=[],a)}x.prototype.configure=function(e){var t=e||{};this._window=t.window||b&&window,this._decodeURLComponents=!1!==t.decodeURLComponents,this._popstate=!1!==t.popstate&&b,this._click=!1!==t.click&&v,this._hashbang=!!t.hashbang;var n=this._window;this._popstate?n.addEventListener("popstate",this._onpopstate,!1):b&&n.removeEventListener("popstate",this._onpopstate,!1),this._click?n.document.addEventListener(k,this.clickHandler,!1):v&&n.document.removeEventListener(k,this.clickHandler,!1),this._hashbang&&b&&!g?n.addEventListener("hashchange",this._onpopstate,!1):b&&n.removeEventListener("hashchange",this._onpopstate,!1)},x.prototype.base=function(e){if(0===arguments.length)return this._base;this._base=e},x.prototype._getBase=function(){var e=this._base;if(e)return e;var t=b&&this._window&&this._window.location;return b&&this._hashbang&&t&&"file:"===t.protocol&&(e=t.pathname),e},x.prototype.strict=function(e){if(0===arguments.length)return this._strict;this._strict=e},x.prototype.start=function(e){var t=e||{};if(this.configure(t),!1!==t.dispatch){var n;if(this._running=!0,w){var i=this._window,a=i.location;n=this._hashbang&&~a.hash.indexOf("#!")?a.hash.substr(2)+a.search:this._hashbang?a.search+a.hash:a.pathname+a.search+a.hash}this.replace(n,null,!0,t.dispatch)}},x.prototype.stop=function(){if(this._running){this.current="",this.len=0,this._running=!1;var e=this._window;this._click&&e.document.removeEventListener(k,this.clickHandler,!1),b&&e.removeEventListener("popstate",this._onpopstate,!1),b&&e.removeEventListener("hashchange",this._onpopstate,!1)}},x.prototype.show=function(e,t,n,i){var a=new T(e,t,this),s=this.prevContext;return this.prevContext=a,this.current=a.path,!1!==n&&this.dispatch(a,s),!1!==a.handled&&!1!==i&&a.pushState(),a},x.prototype.back=function(e,t){var n=this;if(this.len>0){var i=this._window;g&&i.history.back(),this.len--}else e?setTimeout(function(){n.show(e,t)}):setTimeout(function(){n.show(n._getBase(),t)})},x.prototype.redirect=function(e,t){var n=this;"string"==typeof e&&"string"==typeof t&&_.call(this,e,function(e){setTimeout(function(){n.replace(t)},0)}),"string"==typeof e&&void 0===t&&setTimeout(function(){n.replace(e)},0)},x.prototype.replace=function(e,t,n,i){var a=new T(e,t,this),s=this.prevContext;return this.prevContext=a,this.current=a.path,a.init=n,a.save(),!1!==i&&this.dispatch(a,s),a},x.prototype.dispatch=function(e,t){var n=0,i=0,a=this;function s(){var t=a.callbacks[n++];if(e.path===a.current)return t?void t(e,s):function(e){if(!e.handled){var t=this._window;(this._hashbang?w&&this._getBase()+t.location.hash.replace("#!",""):w&&t.location.pathname+t.location.search)!==e.canonicalPath&&(this.stop(),e.handled=!1,w&&(t.location.href=e.canonicalPath))}}.call(a,e);e.handled=!1}t?function e(){var n=a.exits[i++];if(!n)return s();n(t,e)}():s()},x.prototype.exit=function(e,t){if("function"==typeof e)return this.exit("*",e);for(var n=new C(e,null,this),i=1;i<arguments.length;++i)this.exits.push(n.middleware(arguments[i]))},x.prototype.clickHandler=function(e){if(1===this._which(e)&&!(e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)){var t=e.target,n=e.path||(e.composedPath?e.composedPath():null);if(n)for(var i=0;i<n.length;i++)if(n[i].nodeName&&"A"===n[i].nodeName.toUpperCase()&&n[i].href){t=n[i];break}for(;t&&"A"!==t.nodeName.toUpperCase();)t=t.parentNode;if(t&&"A"===t.nodeName.toUpperCase()){var a="object"==typeof t.href&&"SVGAnimatedString"===t.href.constructor.name;if(!t.hasAttribute("download")&&"external"!==t.getAttribute("rel")){var s=t.getAttribute("href");if((this._hashbang||!this._samePath(t)||!t.hash&&"#"!==s)&&!(s&&s.indexOf("mailto:")>-1)&&(a?!t.target.baseVal:!t.target)&&(a||this.sameOrigin(t.href))){var r=a?t.href.baseVal:t.pathname+t.search+(t.hash||"");r="/"!==r[0]?"/"+r:r,y&&r.match(/^\/[a-zA-Z]:\//)&&(r=r.replace(/^\/[a-zA-Z]:\//,"/"));var o=r,l=this._getBase();0===r.indexOf(l)&&(r=r.substr(l.length)),this._hashbang&&(r=r.replace("#!","")),(!l||o!==r||w&&"file:"===this._window.location.protocol)&&(e.preventDefault(),this.show(o))}}}}},x.prototype._onpopstate=(f=!1,b?(v&&"complete"===document.readyState?f=!0:window.addEventListener("load",function(){setTimeout(function(){f=!0},0)}),function(e){if(f)if(e.state){var t=e.state.path;this.replace(t,e.state)}else if(w){var n=this._window.location;this.show(n.pathname+n.search+n.hash,void 0,void 0,!1)}}):function(){}),x.prototype._which=function(e){return null==(e=e||b&&this._window.event).which?e.button:e.which},x.prototype._toURL=function(e){var t=this._window;if("function"==typeof URL&&w)return new URL(e,t.location.toString());if(v){var n=t.document.createElement("a");return n.href=e,n}},x.prototype.sameOrigin=function(e){if(!e||!w)return!1;var t=this._toURL(e),n=this._window,i=n.location;return i.protocol===t.protocol&&i.hostname===t.hostname&&i.port===t.port},x.prototype._samePath=function(e){if(!w)return!1;var t=this._window,n=t.location;return e.pathname===n.pathname&&e.search===n.search},x.prototype._decodeURLEncodedURIComponent=function(e){return"string"!=typeof e?e:this._decodeURLComponents?decodeURIComponent(e.replace(/\+/g," ")):e},T.prototype.pushState=function(){var e=this.page,t=e._window,n=e._hashbang;e.len++,g&&t.history.pushState(this.state,this.title,n&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},T.prototype.save=function(){var e=this.page;g&&"file:"!==e._window.location.protocol&&e._window.history.replaceState(this.state,this.title,e._hashbang&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},C.prototype.middleware=function(e){var t=this;return function(n,i){if(t.match(n.path,n.params))return e(n,i);i()}},C.prototype.match=function(e,t){var n=this.keys,i=e.indexOf("?"),a=~i?e.slice(0,i):e,s=this.regexp.exec(decodeURIComponent(a));if(!s)return!1;for(var r=1,o=s.length;r<o;++r){var l=n[r-1],c=this.page._decodeURLEncodedURIComponent(s[r]);void 0===c&&hasOwnProperty.call(t,l.name)||(t[l.name]=c)}return!0};var P=function e(){var t=new x;function n(){return _.apply(t,arguments)}return n.callbacks=t.callbacks,n.exits=t.exits,n.base=t.base.bind(t),n.strict=t.strict.bind(t),n.start=t.start.bind(t),n.stop=t.stop.bind(t),n.show=t.show.bind(t),n.back=t.back.bind(t),n.redirect=t.redirect.bind(t),n.replace=t.replace.bind(t),n.dispatch=t.dispatch.bind(t),n.exit=t.exit.bind(t),n.configure=t.configure.bind(t),n.sameOrigin=t.sameOrigin.bind(t),n.clickHandler=t.clickHandler.bind(t),n.create=e,Object.defineProperty(n,"len",{get:function(){return t.len},set:function(e){t.len=e}}),Object.defineProperty(n,"current",{get:function(){return t.current},set:function(e){t.current=e}}),n.Context=T,n.Route=C,n}(),N=P,S=P;return N.default=S,N}()}),v={viewModel:{createViewModel:function(e,i){var a=i.element,s=e.value,r=e.disabled,o=e.disabledTooltip,l={onChange:function(){s(!s())}},c={content:o,variation:"basic",position:"right center",transition:"fade",delay:{show:500,hide:0},duration:400,onVisible:function(e){setTimeout(function(e){t(e).popup("hide")}.bind(this,e),1700)}};return s.checkboxComponent=a,n.unwrap(r)?o&&t(a).popup(c):t(a).checkbox(l),{disabled:r,label:e.label,tabindex:e.tabindex,value:s}}},template:'\n\n  <div class="ui checkbox" data-bind="css: { disabled: disabled }">\n    <input type="checkbox" class="hidden"\n      data-bind="checked: ko.unwrap(disabled) ? false : value,\n        attr: { tabindex: tabindex }">\n    <label data-bind="text: label"></label>\n  </div>\n\n'};function b(e,t){function i(){var t=e();return"number"==typeof t?t.toString():""}var a=n.computed({read:i,write:function(n){var a=e(),s=i(),r=t.makeValueValid(n),o=parseInt(r,10),l=isNaN(o)?null:o;l!==a?e(l):n!==s&&e.notifySubscribers(l)}}).extend({notify:"always"});return a.relatedObservable=e,a}var g={viewModel:{createViewModel:function(e,t){var n=e.property;return{property:n,step:function(e,t){return function(){var n=e.relatedObservable,i=n();null===i&&(i=n.min>0?n.min:0),"+"===t&&(i=Math.floor(i/n.step+1)*n.step),"-"===t&&(i=Math.ceil(i/n.step-1)*n.step),i<n.min&&(i=n.min),null!==n.max&&i>n.max&&(i=n.max),n(i)}},validatableFrom:b(n.from,n),validatableTo:b(n.to,n)}}},template:'\n\n  <div class="ui inline input bmpp-number">\n    <label data-bind="text: property.from.label"></label>\n    <input type="text" pattern="-?[0-9]*" inputmode="numeric"\n      data-bind="attr: { placeholder: property.from.placeholder },\n        value: validatableFrom, valueUpdate: \'input\',">\n    <div class="bmpp-numberControls">\n      <i class="grey link icon sort up"\n        data-bind="click: step(validatableFrom, \'+\')"></i>\n      <i class="grey link icon sort down"\n        data-bind="click: step(validatableFrom, \'-\')"></i>\n    </div>\n  </div>\n\n  <div class="ui inline input bmpp-number">\n    <label data-bind="text: property.to.label"></label>\n    <input type="text" pattern="-?[0-9]*" inputmode="numeric"\n      data-bind="attr: { placeholder: property.to.placeholder },\n        value: validatableTo, valueUpdate: \'input\',">\n    <div class="bmpp-numberControls">\n      <i class="grey link icon sort up"\n        data-bind="click: step(validatableTo, \'+\')"></i>\n      <i class="grey link icon sort down"\n        data-bind="click: step(validatableTo, \'-\')"></i>\n    </div>\n  </div>\n\n  <span class="bmpp-units" data-bind="text: property.units"></span>\n\n'},y={viewModel:{createViewModel:function(e,t){return e.property}},template:'\n\n  <bmpp-value-list params="valueList: valueList"></bmpp-value-list>\n\n'},k={viewModel:{createViewModel:function(e,t){return{node:e.node}}},template:'\n\n  \x3c!-- ko with: node --\x3e\n\n  <header class="ui header">\n    \x3c!-- ko with: unitType --\x3e\n\n      <button class="ui button bmpp-channelSlug"\n        data-bind="css: channel.color, text: channel.id">\n      </button>\n\n      <span class="bmpp-unitTypeAndGroup">\n        \x3c!-- ko if: group --\x3e\n          <span data-bind="textLowercaseFirstChar: group.name"\n            class="bmpp-unitTypeGroup"></span>\n        \x3c!-- /ko --\x3e\n        <span class="bmpp-unitType"\n        data-bind="css: { \'bmpp-unitTypeWithGroup\': group }">\n          Тип единицы:\n          <strong data-bind="text: hasAbbr ? abbr : name"\n            style="padding-left: .5em;"></strong>\n        </span>\n      </span>\n\n    \x3c!-- /ko --\x3e\n  </header>\n\n  <div data-bind="foreach: unitProperties">\n    <search-unit-property params="property: $data"></search-unit-property>\n  </div>\n\n  \x3c!-- /ko --\x3e\n\n'};function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _(e,t,n){return t&&x(e.prototype,t),n&&x(e,n),e}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?N(e):t}function A(e,t,n){return(A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=C(e)););return e}(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,a=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(i=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,s=e}finally{try{i||null==o.return||o.return()}finally{if(a)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function L(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var O=function(){function e(t,n,i){w(this,e);var a=this.drawCircle(t),s=this.drawText(t,i.serialNumber());this.draw=t,this.element=n,this.treeNode=i,this.svgText=s,this.svg=t.group().add(a).add(s),this.fineTune()}return _(e,[{key:"drawCircle",value:function(e){return e.circle(30).attr({fill:"none",stroke:"#aaa","stroke-width":1}).cx(15).cy(15)}},{key:"drawText",value:function(e,t){return e.text(String(t)).attr({fill:"#aaa"}).cx(15).cy(15)}},{key:"fineTune",value:function(){var e=this;this.position(),this.treeNode.serialNumber.subscribe(function(t){e.changeText(t)}),n.utils.domNodeDisposal.addDisposeCallback(this.element,function(){e.dispose()}),this.treeNode.svgSlug=this}},{key:"position",value:function(){var e=t(this.element).offset().top,n=t(this.element).parent().offset().top,i=Math.abs(e-n)+18;this.svg.x(83).y(i)}},{key:"changeText",value:function(e){this.svgText=this.svgText.text(String(e))}},{key:"dispose",value:function(){this.svg.remove(),this.svgText.remove()}}]),e}(),V=function(){function e(t,n,i){w(this,e),this.draw=t,this.element=n,this.treeNode=i,this.svg=this.drawLine(t,i),this.fineTune()}return _(e,[{key:"fineTune",value:function(){var e=this;n.utils.domNodeDisposal.addDisposeCallback(this.element,function(){e.dispose()}),this.treeNode.svgRelationLine=this}},{key:"drawLine",value:function(e,t){var n="";if(t.parentNode){var i=t.parentNode.svgSlug.svg;n="M ".concat(i.cx()," ").concat(i.cy()+15,"\n              L ").concat(i.cx()," ").concat(i.cy()+15)}return e.path(n).fill("none").stroke({color:"#aaa",width:1})}},{key:"redrawLine",value:function(){var n=this.treeNode.parentNode&&this.treeNode.parentNode.svgSlug,i=this.treeNode.svgSlug,a=this.treeNode.level,s=t(this.element).height();if(n&&i&&a){var r=e.calculatePath(n,i,a(),s);this.svg.plot(r)}}},{key:"dispose",value:function(){this.svg.remove()}}],[{key:"calculatePath",value:function(e,t,n,i){var a=e.svg,s=t.svg,r=15,o=i-45,l=n<3?n:2,c=n<3?0:n-2,u=67.5;return 0===n?"M ".concat(a.cx()," ").concat(a.cy()+r,"\n              L ").concat(s.cx()," ").concat(s.cy()-r):"M ".concat(a.cx()," ").concat(a.cy()+r,"\n              V ").concat(a.cy()+r+7.5,"\n              C ").concat(a.cx()," ").concat(a.cy()+r+7.5+45,"\n                ").concat(a.cx()-15-19.5*l-7.5*c," ").concat(a.cy()+r+7.5+u-45,"\n                ").concat(a.cx()-15-19.5*l-7.5*c," ").concat(a.cy()+r+7.5+u,"\n              V ").concat(s.cy()-r-o-u,"\n              C ").concat(s.cx()-15-19.5*l-7.5*c," ").concat(s.cy()-r-o-u+45,"\n                ").concat(s.cx()," ").concat(s.cy()-r-o-45,"\n                ").concat(s.cx()," ").concat(s.cy()-r-o,"\n              V ").concat(s.cy()-r)}}]),e}(),I={viewModel:{createViewModel:function(e,n){var i=e.node,a={variation:"basic",position:"bottom right",transition:"fade",delay:{show:1e3,hide:0},duration:400,onVisible:function(e){setTimeout(function(e){t(e).popup("hide")}.bind(this,e),1700)}};return new O(e.draw,n.element,i),t(document).ready(function(){var e=t(n.element);a.content="Добавить единицу поиска",e.find(".bmpp-addPositiveUnit").popup(a),a.content="Добавить отрицательную единицу поиска",e.find(".bmpp-addNegativeUnit").popup(a),e.find(".bmpp-negativeUnitHelp").popup({inline:!0})}),{node:i}}},template:'\n\n  <div class="bmpp-queryElement ui segment"\n    data-bind="css: { \'bmpp-negativeNode\': node.negative }">\n\n    <div class="bmpp-queryTreeHandles">\n\n      <i class="ui disabled green down arrow icon bmpp-addPositiveUnit"\n        data-bind="click: node.addChild.bind(node, false),\n          visible: !node.negative() && node.unitType() !== null"></i>\n\n      <i class="ui disabled red down arrow icon bmpp-addNegativeUnit"\n        data-bind="click: node.addChild.bind(node, true),\n          visible: !node.negative() && node.unitType() !== null"></i>\n\n      <i class="ui disabled grey close icon"\n        title="Удалить единицу поиска со всеми зависимостями"\n        data-bind="visible: node.depth() > 0,\n          click: function () {\n                   node.seppuku();\n                   $root.isQueryNew(true);\n                 }"></i>\n    </div>\n\n    <div class="ui top attached basic red label"\n      data-bind="visible: node.negative">\n      НЕТ\n      <i class="disabled grey question circle outline icon\n        bmpp-nearLabelIcon bmpp-negativeUnitHelp"></i>\n      <div class="ui basic popup hidden">\n        <header class="ui header">Отрицательное условие</header>\n\n        <p>При отрицательном условии ищутся контексты, в которых\n        <strong>нет</strong> единиц, обладающих указанными свойствами,\n        и располагающихся на указанном расстоянии.</p>\n\n        <p>Отрицательное условие всегда является терминальным: к ветке запроса,\n        заканчивающейся этой единицей, нельзя добавить еще одну единицу.</p>\n      </div>\n    </div>\n\n    <search-unit-choice params="node: node,\n      queryPartsNonReadiness: $root.queryPartsNonReadiness,\n      editNodeProperties: $root.queryPaneView.editNodeProperties,\n      finishEditingNodeProperties: $root.queryPaneView.finishEditingNodeProperties,\n      isQueryNew: $root.isQueryNew">\n    </search-unit-choice>\n\n  </div>\n\n'},R={viewModel:{createViewModel:function(e,n){var i=e.node,a=n.element,s={html:'\n\n  <header class="ui header">Условие на расстояние</header>\n\n  <p>В качестве условий можно по отдельности указывать интервалы расстояний\n  между началами (левыми границами) и концами (правыми границами) единиц.\n  Например, если задать условие «от&nbsp;−50 до&nbsp;100&nbsp;мс между началом\n  X и началом Y», будут найдены контексты, в которых левая граница\n  X располагается не левее, чем в&nbsp;50&nbsp;мс, и не правее, чем\n  в&nbsp;100&nbsp;мс, от левой границы Y.</p>\n\n  <p>Если для условия указано только одно значение, ограничения с другой\n  стороны не накладывается. Если не указано ни одно значение, это\n  интерпретируется как интервал «от&nbsp;0 до&nbsp;0». Значения задаются\n  в миллисекундах. Если X и Y являются единицам одного типа, между началом\n  X и концом Y можно задать расстояние в терминах единицы данного типа.</p>\n\n',variation:"basic fluid",setFluidWidth:!1,delay:{show:400,hide:0},duration:400,lastResort:!0,onShow:function(e){var n=t(e).popup("get popup");t(n).attr("style","width: 35em!important")}};return new V(e.draw,a,i),t(a).find(".bmpp-queryDistanceHelp").popup(s),t.initialize(".ui.dropdown",function(){t(this).dropdown()},{target:a}),{relations:i.relationsToParentNode,node:i}}},template:'\n\n  <div class="bmpp-queryDistances ui segments"\n    data-bind="css: { \'bmpp-queryDistances--toOtherElement\':\n                      $component.node.level() > 0 }">\n\n    \x3c!-- ko foreach: relations --\x3e\n      '.concat('\n\n  <div class="bmpp-queryDistance ui secondary segment">\n\n    <div class="ui tiny header" data-bind="visible: $index() === 0">\n      на расстоянии:\n    </div>\n\n    <div class="ui form" style="margin-bottom: -1em;">\n      <div class="bmpp-queryTreeHandles bmpp-queryTreeHandles2">\n        <i class="ui small disabled grey plus icon"\n          data-bind="visible: $index() === $component.relations().length - 1,\n                     click: childNode.addRelation.bind(childNode)">\n        </i>\n\n        <i class="ui small icon"\n          data-bind="visible: $index() !== $component.relations().length - 1">\n        </i>\n\n        <i class="ui small disabled grey close icon"\n          data-bind="visible: $index() !== 0,\n                   click: childNode.removeRelation.bind(childNode, $data)"></i>\n      </div>\n\n      <div class="inline field bmpp-number">\n        <label>от</label>\n        <input type="number" step="50" min="0" placeholder="0">\n      </div>\n\n      <div class="inline field bmpp-number">\n        <label>до</label>\n        <input type="number" step="50" min="0" placeholder="0">\n      </div>\n\n      <div class="inline field bmpp-units">\n        <div class="ui inline dropdown">\n          <div class="default text">миллисекунд</div>\n          <div class="menu">\n            <div class="item" data-value="ms">миллисекунд</div>\n            <div class="item" data-value="u">единиц</div>\n          </div>\n        </div>\n      </div>\n\n      <div class="inline field bmpp-points">\n        <div class="ui selection dropdown">\n          <input type="hidden" name="pp">\n          <label>между</label>\n          <i class="dropdown icon"></i>\n          <div class="default text">\n            началом\n            <div class="ui circular label"\n              data-bind="text: childNode.serialNumber"></div>\n          </div>\n          <div class="menu">\n            <div class="item" data-value="s">\n              началом\n              <div class="ui circular label"\n                data-bind="text: childNode.serialNumber"></div>\n            </div>\n            <div class="item" data-value="e">\n              концом\n              <div class="ui circular label"\n                data-bind="text: childNode.serialNumber"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="inline field bmpp-points">\n        <div class="ui selection dropdown">\n          <input type="hidden" name="cp">\n          <label>и</label>\n          <i class="dropdown icon"></i>\n          <div class="default text">\n            началом\n            <div class="ui circular label"\n              data-bind="text: parentNode.serialNumber"></div>\n          </div>\n          <div class="menu">\n            <div class="item" data-value="s">\n              началом\n              <div class="ui circular label"\n                data-bind="text: parentNode.serialNumber"></div>\n            </div>\n            <div class="item" data-value="e">\n              концом\n              <div class="ui circular label"\n                data-bind="text: parentNode.serialNumber"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </div>\n\n','\n    \x3c!-- /ko --\x3e\n\n    <i class="ui disabled grey question circle outline icon\n              bmpp-queryDistanceHelp"></i>\n  </div>\n\n')};function M(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.depth(),a=M.levels;if(0==i)a=M.levels=[0],M.serialNumber=1;else{if(!(0===i||a instanceof Array))throw"Нарушена правильная работа функции линеаризации дерева";if(n)a.push(0);else if(a.length===i+1)a[a.length-1]+=1;else{var s=Math.max.apply(Math,L(a.slice(i)));a.splice(i),a[i]=s+1}}if(e.level(a.slice(-1)[0]),e.serialNumber(M.serialNumber),M.serialNumber+=1,t.push(e),e.childNodes().length>0)for(var r=0;r<e.childNodes().length;r++){t=M(e.childNodes()[r],t,0==r)}return t}var F={viewModel:{createViewModel:function(t,i){var a=function(e){var t=!0,n=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var r=a.value;r.svgSlug&&r.svgSlug.position()}}catch(e){n=!0,i=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw i}}var o=!0,l=!1,c=void 0;try{for(var u,d=e.slice(1)[Symbol.iterator]();!(o=(u=d.next()).done);o=!0){var p=u.value;p.svgRelationLine&&p.svgRelationLine.redrawLine()}}catch(e){l=!0,c=e}finally{try{o||null==d.return||d.return()}finally{if(l)throw c}}},s=n.computed(function(){var e=M(t.queryTree,[]),n=!0,i=!1,a=void 0;try{for(var s,r=e[Symbol.iterator]();!(n=(s=r.next()).done);n=!0)s.value.childNodes()}catch(e){i=!0,a=e}finally{try{n||null==r.return||r.return()}finally{if(i)throw a}}return e});return s.subscribe(a),new MutationObserver(function(){return void 0!==a.timeoutID&&clearTimeout(a.timeoutID),a.timeoutID=setTimeout(function(){a(s())},30),!0}).observe(i.element,{childList:!0,subtree:!0,attributes:!1,characterData:!1,attributeOldValue:!1,characterDataOldValue:!1}),{linearizedQueryTree:s,svgDraw:e("svgQueryTree").size("100%","100%")}}},template:'\n\n  <div class="bmpp-queryPane">\n    <div class="bmpp-queryTree" id="'.concat("svgQueryTree",'">\n    </div>\n    <div class="bmpp-query" data-bind="foreach: linearizedQueryTree">\n\n      <query-node-relations params="node: $data, draw: $component.svgDraw"\n        data-bind="visible: $data.parentNode">\n      </query-node-relations>\n\n      <query-node params="node: $data, draw: $component.svgDraw"></query-node>\n\n    </div>\n  </div>\n\n')},q=i(function(e,t){"object"==typeof navigator&&(e.exports=function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,a=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(i=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,s=e}finally{try{i||null==o.return||o.return()}finally{if(a)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var s=function(e){return null!=e?e.constructor:null},r=function(e,t){return Boolean(e&&t&&e instanceof t)},o=function(e){return null==e},l=function(e){return s(e)===Object},c=function(e){return s(e)===String},u=function(e){return Array.isArray(e)},d=function(e){return r(e,NodeList)},p=function(e){return o(e)||(c(e)||u(e)||d(e))&&!e.length||l(e)&&!Object.keys(e).length},h={nullOrUndefined:o,object:l,number:function(e){return s(e)===Number&&!Number.isNaN(e)},string:c,boolean:function(e){return s(e)===Boolean},function:function(e){return s(e)===Function},array:u,weakMap:function(e){return r(e,WeakMap)},nodeList:d,element:function(e){return r(e,Element)},textNode:function(e){return s(e)===Text},event:function(e){return r(e,Event)},keyboardEvent:function(e){return r(e,KeyboardEvent)},cue:function(e){return r(e,window.TextTrackCue)||r(e,window.VTTCue)},track:function(e){return r(e,TextTrack)||!o(e)&&c(e.kind)},url:function(e){if(r(e,window.URL))return!0;if(!c(e))return!1;var t=e;e.startsWith("http://")&&e.startsWith("https://")||(t="http://".concat(e));try{return!p(new URL(t).hostname)}catch(e){return!1}},empty:p},m=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){return e=!0,null}});window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(e){}return e}();function f(e,t,n){var i=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(e&&"addEventListener"in e&&!h.empty(t)&&h.function(n)){var o=t.split(" "),l=r;m&&(l={passive:s,capture:r}),o.forEach(function(t){i&&i.eventListeners&&a&&i.eventListeners.push({element:e,type:t,callback:n,options:l}),e[a?"addEventListener":"removeEventListener"](t,n,l)})}}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];f.call(this,e,t,n,!0,i,a)}function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];f.call(this,e,t,n,!1,i,a)}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];f.call(this,e,t,function s(){b(e,t,s,i,a);for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];n.apply(this,o)},!0,i,a)}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(h.element(e)&&!h.empty(t)){var a=new CustomEvent(t,{bubbles:n,detail:Object.assign({},i,{plyr:this})});e.dispatchEvent(a)}}function k(e,t){var n=e.length?e:[e];Array.from(n).reverse().forEach(function(e,n){var i=n>0?t.cloneNode(!0):t,a=e.parentNode,s=e.nextSibling;i.appendChild(e),s?a.insertBefore(i,s):a.appendChild(i)})}function w(e,t){h.element(e)&&!h.empty(t)&&Object.entries(t).filter(function(e){var t=a(e,2)[1];return!h.nullOrUndefined(t)}).forEach(function(t){var n=a(t,2),i=n[0],s=n[1];return e.setAttribute(i,s)})}function x(e,t,n){var i=document.createElement(e);return h.object(t)&&w(i,t),h.string(n)&&(i.innerText=n),i}function _(e,t,n,i){h.element(t)&&t.appendChild(x(e,n,i))}function T(e){h.nodeList(e)||h.array(e)?Array.from(e).forEach(T):h.element(e)&&h.element(e.parentNode)&&e.parentNode.removeChild(e)}function C(e){if(h.element(e))for(var t=e.childNodes.length;t>0;)e.removeChild(e.lastChild),t-=1}function P(e,t){return h.element(t)&&h.element(t.parentNode)&&h.element(e)?(t.parentNode.replaceChild(e,t),e):null}function N(e,t){if(!h.string(e)||h.empty(e))return{};var n={},i=t;return e.split(",").forEach(function(e){var t=e.trim(),a=t.replace(".",""),s=t.replace(/[[\]]/g,"").split("="),r=s[0],o=s.length>1?s[1].replace(/["']/g,""):"";switch(t.charAt(0)){case".":h.object(i)&&h.string(i.class)&&(i.class+=" ".concat(a)),n.class=a;break;case"#":n.id=t.replace("#","");break;case"[":n[r]=o}}),n}function S(e,t){if(h.element(e)){var n=t;h.boolean(n)||(n=!e.hidden),n?e.setAttribute("hidden",""):e.removeAttribute("hidden")}}function A(e,t,n){if(h.nodeList(e))return Array.from(e).map(function(e){return A(e,t,n)});if(h.element(e)){var i="toggle";return void 0!==n&&(i=n?"add":"remove"),e.classList[i](t),e.classList.contains(t)}return!1}function E(e,t){return h.element(e)&&e.classList.contains(t)}function L(e,t){return function(){return Array.from(document.querySelectorAll(t)).includes(this)}.call(e,t)}function O(e){return this.elements.container.querySelectorAll(e)}function V(e){return this.elements.container.querySelector(e)}function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h.element(e)&&(e.focus({preventScroll:!0}),t&&A(e,this.config.classNames.tabFocus))}var R,M,F,q=(R=document.createElement("span"),M={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},F=Object.keys(M).find(function(e){return void 0!==R.style[e]}),!!h.string(F)&&M[F]);function D(e){setTimeout(function(){try{S(e,!0),e.offsetHeight,S(e,!1)}catch(e){}},0)}var B,U={isIE:!!document.documentMode,isWebkit:"WebkitAppearance"in document.documentElement.style&&!/Edge/.test(navigator.userAgent),isIPhone:/(iPhone|iPod)/gi.test(navigator.platform),isIos:/(iPad|iPhone|iPod)/gi.test(navigator.platform)},H={"audio/ogg":"vorbis","audio/wav":"1","video/webm":"vp8, vorbis","video/mp4":"avc1.42E01E, mp4a.40.2","video/ogg":"theora"},j={audio:"canPlayType"in document.createElement("audio"),video:"canPlayType"in document.createElement("video"),check:function(e,t,n){var i=U.isIPhone&&n&&j.playsinline,a=j[e]||"html5"!==t;return{api:a,ui:a&&j.rangeInput&&("video"!==e||!U.isIPhone||i)}},pip:!(U.isIPhone||!h.function(x("video").webkitSetPresentationMode)&&(!document.pictureInPictureEnabled||x("video").disablePictureInPicture)),airplay:h.function(window.WebKitPlaybackTargetAvailabilityEvent),playsinline:"playsInline"in document.createElement("video"),mime:function(e){var t=a(e.split("/"),1)[0],n=e;if(!this.isHTML5||t!==this.type)return!1;Object.keys(H).includes(n)&&(n+='; codecs="'.concat(H[e],'"'));try{return Boolean(n&&this.media.canPlayType(n).replace(/no/,""))}catch(e){return!1}},textTracks:"textTracks"in document.createElement("video"),rangeInput:(B=document.createElement("input"),B.type="range","range"===B.type),touch:"ontouchstart"in document.documentElement,transitions:!1!==q,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches},$={getSources:function(){var e=this;return this.isHTML5?Array.from(this.media.querySelectorAll("source")).filter(function(t){return j.mime.call(e,t.getAttribute("type"))}):[]},getQualityOptions:function(){return $.getSources.call(this).map(function(e){return Number(e.getAttribute("size"))}).filter(Boolean)},extend:function(){if(this.isHTML5){var e=this;Object.defineProperty(e.media,"quality",{get:function(){var t=$.getSources.call(e).find(function(t){return t.getAttribute("src")===e.source});return t&&Number(t.getAttribute("size"))},set:function(t){var n=$.getSources.call(e).find(function(e){return Number(e.getAttribute("size"))===t});if(n){var i=e.media,a=i.currentTime,s=i.paused,r=i.preload,o=i.readyState;e.media.src=n.getAttribute("src"),("none"!==r||o)&&(e.once("loadedmetadata",function(){e.currentTime=a,s||e.play()}),e.media.load()),y.call(e,e.media,"qualitychange",!1,{quality:t})}}})}},cancelRequests:function(){this.isHTML5&&(T($.getSources.call(this)),this.media.setAttribute("src",this.config.blankVideo),this.media.load(),this.debug.log("Cancelled network requests"))}};function z(e){return h.array(e)?e.filter(function(t,n){return e.indexOf(t)===n}):e}function W(e,t){return t.split(".").reduce(function(e,t){return e&&e[t]},e)}function G(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];if(!n.length)return e;var s=n.shift();return h.object(s)?(Object.keys(s).forEach(function(t){h.object(s[t])?(Object.keys(e).includes(t)||Object.assign(e,i({},t,{})),G(e[t],s[t])):Object.assign(e,i({},t,s[t]))}),G.apply(void 0,[e].concat(n))):e}function J(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return h.empty(e)?e:e.toString().replace(/{(\d+)}/g,function(e,t){return n[t].toString()})}function Q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return e.replace(new RegExp(t.toString().replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1"),"g"),n.toString())}function K(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toString().replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function Y(e){var t=document.createElement("div");return t.appendChild(e),t.innerHTML}var X={pip:"PIP",airplay:"AirPlay",html5:"HTML5",vimeo:"Vimeo",youtube:"YouTube"},Z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(h.empty(e)||h.empty(t))return"";var n=W(t.i18n,e);if(h.empty(n))return Object.keys(X).includes(e)?X[e]:"";var i={"{seektime}":t.seekTime,"{title}":t.title};return Object.entries(i).forEach(function(e){var t=a(e,2),i=t[0],s=t[1];n=Q(n,i,s)}),n},ee=function(){function t(n){e(this,t),this.enabled=n.config.storage.enabled,this.key=n.config.storage.key}return n(t,[{key:"get",value:function(e){if(!t.supported||!this.enabled)return null;var n=window.localStorage.getItem(this.key);if(h.empty(n))return null;var i=JSON.parse(n);return h.string(e)&&e.length?i[e]:i}},{key:"set",value:function(e){if(t.supported&&this.enabled&&h.object(e)){var n=this.get();h.empty(n)&&(n={}),G(n,e),window.localStorage.setItem(this.key,JSON.stringify(n))}}}],[{key:"supported",get:function(){try{return"localStorage"in window&&(window.localStorage.setItem("___test","___test"),window.localStorage.removeItem("___test"),!0)}catch(e){return!1}}}]),t}();function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";return new Promise(function(n,i){try{var a=new XMLHttpRequest;if(!("withCredentials"in a))return;a.addEventListener("load",function(){if("text"===t)try{n(JSON.parse(a.responseText))}catch(e){n(a.responseText)}else n(a.response)}),a.addEventListener("error",function(){throw new Error(a.status)}),a.open("GET",e,!0),a.responseType=t,a.send()}catch(e){i(e)}})}function ne(e,t){if(h.string(e)){var n=h.string(t),i=function(){return null!==document.getElementById(t)},a=function(e,t){e.innerHTML=t,n&&i()||document.body.insertAdjacentElement("afterbegin",e)};if(!n||!i()){var s=ee.supported,r=document.createElement("div");if(r.setAttribute("hidden",""),n&&r.setAttribute("id",t),s){var o=window.localStorage.getItem("".concat("cache","-").concat(t));if(null!==o){var l=JSON.parse(o);a(r,l.content)}}te(e).then(function(e){h.empty(e)||(s&&window.localStorage.setItem("".concat("cache","-").concat(t),JSON.stringify({content:e})),a(r,e))}).catch(function(){})}}}var ie=function(e){return parseInt(e/60/60%60,10)},ae=function(e){return parseInt(e/60%60,10)},se=function(e){return parseInt(e%60,10)};function re(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!h.number(e))return re(null,t,n);var i=function(e){return"0".concat(e).slice(-2)},a=ie(e),s=ae(e),r=se(e);return a=t||a>0?"".concat(a,":"):"","".concat(n&&e>0?"-":"").concat(a).concat(i(s),":").concat(i(r))}var oe={getIconUrl:function(){var e=new URL(this.config.iconUrl,window.location).host!==window.location.host||U.isIE&&!window.svg4everybody;return{url:this.config.iconUrl,cors:e}},findElements:function(){try{return this.elements.controls=V.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:O.call(this,this.config.selectors.buttons.play),pause:V.call(this,this.config.selectors.buttons.pause),restart:V.call(this,this.config.selectors.buttons.restart),rewind:V.call(this,this.config.selectors.buttons.rewind),fastForward:V.call(this,this.config.selectors.buttons.fastForward),mute:V.call(this,this.config.selectors.buttons.mute),pip:V.call(this,this.config.selectors.buttons.pip),airplay:V.call(this,this.config.selectors.buttons.airplay),settings:V.call(this,this.config.selectors.buttons.settings),captions:V.call(this,this.config.selectors.buttons.captions),fullscreen:V.call(this,this.config.selectors.buttons.fullscreen)},this.elements.progress=V.call(this,this.config.selectors.progress),this.elements.inputs={seek:V.call(this,this.config.selectors.inputs.seek),volume:V.call(this,this.config.selectors.inputs.volume)},this.elements.display={buffer:V.call(this,this.config.selectors.display.buffer),currentTime:V.call(this,this.config.selectors.display.currentTime),duration:V.call(this,this.config.selectors.display.duration)},h.element(this.elements.progress)&&(this.elements.display.seekTooltip=this.elements.progress.querySelector(".".concat(this.config.classNames.tooltip))),!0}catch(e){return this.debug.warn("It looks like there is a problem with your custom controls HTML",e),this.toggleNativeControls(!0),!1}},createIcon:function(e,t){var n=oe.getIconUrl.call(this),i="".concat(n.cors?"":n.url,"#").concat(this.config.iconPrefix),a=document.createElementNS("http://www.w3.org/2000/svg","svg");w(a,G(t,{role:"presentation",focusable:"false"}));var s=document.createElementNS("http://www.w3.org/2000/svg","use"),r="".concat(i,"-").concat(e);return"href"in s&&s.setAttributeNS("http://www.w3.org/1999/xlink","href",r),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r),a.appendChild(s),a},createLabel:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Z(e,this.config);return x("span",Object.assign({},t,{class:[t.class,this.config.classNames.hidden].filter(Boolean).join(" ")}),n)},createBadge:function(e){if(h.empty(e))return null;var t=x("span",{class:this.config.classNames.menu.value});return t.appendChild(x("span",{class:this.config.classNames.menu.badge},e)),t},createButton:function(e,t){var n=Object.assign({},t),i=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toString();return(e=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toString();return e=Q(e,"-"," "),e=Q(e,"_"," "),Q(e=K(e)," ","")}(e)).charAt(0).toLowerCase()+e.slice(1)}(e),a={element:"button",toggle:!1,label:null,icon:null,labelPressed:null,iconPressed:null};switch(["element","icon","label"].forEach(function(e){Object.keys(n).includes(e)&&(a[e]=n[e],delete n[e])}),"button"!==a.element||Object.keys(n).includes("type")||(n.type="button"),Object.keys(n).includes("class")?n.class.includes(this.config.classNames.control)||(n.class+=" ".concat(this.config.classNames.control)):n.class=this.config.classNames.control,e){case"play":a.toggle=!0,a.label="play",a.labelPressed="pause",a.icon="play",a.iconPressed="pause";break;case"mute":a.toggle=!0,a.label="mute",a.labelPressed="unmute",a.icon="volume",a.iconPressed="muted";break;case"captions":a.toggle=!0,a.label="enableCaptions",a.labelPressed="disableCaptions",a.icon="captions-off",a.iconPressed="captions-on";break;case"fullscreen":a.toggle=!0,a.label="enterFullscreen",a.labelPressed="exitFullscreen",a.icon="enter-fullscreen",a.iconPressed="exit-fullscreen";break;case"play-large":n.class+=" ".concat(this.config.classNames.control,"--overlaid"),i="play",a.label="play",a.icon="play";break;default:h.empty(a.label)&&(a.label=i),h.empty(a.icon)&&(a.icon=e)}var s=x(a.element);return a.toggle?(s.appendChild(oe.createIcon.call(this,a.iconPressed,{class:"icon--pressed"})),s.appendChild(oe.createIcon.call(this,a.icon,{class:"icon--not-pressed"})),s.appendChild(oe.createLabel.call(this,a.labelPressed,{class:"label--pressed"})),s.appendChild(oe.createLabel.call(this,a.label,{class:"label--not-pressed"}))):(s.appendChild(oe.createIcon.call(this,a.icon)),s.appendChild(oe.createLabel.call(this,a.label))),G(n,N(this.config.selectors.buttons[i],n)),w(s,n),"play"===i?(h.array(this.elements.buttons[i])||(this.elements.buttons[i]=[]),this.elements.buttons[i].push(s)):this.elements.buttons[i]=s,s},createRange:function(e,t){var n=x("input",G(N(this.config.selectors.inputs[e]),{type:"range",min:0,max:100,step:.01,value:0,autocomplete:"off",role:"slider","aria-label":Z(e,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},t));return this.elements.inputs[e]=n,oe.updateRangeFill.call(this,n),n},createProgress:function(e,t){var n=x("progress",G(N(this.config.selectors.display[e]),{min:0,max:100,value:0,role:"presentation","aria-hidden":!0},t));if("volume"!==e){n.appendChild(x("span",null,"0"));var i={played:"played",buffer:"buffered"}[e],a=i?Z(i,this.config):"";n.innerText="% ".concat(a.toLowerCase())}return this.elements.display[e]=n,n},createTime:function(e){var t=N(this.config.selectors.display[e]),n=x("div",G(t,{class:"".concat(this.config.classNames.display.time," ").concat(t.class?t.class:"").trim(),"aria-label":Z(e,this.config)}),"00:00");return this.elements.display[e]=n,n},bindMenuItemShortcuts:function(e,t){var n=this;v(e,"keydown keyup",function(i){if([32,38,39,40].includes(i.which)&&(i.preventDefault(),i.stopPropagation(),"keydown"!==i.type)){var a,s=L(e,'[role="menuitemradio"]');!s&&[32,39].includes(i.which)?oe.showMenuPanel.call(n,t,!0):32!==i.which&&(40===i.which||s&&39===i.which?(a=e.nextElementSibling,h.element(a)||(a=e.parentNode.firstElementChild)):(a=e.previousElementSibling,h.element(a)||(a=e.parentNode.lastElementChild)),I.call(n,a,!0))}},!1),v(e,"keyup",function(e){13===e.which&&oe.focusFirstMenuItem.call(n,null,!0)})},createMenuItem:function(e){var t=this,n=e.value,i=e.list,a=e.type,s=e.title,r=e.badge,o=void 0===r?null:r,l=e.checked,c=void 0!==l&&l,u=N(this.config.selectors.inputs[a]),d=x("button",G(u,{type:"button",role:"menuitemradio",class:"".concat(this.config.classNames.control," ").concat(u.class?u.class:"").trim(),"aria-checked":c,value:n})),p=x("span");p.innerHTML=s,h.element(o)&&p.appendChild(o),d.appendChild(p),Object.defineProperty(d,"checked",{enumerable:!0,get:function(){return"true"===d.getAttribute("aria-checked")},set:function(e){e&&Array.from(d.parentNode.children).filter(function(e){return L(e,'[role="menuitemradio"]')}).forEach(function(e){return e.setAttribute("aria-checked","false")}),d.setAttribute("aria-checked",e?"true":"false")}}),this.listeners.bind(d,"click keyup",function(e){if(!h.keyboardEvent(e)||32===e.which){switch(e.preventDefault(),e.stopPropagation(),d.checked=!0,a){case"language":t.currentTrack=Number(n);break;case"quality":t.quality=n;break;case"speed":t.speed=parseFloat(n)}oe.showMenuPanel.call(t,"home",h.keyboardEvent(e))}},a,!1),oe.bindMenuItemShortcuts.call(this,d,a),i.appendChild(d)},formatTime:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return h.number(e)?re(e,ie(this.duration)>0,t):e},updateTimeDisplay:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];h.element(e)&&h.number(t)&&(e.innerText=oe.formatTime(t,n))},updateVolume:function(){this.supported.ui&&(h.element(this.elements.inputs.volume)&&oe.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),h.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||0===this.volume))},setRange:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;h.element(e)&&(e.value=t,oe.updateRangeFill.call(this,e))},updateProgress:function(e){var t=this;if(this.supported.ui&&h.event(e)){var n,i,a=0;if(e)switch(e.type){case"timeupdate":case"seeking":case"seeked":n=this.currentTime,i=this.duration,a=0===n||0===i||Number.isNaN(n)||Number.isNaN(i)?0:(n/i*100).toFixed(2),"timeupdate"===e.type&&oe.setRange.call(this,this.elements.inputs.seek,a);break;case"playing":case"progress":!function(e,n){var i=h.number(n)?n:0,a=h.element(e)?e:t.elements.display.buffer;if(h.element(a)){a.value=i;var s=a.getElementsByTagName("span")[0];h.element(s)&&(s.childNodes[0].nodeValue=i)}}(this.elements.display.buffer,100*this.buffered)}}},updateRangeFill:function(e){var t=h.event(e)?e.target:e;if(h.element(t)&&"range"===t.getAttribute("type")){if(L(t,this.config.selectors.inputs.seek)){t.setAttribute("aria-valuenow",this.currentTime);var n=oe.formatTime(this.currentTime),i=oe.formatTime(this.duration),a=Z("seekLabel",this.config);t.setAttribute("aria-valuetext",a.replace("{currentTime}",n).replace("{duration}",i))}else if(L(t,this.config.selectors.inputs.volume)){var s=100*t.value;t.setAttribute("aria-valuenow",s),t.setAttribute("aria-valuetext","".concat(s.toFixed(1),"%"))}else t.setAttribute("aria-valuenow",t.value);U.isWebkit&&t.style.setProperty("--value","".concat(t.value/t.max*100,"%"))}},updateSeekTooltip:function(e){var t=this;if(this.config.tooltips.seek&&h.element(this.elements.inputs.seek)&&h.element(this.elements.display.seekTooltip)&&0!==this.duration){var n=0,i=this.elements.progress.getBoundingClientRect(),a="".concat(this.config.classNames.tooltip,"--visible"),s=function(e){A(t.elements.display.seekTooltip,a,e)};if(this.touch)s(!1);else{if(h.event(e))n=100/i.width*(e.pageX-i.left);else{if(!E(this.elements.display.seekTooltip,a))return;n=parseFloat(this.elements.display.seekTooltip.style.left,10)}n<0?n=0:n>100&&(n=100),oe.updateTimeDisplay.call(this,this.elements.display.seekTooltip,this.duration/100*n),this.elements.display.seekTooltip.style.left="".concat(n,"%"),h.event(e)&&["mouseenter","mouseleave"].includes(e.type)&&s("mouseenter"===e.type)}}},timeUpdate:function(e){var t=!h.element(this.elements.display.duration)&&this.config.invertTime;oe.updateTimeDisplay.call(this,this.elements.display.currentTime,t?this.duration-this.currentTime:this.currentTime,t),e&&"timeupdate"===e.type&&this.media.seeking||oe.updateProgress.call(this,e)},durationUpdate:function(){if(this.supported.ui&&(this.config.invertTime||!this.currentTime)){if(this.duration>=Math.pow(2,32))return S(this.elements.display.currentTime,!0),void S(this.elements.progress,!0);h.element(this.elements.inputs.seek)&&this.elements.inputs.seek.setAttribute("aria-valuemax",this.duration);var e=h.element(this.elements.display.duration);!e&&this.config.displayDuration&&this.paused&&oe.updateTimeDisplay.call(this,this.elements.display.currentTime,this.duration),e&&oe.updateTimeDisplay.call(this,this.elements.display.duration,this.duration),oe.updateSeekTooltip.call(this)}},toggleMenuButton:function(e,t){S(this.elements.settings.buttons[e],!t)},updateSetting:function(e,t,n){var i=this.elements.settings.panels[e],a=null,s=t;if("captions"===e)a=this.currentTrack;else{if(a=h.empty(n)?this[e]:n,h.empty(a)&&(a=this.config[e].default),!h.empty(this.options[e])&&!this.options[e].includes(a))return void this.debug.warn("Unsupported value of '".concat(a,"' for ").concat(e));if(!this.config[e].options.includes(a))return void this.debug.warn("Disabled value of '".concat(a,"' for ").concat(e))}if(h.element(s)||(s=i&&i.querySelector('[role="menu"]')),h.element(s)){this.elements.settings.buttons[e].querySelector(".".concat(this.config.classNames.menu.value)).innerHTML=oe.getLabel.call(this,e,a);var r=s&&s.querySelector('[value="'.concat(a,'"]'));h.element(r)&&(r.checked=!0)}},getLabel:function(e,t){switch(e){case"speed":return 1===t?Z("normal",this.config):"".concat(t,"&times;");case"quality":if(h.number(t)){var n=Z("qualityLabel.".concat(t),this.config);return n.length?n:"".concat(t,"p")}return K(t);case"captions":return ue.getLabel.call(this);default:return null}},setQualityMenu:function(e){var t=this;if(h.element(this.elements.settings.panels.quality)){var n=this.elements.settings.panels.quality.querySelector('[role="menu"]');h.array(e)&&(this.options.quality=z(e).filter(function(e){return t.config.quality.options.includes(e)}));var i=!h.empty(this.options.quality)&&this.options.quality.length>1;oe.toggleMenuButton.call(this,"quality",i),C(n),oe.checkMenu.call(this),i&&(this.options.quality.sort(function(e,n){var i=t.config.quality.options;return i.indexOf(e)>i.indexOf(n)?1:-1}).forEach(function(e){oe.createMenuItem.call(t,{value:e,list:n,type:"quality",title:oe.getLabel.call(t,"quality",e),badge:function(e){var n=Z("qualityBadge.".concat(e),t.config);return n.length?oe.createBadge.call(t,n):null}(e)})}),oe.updateSetting.call(this,"quality",n))}},setCaptionsMenu:function(){var e=this;if(h.element(this.elements.settings.panels.captions)){var t=this.elements.settings.panels.captions.querySelector('[role="menu"]'),n=ue.getTracks.call(this),i=Boolean(n.length);if(oe.toggleMenuButton.call(this,"captions",i),C(t),oe.checkMenu.call(this),i){var a=n.map(function(n,i){return{value:i,checked:e.captions.toggled&&e.currentTrack===i,title:ue.getLabel.call(e,n),badge:n.language&&oe.createBadge.call(e,n.language.toUpperCase()),list:t,type:"language"}});a.unshift({value:-1,checked:!this.captions.toggled,title:Z("disabled",this.config),list:t,type:"language"}),a.forEach(oe.createMenuItem.bind(this)),oe.updateSetting.call(this,"captions",t)}}},setSpeedMenu:function(e){var t=this;if(h.element(this.elements.settings.panels.speed)){var n=this.elements.settings.panels.speed.querySelector('[role="menu"]');h.array(e)?this.options.speed=e:(this.isHTML5||this.isVimeo)&&(this.options.speed=[.5,.75,1,1.25,1.5,1.75,2]),this.options.speed=this.options.speed.filter(function(e){return t.config.speed.options.includes(e)});var i=!h.empty(this.options.speed)&&this.options.speed.length>1;oe.toggleMenuButton.call(this,"speed",i),C(n),oe.checkMenu.call(this),i&&(this.options.speed.forEach(function(e){oe.createMenuItem.call(t,{value:e,list:n,type:"speed",title:oe.getLabel.call(t,"speed",e)})}),oe.updateSetting.call(this,"speed",n))}},checkMenu:function(){var e=this.elements.settings.buttons,t=!h.empty(e)&&Object.values(e).some(function(e){return!e.hidden});S(this.elements.settings.menu,!t)},focusFirstMenuItem:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.elements.settings.popup.hidden){var n=e;h.element(n)||(n=Object.values(this.elements.settings.panels).find(function(e){return!e.hidden}));var i=n.querySelector('[role^="menuitem"]');I.call(this,i,t)}},toggleMenu:function(e){var t=this.elements.settings.popup,n=this.elements.buttons.settings;if(h.element(t)&&h.element(n)){var i=t.hidden,a=i;if(h.boolean(e))a=e;else if(h.keyboardEvent(e)&&27===e.which)a=!1;else if(h.event(e)){var s=t.contains(e.target);if(s||!s&&e.target!==n&&a)return}n.setAttribute("aria-expanded",a),S(t,!a),A(this.elements.container,this.config.classNames.menu.open,a),a&&h.keyboardEvent(e)?oe.focusFirstMenuItem.call(this,null,!0):a||i||I.call(this,n,h.keyboardEvent(e))}},getMenuSize:function(e){var t=e.cloneNode(!0);t.style.position="absolute",t.style.opacity=0,t.removeAttribute("hidden"),e.parentNode.appendChild(t);var n=t.scrollWidth,i=t.scrollHeight;return T(t),{width:n,height:i}},showMenuPanel:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=document.getElementById("plyr-settings-".concat(this.id,"-").concat(t));if(h.element(i)){var a=i.parentNode,s=Array.from(a.children).find(function(e){return!e.hidden});if(j.transitions&&!j.reducedMotion){a.style.width="".concat(s.scrollWidth,"px"),a.style.height="".concat(s.scrollHeight,"px");var r=oe.getMenuSize.call(this,i);v.call(this,a,q,function t(n){n.target===a&&["width","height"].includes(n.propertyName)&&(a.style.width="",a.style.height="",b.call(e,a,q,t))}),a.style.width="".concat(r.width,"px"),a.style.height="".concat(r.height,"px")}S(s,!0),S(i,!1),oe.focusFirstMenuItem.call(this,i,n)}},setDownloadLink:function(){var e=this.elements.buttons.download;h.element(e)&&e.setAttribute("href",this.download)},create:function(e){var t=this,n=x("div",N(this.config.selectors.controls.wrapper));if(this.config.controls.includes("restart")&&n.appendChild(oe.createButton.call(this,"restart")),this.config.controls.includes("rewind")&&n.appendChild(oe.createButton.call(this,"rewind")),this.config.controls.includes("play")&&n.appendChild(oe.createButton.call(this,"play")),this.config.controls.includes("fast-forward")&&n.appendChild(oe.createButton.call(this,"fast-forward")),this.config.controls.includes("progress")){var i=x("div",N(this.config.selectors.progress));if(i.appendChild(oe.createRange.call(this,"seek",{id:"plyr-seek-".concat(e.id)})),i.appendChild(oe.createProgress.call(this,"buffer")),this.config.tooltips.seek){var a=x("span",{class:this.config.classNames.tooltip},"00:00");i.appendChild(a),this.elements.display.seekTooltip=a}this.elements.progress=i,n.appendChild(this.elements.progress)}if(this.config.controls.includes("current-time")&&n.appendChild(oe.createTime.call(this,"currentTime")),this.config.controls.includes("duration")&&n.appendChild(oe.createTime.call(this,"duration")),this.config.controls.includes("mute")||this.config.controls.includes("volume")){var s=x("div",{class:"plyr__volume"});if(this.config.controls.includes("mute")&&s.appendChild(oe.createButton.call(this,"mute")),this.config.controls.includes("volume")){var r={max:1,step:.05,value:this.config.volume};s.appendChild(oe.createRange.call(this,"volume",G(r,{id:"plyr-volume-".concat(e.id)}))),this.elements.volume=s}n.appendChild(s)}if(this.config.controls.includes("captions")&&n.appendChild(oe.createButton.call(this,"captions")),this.config.controls.includes("settings")&&!h.empty(this.config.settings)){var o=x("div",{class:"plyr__menu",hidden:""});o.appendChild(oe.createButton.call(this,"settings",{"aria-haspopup":!0,"aria-controls":"plyr-settings-".concat(e.id),"aria-expanded":!1}));var l=x("div",{class:"plyr__menu__container",id:"plyr-settings-".concat(e.id),hidden:""}),c=x("div"),u=x("div",{id:"plyr-settings-".concat(e.id,"-home")}),d=x("div",{role:"menu"});u.appendChild(d),c.appendChild(u),this.elements.settings.panels.home=u,this.config.settings.forEach(function(n){var i=x("button",G(N(t.config.selectors.buttons.settings),{type:"button",class:"".concat(t.config.classNames.control," ").concat(t.config.classNames.control,"--forward"),role:"menuitem","aria-haspopup":!0,hidden:""}));oe.bindMenuItemShortcuts.call(t,i,n),v(i,"click",function(){oe.showMenuPanel.call(t,n,!1)});var a=x("span",null,Z(n,t.config)),s=x("span",{class:t.config.classNames.menu.value});s.innerHTML=e[n],a.appendChild(s),i.appendChild(a),d.appendChild(i);var r=x("div",{id:"plyr-settings-".concat(e.id,"-").concat(n),hidden:""}),o=x("button",{type:"button",class:"".concat(t.config.classNames.control," ").concat(t.config.classNames.control,"--back")});o.appendChild(x("span",{"aria-hidden":!0},Z(n,t.config))),o.appendChild(x("span",{class:t.config.classNames.hidden},Z("menuBack",t.config))),v(r,"keydown",function(e){37===e.which&&(e.preventDefault(),e.stopPropagation(),oe.showMenuPanel.call(t,"home",!0))},!1),v(o,"click",function(){oe.showMenuPanel.call(t,"home",!1)}),r.appendChild(o),r.appendChild(x("div",{role:"menu"})),c.appendChild(r),t.elements.settings.buttons[n]=i,t.elements.settings.panels[n]=r}),l.appendChild(c),o.appendChild(l),n.appendChild(o),this.elements.settings.popup=l,this.elements.settings.menu=o}if(this.config.controls.includes("pip")&&j.pip&&n.appendChild(oe.createButton.call(this,"pip")),this.config.controls.includes("airplay")&&j.airplay&&n.appendChild(oe.createButton.call(this,"airplay")),this.config.controls.includes("download")){var p={element:"a",href:this.download,target:"_blank"},m=this.config.urls.download;!h.url(m)&&this.isEmbed&&G(p,{icon:"logo-".concat(this.provider),label:this.provider}),n.appendChild(oe.createButton.call(this,"download",p))}return this.config.controls.includes("fullscreen")&&n.appendChild(oe.createButton.call(this,"fullscreen")),this.config.controls.includes("play-large")&&this.elements.container.appendChild(oe.createButton.call(this,"play-large")),this.elements.controls=n,this.isHTML5&&oe.setQualityMenu.call(this,$.getQualityOptions.call(this)),oe.setSpeedMenu.call(this),n},inject:function(){var e=this;if(this.config.loadSprite){var t=oe.getIconUrl.call(this);t.cors&&ne(t.url,"sprite-plyr")}this.id=Math.floor(1e4*Math.random());var n=null;this.elements.controls=null;var i={id:this.id,seektime:this.config.seekTime,title:this.config.title},s=!0;h.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this.props)),this.config.controls||(this.config.controls=[]),h.element(this.config.controls)||h.string(this.config.controls)?n=this.config.controls:(n=oe.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality,captions:ue.getLabel.call(this)}),s=!1);var r,o=function(e){var t=e;return Object.entries(i).forEach(function(e){var n=a(e,2),i=n[0],s=n[1];t=Q(t,"{".concat(i,"}"),s)}),t};if(s&&(h.string(this.config.controls)?n=o(n):h.element(n)&&(n.innerHTML=o(n.innerHTML))),h.string(this.config.selectors.controls.container)&&(r=document.querySelector(this.config.selectors.controls.container)),h.element(r)||(r=this.elements.container),r[h.element(n)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",n),h.element(this.elements.controls)||oe.findElements.call(this),!h.empty(this.elements.buttons)){var l=function(t){var n=e.config.classNames.controlPressed;Object.defineProperty(t,"pressed",{enumerable:!0,get:function(){return E(t,n)},set:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];A(t,n,e)}})};Object.values(this.elements.buttons).filter(Boolean).forEach(function(e){h.array(e)||h.nodeList(e)?Array.from(e).filter(Boolean).forEach(l):l(e)})}if(window.navigator.userAgent.includes("Edge")&&D(r),this.config.tooltips.controls){var c=this.config,u=c.classNames,d=c.selectors,p="".concat(d.controls.wrapper," ").concat(d.labels," .").concat(u.hidden),m=O.call(this,p);Array.from(m).forEach(function(t){A(t,e.config.classNames.hidden,!1),A(t,e.config.classNames.tooltip,!0)})}}};function le(e){var t=e;if(!(arguments.length>1&&void 0!==arguments[1])||arguments[1]){var n=document.createElement("a");n.href=t,t=n.href}try{return new URL(t)}catch(e){return null}}function ce(e){var t=new URLSearchParams;return h.object(e)&&Object.entries(e).forEach(function(e){var n=a(e,2),i=n[0],s=n[1];t.set(i,s)}),t}var ue={setup:function(){if(this.supported.ui)if(!this.isVideo||this.isYouTube||this.isHTML5&&!j.textTracks)h.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&oe.setCaptionsMenu.call(this);else{var e,t;if(h.element(this.elements.captions)||(this.elements.captions=x("div",N(this.config.selectors.captions)),e=this.elements.captions,t=this.elements.wrapper,h.element(e)&&h.element(t)&&t.parentNode.insertBefore(e,t.nextSibling)),U.isIE&&window.URL){var n=this.media.querySelectorAll("track");Array.from(n).forEach(function(e){var t=e.getAttribute("src"),n=le(t);null!==n&&n.hostname!==window.location.href.hostname&&["http:","https:"].includes(n.protocol)&&te(t,"blob").then(function(t){e.setAttribute("src",window.URL.createObjectURL(t))}).catch(function(){T(e)})})}var i=z((navigator.languages||[navigator.language||navigator.userLanguage||"en"]).map(function(e){return e.split("-")[0]})),s=(this.storage.get("language")||this.config.captions.language||"auto").toLowerCase();"auto"===s&&(s=a(i,1)[0]);var r=this.storage.get("captions");if(h.boolean(r)||(r=this.config.captions.active),Object.assign(this.captions,{toggled:!1,active:r,language:s,languages:i}),this.isHTML5){var o=this.config.captions.update?"addtrack removetrack":"removetrack";v.call(this,this.media.textTracks,o,ue.update.bind(this))}setTimeout(ue.update.bind(this),0)}},update:function(){var e=this,t=ue.getTracks.call(this,!0),n=this.captions,i=n.active,a=n.language,s=n.meta,r=n.currentTrackNode,o=Boolean(t.find(function(e){return e.language===a}));this.isHTML5&&this.isVideo&&t.filter(function(e){return!s.get(e)}).forEach(function(t){e.debug.log("Track added",t),s.set(t,{default:"showing"===t.mode}),t.mode="hidden",v.call(e,t,"cuechange",function(){return ue.updateCues.call(e)})}),(o&&this.language!==a||!t.includes(r))&&(ue.setLanguage.call(this,a),ue.toggle.call(this,i&&o)),A(this.elements.container,this.config.classNames.captions.enabled,!h.empty(t)),(this.config.controls||[]).includes("settings")&&this.config.settings.includes("captions")&&oe.setCaptionsMenu.call(this)},toggle:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.supported.ui){var n=this.captions.toggled,i=this.config.classNames.captions.active,a=h.nullOrUndefined(e)?!n:e;if(a!==n){if(t||(this.captions.active=a,this.storage.set({captions:a})),!this.language&&a&&!t){var s=ue.getTracks.call(this),r=ue.findTrack.call(this,[this.captions.language].concat(function(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(this.captions.languages)),!0);return this.captions.language=r.language,void ue.set.call(this,s.indexOf(r))}this.elements.buttons.captions&&(this.elements.buttons.captions.pressed=a),A(this.elements.container,i,a),this.captions.toggled=a,oe.updateSetting.call(this,"captions"),y.call(this,this.media,a?"captionsenabled":"captionsdisabled")}}},set:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=ue.getTracks.call(this);if(-1!==e)if(h.number(e))if(e in n){if(this.captions.currentTrack!==e){this.captions.currentTrack=e;var i=n[e],a=(i||{}).language;this.captions.currentTrackNode=i,oe.updateSetting.call(this,"captions"),t||(this.captions.language=a,this.storage.set({language:a})),this.isVimeo&&this.embed.enableTextTrack(a),y.call(this,this.media,"languagechange")}ue.toggle.call(this,!0,t),this.isHTML5&&this.isVideo&&ue.updateCues.call(this)}else this.debug.warn("Track not found",e);else this.debug.warn("Invalid caption argument",e);else ue.toggle.call(this,!1,t)},setLanguage:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(h.string(e)){var n=e.toLowerCase();this.captions.language=n;var i=ue.getTracks.call(this),a=ue.findTrack.call(this,[n]);ue.set.call(this,i.indexOf(a),t)}else this.debug.warn("Invalid language argument",e)},getTracks:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Array.from((this.media||{}).textTracks||[]).filter(function(n){return!e.isHTML5||t||e.captions.meta.has(n)}).filter(function(e){return["captions","subtitles"].includes(e.kind)})},findTrack:function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=ue.getTracks.call(this),s=function(e){return Number((n.captions.meta.get(e)||{}).default)},r=Array.from(a).sort(function(e,t){return s(t)-s(e)});return e.every(function(e){return!(t=r.find(function(t){return t.language===e}))}),t||(i?r[0]:void 0)},getCurrentTrack:function(){return ue.getTracks.call(this)[this.currentTrack]},getLabel:function(e){var t=e;return!h.track(t)&&j.textTracks&&this.captions.toggled&&(t=ue.getCurrentTrack.call(this)),h.track(t)?h.empty(t.label)?h.empty(t.language)?Z("enabled",this.config):e.language.toUpperCase():t.label:Z("disabled",this.config)},updateCues:function(e){if(this.supported.ui)if(h.element(this.elements.captions))if(h.nullOrUndefined(e)||Array.isArray(e)){var t=e;if(!t){var n=ue.getCurrentTrack.call(this);t=Array.from((n||{}).activeCues||[]).map(function(e){return e.getCueAsHTML()}).map(Y)}var i=t.map(function(e){return e.trim()}).join("\n");if(i!==this.elements.captions.innerHTML){C(this.elements.captions);var a=x("span",N(this.config.selectors.caption));a.innerHTML=i,this.elements.captions.appendChild(a),y.call(this,this.media,"cuechange")}}else this.debug.warn("updateCues: Invalid input",e);else this.debug.warn("No captions element to render to")}},de={enabled:!0,title:"",debug:!1,autoplay:!1,autopause:!0,playsinline:!0,seekTime:10,volume:1,muted:!1,duration:null,displayDuration:!0,invertTime:!0,toggleInvert:!0,ratio:"16:9",clickToPlay:!0,hideControls:!0,resetOnEnd:!1,disableContextMenu:!0,loadSprite:!0,iconPrefix:"plyr",iconUrl:"https://cdn.plyr.io/3.4.7/plyr.svg",blankVideo:"https://cdn.plyr.io/static/blank.mp4",quality:{default:576,options:[4320,2880,2160,1440,1080,720,576,480,360,240]},loop:{active:!1},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2]},keyboard:{focused:!0,global:!1},tooltips:{controls:!1,seek:!0},captions:{active:!1,language:"auto",update:!1},fullscreen:{enabled:!0,fallback:!0,iosNative:!1},storage:{enabled:!0,key:"plyr"},controls:["play-large","play","progress","current-time","mute","volume","captions","settings","pip","airplay","fullscreen"],settings:["captions","quality","speed"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Enable captions",disableCaptions:"Disable captions",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop",start:"Start",end:"End",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",advertisement:"Ad",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"}},urls:{download:null,vimeo:{sdk:"https://player.vimeo.com/api/player.js",iframe:"https://player.vimeo.com/video/{0}?{1}",api:"https://vimeo.com/api/v2/video/{0}.json"},youtube:{sdk:"https://www.youtube.com/iframe_api",api:"https://www.googleapis.com/youtube/v3/videos?id={0}&key={1}&fields=items(snippet(title))&part=snippet"},googleIMA:{sdk:"https://imasdk.googleapis.com/js/sdkloader/ima3.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,fastForward:null,mute:null,volume:null,captions:null,download:null,fullscreen:null,pip:null,airplay:null,speed:null,quality:null,loop:null,language:null},events:["ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied","ratechange","cuechange","download","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled","languagechange","controlshidden","controlsshown","ready","statechange","qualitychange","adsloaded","adscontentpause","adscontentresume","adstarted","adsmidpoint","adscomplete","adsallcomplete","adsimpression","adsclick"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls"},labels:"[data-plyr]",buttons:{play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',fastForward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',download:'[data-plyr="download"]',fullscreen:'[data-plyr="fullscreen"]',pip:'[data-plyr="pip"]',airplay:'[data-plyr="airplay"]',settings:'[data-plyr="settings"]',loop:'[data-plyr="loop"]'},inputs:{seek:'[data-plyr="seek"]',volume:'[data-plyr="volume"]',speed:'[data-plyr="speed"]',language:'[data-plyr="language"]',quality:'[data-plyr="quality"]'},display:{currentTime:".plyr__time--current",duration:".plyr__time--duration",buffer:".plyr__progress__buffer",loop:".plyr__progress__loop",volume:".plyr__volume--display"},progress:".plyr__progress",captions:".plyr__captions",caption:".plyr__caption",menu:{quality:".js-plyr__menu__list--quality"}},classNames:{type:"plyr--{0}",provider:"plyr--{0}",video:"plyr__video-wrapper",embed:"plyr__video-embed",embedContainer:"plyr__video-embed__container",poster:"plyr__poster",posterEnabled:"plyr__poster-enabled",ads:"plyr__ads",control:"plyr__control",controlPressed:"plyr__control--pressed",playing:"plyr--playing",paused:"plyr--paused",stopped:"plyr--stopped",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",cues:"plyr__cues",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isIos:"plyr--is-ios",isTouch:"plyr--is-touch",uiSupported:"plyr--full-ui",noTransition:"plyr--no-transition",display:{time:"plyr__time"},menu:{value:"plyr__menu__value",badge:"plyr__badge",open:"plyr--menu-open"},captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},fullscreen:{enabled:"plyr--fullscreen-enabled",fallback:"plyr--fullscreen-fallback"},pip:{supported:"plyr--pip-supported",active:"plyr--pip-active"},airplay:{supported:"plyr--airplay-supported",active:"plyr--airplay-active"},tabFocus:"plyr__tab-focus"},attributes:{embed:{provider:"data-plyr-provider",id:"data-plyr-embed-id"}},keys:{google:null},ads:{enabled:!1,publisherId:""}},pe="picture-in-picture",he={html5:"html5",youtube:"youtube",vimeo:"vimeo"},me={audio:"audio",video:"video"},fe=function(){},ve=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e(this,t),this.enabled=window.console&&n,this.enabled&&this.log("Debugging enabled")}return n(t,[{key:"log",get:function(){return this.enabled?Function.prototype.bind.call(console.log,console):fe}},{key:"warn",get:function(){return this.enabled?Function.prototype.bind.call(console.warn,console):fe}},{key:"error",get:function(){return this.enabled?Function.prototype.bind.call(console.error,console):fe}}]),t}();function be(){if(this.enabled){var e=this.player.elements.buttons.fullscreen;h.element(e)&&(e.pressed=this.active),y.call(this.player,this.target,this.active?"enterfullscreen":"exitfullscreen",!0),U.isIos||function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(h.element(e)){var n=O.call(this,"button:not(:disabled), input:not(:disabled), [tabindex]"),i=n[0],a=n[n.length-1];f.call(this,this.elements.container,"keydown",function(e){if("Tab"===e.key&&9===e.keyCode){var t=document.activeElement;t!==a||e.shiftKey?t===i&&e.shiftKey&&(a.focus(),e.preventDefault()):(i.focus(),e.preventDefault())}},t,!1)}}.call(this.player,this.target,this.active)}}function ge(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t?this.scrollPosition={x:window.scrollX||0,y:window.scrollY||0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=t?"hidden":"",A(this.target,this.player.config.classNames.fullscreen.fallback,t),U.isIos){var n=document.head.querySelector('meta[name="viewport"]'),i="viewport-fit=cover";n||(n=document.createElement("meta")).setAttribute("name","viewport");var a=h.string(n.content)&&n.content.includes(i);t?(this.cleanupViewport=!a,a||(n.content+=",".concat(i))):this.cleanupViewport&&(n.content=n.content.split(",").filter(function(e){return e.trim()!==i}).join(",")),setTimeout(function(){return D(e.target)},100)}be.call(this)}var ye=function(){function t(n){var i=this;e(this,t),this.player=n,this.prefix=t.prefix,this.property=t.property,this.scrollPosition={x:0,y:0},v.call(this.player,document,"ms"===this.prefix?"MSFullscreenChange":"".concat(this.prefix,"fullscreenchange"),function(){be.call(i)}),v.call(this.player,this.player.elements.container,"dblclick",function(e){h.element(i.player.elements.controls)&&i.player.elements.controls.contains(e.target)||i.toggle()}),this.update()}return n(t,[{key:"update",value:function(){this.enabled?this.player.debug.log("".concat(t.native?"Native":"Fallback"," fullscreen enabled")):this.player.debug.log("Fullscreen not supported and fallback disabled"),A(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.enabled)}},{key:"enter",value:function(){this.enabled&&(U.isIos&&this.player.config.fullscreen.iosNative?this.target.webkitEnterFullscreen():t.native?this.prefix?h.empty(this.prefix)||this.target["".concat(this.prefix,"Request").concat(this.property)]():this.target.requestFullscreen():ge.call(this,!0))}},{key:"exit",value:function(){if(this.enabled)if(U.isIos&&this.player.config.fullscreen.iosNative)this.target.webkitExitFullscreen(),this.player.play();else if(t.native)if(this.prefix){if(!h.empty(this.prefix)){var e="moz"===this.prefix?"Cancel":"Exit";document["".concat(this.prefix).concat(e).concat(this.property)]()}}else(document.cancelFullScreen||document.exitFullscreen).call(document);else ge.call(this,!1)}},{key:"toggle",value:function(){this.active?this.exit():this.enter()}},{key:"enabled",get:function(){return(t.native||this.player.config.fullscreen.fallback)&&this.player.config.fullscreen.enabled&&this.player.supported.ui&&this.player.isVideo}},{key:"active",get:function(){return!!this.enabled&&(t.native?(this.prefix?document["".concat(this.prefix).concat(this.property,"Element")]:document.fullscreenElement)===this.target:E(this.target,this.player.config.classNames.fullscreen.fallback))}},{key:"target",get:function(){return U.isIos&&this.player.config.fullscreen.iosNative?this.player.media:this.player.elements.container}}],[{key:"native",get:function(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}},{key:"prefix",get:function(){if(h.function(document.exitFullscreen))return"";var e="";return["webkit","moz","ms"].some(function(t){return!(!h.function(document["".concat(t,"ExitFullscreen")])&&!h.function(document["".concat(t,"CancelFullScreen")])||(e=t,0))}),e}},{key:"property",get:function(){return"moz"===this.prefix?"FullScreen":"Fullscreen"}}]),t}();function ke(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Promise(function(n,i){var a=new Image,s=function(){delete a.onload,delete a.onerror,(a.naturalWidth>=t?n:i)(a)};Object.assign(a,{onload:s,onerror:s,src:e})})}var we,xe={addStyleHook:function(){A(this.elements.container,this.config.selectors.container.replace(".",""),!0),A(this.elements.container,this.config.classNames.uiSupported,this.supported.ui)},toggleNativeControls:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.isHTML5?this.media.setAttribute("controls",""):this.media.removeAttribute("controls")},build:function(){var e=this;if(this.listeners.media(),!this.supported.ui)return this.debug.warn("Basic support only for ".concat(this.provider," ").concat(this.type)),void xe.toggleNativeControls.call(this,!0);h.element(this.elements.controls)||(oe.inject.call(this),this.listeners.controls()),xe.toggleNativeControls.call(this),this.isHTML5&&ue.setup.call(this),this.volume=null,this.muted=null,this.speed=null,this.loop=null,this.quality=null,oe.updateVolume.call(this),oe.timeUpdate.call(this),xe.checkPlaying.call(this),A(this.elements.container,this.config.classNames.pip.supported,j.pip&&this.isHTML5&&this.isVideo),A(this.elements.container,this.config.classNames.airplay.supported,j.airplay&&this.isHTML5),A(this.elements.container,this.config.classNames.isIos,U.isIos),A(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0,setTimeout(function(){y.call(e,e.media,"ready")},0),xe.setTitle.call(this),this.poster&&xe.setPoster.call(this,this.poster,!1).catch(function(){}),this.config.duration&&oe.durationUpdate.call(this)},setTitle:function(){var e=Z("play",this.config);if(h.string(this.config.title)&&!h.empty(this.config.title)&&(e+=", ".concat(this.config.title)),Array.from(this.elements.buttons.play||[]).forEach(function(t){t.setAttribute("aria-label",e)}),this.isEmbed){var t=V.call(this,"iframe");if(!h.element(t))return;var n=h.empty(this.config.title)?"video":this.config.title,i=Z("frameTitle",this.config);t.setAttribute("title",i.replace("{title}",n))}},togglePoster:function(e){A(this.elements.container,this.config.classNames.posterEnabled,e)},setPoster:function(e){var t=this;return arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||!this.poster?(this.media.setAttribute("poster",e),function(){var e=this;return new Promise(function(t){return e.ready?setTimeout(t,0):v.call(e,e.elements.container,"ready",t)}).then(function(){})}.call(this).then(function(){return ke(e)}).catch(function(n){throw e===t.poster&&xe.togglePoster.call(t,!1),n}).then(function(){if(e!==t.poster)throw new Error("setPoster cancelled by later call to setPoster")}).then(function(){return Object.assign(t.elements.poster.style,{backgroundImage:"url('".concat(e,"')"),backgroundSize:""}),xe.togglePoster.call(t,!0),e})):Promise.reject(new Error("Poster already set"))},checkPlaying:function(e){var t=this;A(this.elements.container,this.config.classNames.playing,this.playing),A(this.elements.container,this.config.classNames.paused,this.paused),A(this.elements.container,this.config.classNames.stopped,this.stopped),Array.from(this.elements.buttons.play||[]).forEach(function(e){e.pressed=t.playing}),h.event(e)&&"timeupdate"===e.type||xe.toggleControls.call(this)},checkLoading:function(e){var t=this;this.loading=["stalled","waiting"].includes(e.type),clearTimeout(this.timers.loading),this.timers.loading=setTimeout(function(){A(t.elements.container,t.config.classNames.loading,t.loading),xe.toggleControls.call(t)},this.loading?250:0)},toggleControls:function(e){var t=this.elements.controls;if(t&&this.config.hideControls){var n=this.touch&&this.lastSeekTime+2e3>Date.now();this.toggleControls(Boolean(e||this.loading||this.paused||t.pressed||t.hover||n))}}},_e=function(){function t(n){e(this,t),this.player=n,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.handleKey=this.handleKey.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.setTabFocus=this.setTabFocus.bind(this),this.firstTouch=this.firstTouch.bind(this)}return n(t,[{key:"handleKey",value:function(e){var t=this.player,n=t.elements,i=e.keyCode?e.keyCode:e.which,a="keydown"===e.type,s=a&&i===this.lastKey;if(!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)&&h.number(i))if(a){var r=document.activeElement;if(h.element(r)){var o=t.config.selectors.editable;if(r!==n.inputs.seek&&L(r,o))return;if(32===e.which&&L(r,'button, [role^="menuitem"]'))return}switch([32,37,38,39,40,48,49,50,51,52,53,54,56,57,67,70,73,75,76,77,79].includes(i)&&(e.preventDefault(),e.stopPropagation()),i){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:s||(t.currentTime=t.duration/10*(i-48));break;case 32:case 75:s||t.togglePlay();break;case 38:t.increaseVolume(.1);break;case 40:t.decreaseVolume(.1);break;case 77:s||(t.muted=!t.muted);break;case 39:t.forward();break;case 37:t.rewind();break;case 70:t.fullscreen.toggle();break;case 67:s||t.toggleCaptions();break;case 76:t.loop=!t.loop}!t.fullscreen.enabled&&t.fullscreen.active&&27===i&&t.fullscreen.toggle(),this.lastKey=i}else this.lastKey=null}},{key:"toggleMenu",value:function(e){oe.toggleMenu.call(this.player,e)}},{key:"firstTouch",value:function(){var e=this.player,t=e.elements;e.touch=!0,A(t.container,e.config.classNames.isTouch,!0)}},{key:"setTabFocus",value:function(e){var t=this.player,n=t.elements;if(clearTimeout(this.focusTimer),"keydown"!==e.type||9===e.which){"keydown"===e.type&&(this.lastKeyDown=e.timeStamp);var i,a=e.timeStamp-this.lastKeyDown<=20;("focus"!==e.type||a)&&(i=t.config.classNames.tabFocus,A(O.call(t,".".concat(i)),i,!1),this.focusTimer=setTimeout(function(){var e=document.activeElement;n.container.contains(e)&&A(document.activeElement,t.config.classNames.tabFocus,!0)},10))}}},{key:"global",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.player;t.config.keyboard.global&&f.call(t,window,"keydown keyup",this.handleKey,e,!1),f.call(t,document.body,"click",this.toggleMenu,e),g.call(t,document.body,"touchstart",this.firstTouch),f.call(t,document.body,"keydown focus blur",this.setTabFocus,e,!1,!0)}},{key:"container",value:function(){var e=this.player,t=e.elements;!e.config.keyboard.global&&e.config.keyboard.focused&&v.call(e,t.container,"keydown keyup",this.handleKey,!1),v.call(e,t.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen",function(n){var i=t.controls;i&&"enterfullscreen"===n.type&&(i.pressed=!1,i.hover=!1);var a=0;["touchstart","touchmove","mousemove"].includes(n.type)&&(xe.toggleControls.call(e,!0),a=e.touch?3e3:2e3),clearTimeout(e.timers.controls),e.timers.controls=setTimeout(function(){return xe.toggleControls.call(e,!1)},a)})}},{key:"media",value:function(){var e=this.player,t=e.elements;if(v.call(e,e.media,"timeupdate seeking seeked",function(t){return oe.timeUpdate.call(e,t)}),v.call(e,e.media,"durationchange loadeddata loadedmetadata",function(t){return oe.durationUpdate.call(e,t)}),v.call(e,e.media,"canplay loadeddata",function(){S(t.volume,!e.hasAudio),S(t.buttons.mute,!e.hasAudio)}),v.call(e,e.media,"ended",function(){e.isHTML5&&e.isVideo&&e.config.resetOnEnd&&e.restart()}),v.call(e,e.media,"progress playing seeking seeked",function(t){return oe.updateProgress.call(e,t)}),v.call(e,e.media,"volumechange",function(t){return oe.updateVolume.call(e,t)}),v.call(e,e.media,"playing play pause ended emptied timeupdate",function(t){return xe.checkPlaying.call(e,t)}),v.call(e,e.media,"waiting canplay seeked playing",function(t){return xe.checkLoading.call(e,t)}),v.call(e,e.media,"playing",function(){e.ads&&e.ads.enabled&&!e.ads.initialized&&e.ads.managerPromise.then(function(){return e.ads.play()}).catch(function(){return e.play()})}),e.supported.ui&&e.config.clickToPlay&&!e.isAudio){var n=V.call(e,".".concat(e.config.classNames.video));if(!h.element(n))return;v.call(e,t.container,"click",function(i){([t.container,n].includes(i.target)||n.contains(i.target))&&(e.touch&&e.config.hideControls||(e.ended?(e.restart(),e.play()):e.togglePlay()))})}e.supported.ui&&e.config.disableContextMenu&&v.call(e,t.wrapper,"contextmenu",function(e){e.preventDefault()},!1),v.call(e,e.media,"volumechange",function(){e.storage.set({volume:e.volume,muted:e.muted})}),v.call(e,e.media,"ratechange",function(){oe.updateSetting.call(e,"speed"),e.storage.set({speed:e.speed})}),v.call(e,e.media,"qualitychange",function(t){oe.updateSetting.call(e,"quality",null,t.detail.quality)}),v.call(e,e.media,"ready qualitychange",function(){oe.setDownloadLink.call(e)});var i=e.config.events.concat(["keyup","keydown"]).join(" ");v.call(e,e.media,i,function(n){var i=n.detail,a=void 0===i?{}:i;"error"===n.type&&(a=e.media.error),y.call(e,t.container,n.type,!0,a)})}},{key:"proxy",value:function(e,t,n){var i=this.player,a=i.config.listeners[n],s=!0;h.function(a)&&(s=a.call(i,e)),s&&h.function(t)&&t.call(i,e)}},{key:"bind",value:function(e,t,n,i){var a=this,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=this.player,o=r.config.listeners[i],l=h.function(o);v.call(r,e,t,function(e){return a.proxy(e,n,i)},s&&!l)}},{key:"controls",value:function(){var e=this,t=this.player,n=t.elements,i=U.isIE?"change":"input";if(n.buttons.play&&Array.from(n.buttons.play).forEach(function(n){e.bind(n,"click",t.togglePlay,"play")}),this.bind(n.buttons.restart,"click",t.restart,"restart"),this.bind(n.buttons.rewind,"click",t.rewind,"rewind"),this.bind(n.buttons.fastForward,"click",t.forward,"fastForward"),this.bind(n.buttons.mute,"click",function(){t.muted=!t.muted},"mute"),this.bind(n.buttons.captions,"click",function(){return t.toggleCaptions()}),this.bind(n.buttons.download,"click",function(){y.call(t,t.media,"download")},"download"),this.bind(n.buttons.fullscreen,"click",function(){t.fullscreen.toggle()},"fullscreen"),this.bind(n.buttons.pip,"click",function(){t.pip="toggle"},"pip"),this.bind(n.buttons.airplay,"click",t.airplay,"airplay"),this.bind(n.buttons.settings,"click",function(e){e.stopPropagation(),oe.toggleMenu.call(t,e)}),this.bind(n.buttons.settings,"keyup",function(e){var n=e.which;[13,32].includes(n)&&(13!==n?(e.preventDefault(),e.stopPropagation(),oe.toggleMenu.call(t,e)):oe.focusFirstMenuItem.call(t,null,!0))},null,!1),this.bind(n.settings.menu,"keydown",function(e){27===e.which&&oe.toggleMenu.call(t,e)}),this.bind(n.inputs.seek,"mousedown mousemove",function(e){var t=n.progress.getBoundingClientRect(),i=100/t.width*(e.pageX-t.left);e.currentTarget.setAttribute("seek-value",i)}),this.bind(n.inputs.seek,"mousedown mouseup keydown keyup touchstart touchend",function(e){var n=e.currentTarget,i=e.keyCode?e.keyCode:e.which;if(!h.keyboardEvent(e)||39===i||37===i){t.lastSeekTime=Date.now();var a=n.hasAttribute("play-on-seeked"),s=["mouseup","touchend","keyup"].includes(e.type);a&&s?(n.removeAttribute("play-on-seeked"),t.play()):!s&&t.playing&&(n.setAttribute("play-on-seeked",""),t.pause())}}),U.isIos){var s=O.call(t,'input[type="range"]');Array.from(s).forEach(function(t){return e.bind(t,i,function(e){return D(e.target)})})}this.bind(n.inputs.seek,i,function(e){var n=e.currentTarget,i=n.getAttribute("seek-value");h.empty(i)&&(i=n.value),n.removeAttribute("seek-value"),t.currentTime=i/n.max*t.duration},"seek"),this.bind(n.progress,"mouseenter mouseleave mousemove",function(e){return oe.updateSeekTooltip.call(t,e)}),U.isWebkit&&Array.from(O.call(t,'input[type="range"]')).forEach(function(n){e.bind(n,"input",function(e){return oe.updateRangeFill.call(t,e.target)})}),t.config.toggleInvert&&!h.element(n.display.duration)&&this.bind(n.display.currentTime,"click",function(){0!==t.currentTime&&(t.config.invertTime=!t.config.invertTime,oe.timeUpdate.call(t))}),this.bind(n.inputs.volume,i,function(e){t.volume=e.target.value},"volume"),this.bind(n.controls,"mouseenter mouseleave",function(e){n.controls.hover=!t.touch&&"mouseenter"===e.type}),this.bind(n.controls,"mousedown mouseup touchstart touchend touchcancel",function(e){n.controls.pressed=["mousedown","touchstart"].includes(e.type)}),this.bind(n.controls,"focusin",function(){var n=t.config,i=t.elements,a=t.timers;A(i.controls,n.classNames.noTransition,!0),xe.toggleControls.call(t,!0),setTimeout(function(){A(i.controls,n.classNames.noTransition,!1)},0);var s=e.touch?3e3:4e3;clearTimeout(a.controls),a.controls=setTimeout(function(){return xe.toggleControls.call(t,!1)},s)}),this.bind(n.inputs.volume,"wheel",function(e){var n=e.webkitDirectionInvertedFromDevice,i=a([e.deltaX,-e.deltaY].map(function(e){return n?-e:e}),2),s=i[0],r=i[1],o=Math.sign(Math.abs(s)>Math.abs(r)?s:r);t.increaseVolume(o/50);var l=t.media.volume;(1===o&&l<1||-1===o&&l>0)&&e.preventDefault()},"volume",!1)}}]),t}(),Te=(function(e,t){e.exports=function(){var e=function(){},t={},n={},i={};function a(e,t){if(e){var a=i[e];if(n[e]=t,a)for(;a.length;)a[0](e,t),a.splice(0,1)}}function s(t,n){t.call&&(t={success:t}),n.length?(t.error||e)(n):(t.success||e)(t)}function r(t,n,i,a){var s,o,l=document,c=i.async,u=(i.numRetries||0)+1,d=i.before||e,p=t.replace(/^(css|img)!/,"");a=a||0,/(^css!|\.css$)/.test(t)?(s=!0,(o=l.createElement("link")).rel="stylesheet",o.href=p):/(^img!|\.(png|gif|jpg|svg)$)/.test(t)?(o=l.createElement("img")).src=p:((o=l.createElement("script")).src=t,o.async=void 0===c||c),o.onload=o.onerror=o.onbeforeload=function(e){var l=e.type[0];if(s&&"hideFocus"in o)try{o.sheet.cssText.length||(l="e")}catch(e){l="e"}if("e"==l&&(a+=1)<u)return r(t,n,i,a);n(t,l,e.defaultPrevented)},!1!==d(t,o)&&l.head.appendChild(o)}function o(e,n,i){var o,l;if(n&&n.trim&&(o=n),l=(o?i:n)||{},o){if(o in t)throw"LoadJS";t[o]=!0}!function(e,t,n){var i,a,s=(e=e.push?e:[e]).length,o=s,l=[];for(i=function(e,n,i){if("e"==n&&l.push(e),"b"==n){if(!i)return;l.push(e)}--s||t(l)},a=0;a<o;a++)r(e[a],i,n)}(e,function(e){s(l,e),a(o,e)},l)}return o.ready=function(e,t){return function(e,t){e=e.push?e:[e];var a,s,r,o=[],l=e.length,c=l;for(a=function(e,n){n.length&&o.push(e),--c||t(o)};l--;)s=e[l],(r=n[s])?a(s,r):(i[s]=i[s]||[]).push(a)}(e,function(e){s(t,e)}),o},o.done=function(e){a(e,[])},o.reset=function(){t={},n={},i={}},o.isDefined=function(e){return e in t},o}()}(we={exports:{}}),we.exports);function Ce(e){return new Promise(function(t,n){Te(e,{success:t,error:n})})}function Pe(e){e&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===e&&(this.media.paused=!e,y.call(this,this.media,e?"play":"pause"))}var Ne={setup:function(){var e=this;A(this.elements.wrapper,this.config.classNames.embed,!0),Ne.setAspectRatio.call(this),h.object(window.Vimeo)?Ne.ready.call(this):Ce(this.config.urls.vimeo.sdk).then(function(){Ne.ready.call(e)}).catch(function(t){e.debug.warn("Vimeo API failed to load",t)})},setAspectRatio:function(e){var t=a((h.string(e)?e:this.config.ratio).split(":").map(Number),2),n=100/t[0]*t[1];if(Ne.padding=n,this.elements.wrapper.style.paddingBottom="".concat(n,"%"),this.supported.ui){var i=(240-n)/4.8;this.media.style.transform="translateY(-".concat(i,"%)")}},ready:function(){var e=this,t=this,n=ce({loop:t.config.loop.active,autoplay:t.autoplay,byline:!1,portrait:!1,title:!1,speed:!0,transparent:0,gesture:"media",playsinline:!this.config.fullscreen.iosNative}),i=t.media.getAttribute("src");h.empty(i)&&(i=t.media.getAttribute(t.config.attributes.embed.id));var s,r=(s=i,h.empty(s)?null:h.number(Number(s))?s:s.match(/^.*(vimeo.com\/|video\/)(\d+).*/)?RegExp.$2:s),o=x("iframe"),l=J(t.config.urls.vimeo.iframe,r,n);o.setAttribute("src",l),o.setAttribute("allowfullscreen",""),o.setAttribute("allowtransparency",""),o.setAttribute("allow","autoplay");var c=x("div",{poster:t.poster,class:t.config.classNames.embedContainer});c.appendChild(o),t.media=P(c,t.media),te(J(t.config.urls.vimeo.api,r),"json").then(function(e){if(!h.empty(e)){var n=new URL(e[0].thumbnail_large);n.pathname="".concat(n.pathname.split("_")[0],".jpg"),xe.setPoster.call(t,n.href).catch(function(){})}}),t.embed=new window.Vimeo.Player(o,{autopause:t.config.autopause,muted:t.muted}),t.media.paused=!0,t.media.currentTime=0,t.supported.ui&&t.embed.disableTextTrack(),t.media.play=function(){return Pe.call(t,!0),t.embed.play()},t.media.pause=function(){return Pe.call(t,!1),t.embed.pause()},t.media.stop=function(){t.pause(),t.currentTime=0};var u=t.media.currentTime;Object.defineProperty(t.media,"currentTime",{get:function(){return u},set:function(e){var n=t.embed,i=t.media,a=t.paused,s=t.volume,r=a&&!n.hasPlayed;i.seeking=!0,y.call(t,i,"seeking"),Promise.resolve(r&&n.setVolume(0)).then(function(){return n.setCurrentTime(e)}).then(function(){return r&&n.pause()}).then(function(){return r&&n.setVolume(s)}).catch(function(){})}});var d=t.config.speed.selected;Object.defineProperty(t.media,"playbackRate",{get:function(){return d},set:function(e){t.embed.setPlaybackRate(e).then(function(){d=e,y.call(t,t.media,"ratechange")}).catch(function(e){"Error"===e.name&&oe.setSpeedMenu.call(t,[])})}});var p=t.config.volume;Object.defineProperty(t.media,"volume",{get:function(){return p},set:function(e){t.embed.setVolume(e).then(function(){p=e,y.call(t,t.media,"volumechange")})}});var m=t.config.muted;Object.defineProperty(t.media,"muted",{get:function(){return m},set:function(e){var n=!!h.boolean(e)&&e;t.embed.setVolume(n?0:t.config.volume).then(function(){m=n,y.call(t,t.media,"volumechange")})}});var f,v=t.config.loop;Object.defineProperty(t.media,"loop",{get:function(){return v},set:function(e){var n=h.boolean(e)?e:t.config.loop.active;t.embed.setLoop(n).then(function(){v=n})}}),t.embed.getVideoUrl().then(function(e){f=e,oe.setDownloadLink.call(t)}).catch(function(t){e.debug.warn(t)}),Object.defineProperty(t.media,"currentSrc",{get:function(){return f}}),Object.defineProperty(t.media,"ended",{get:function(){return t.currentTime===t.duration}}),Promise.all([t.embed.getVideoWidth(),t.embed.getVideoHeight()]).then(function(t){var n,i,a;Ne.ratio=(n=t[0],i=t[1],a=function e(t,n){return 0===n?t:e(n,t%n)}(n,i),"".concat(n/a,":").concat(i/a)),Ne.setAspectRatio.call(e,Ne.ratio)}),t.embed.setAutopause(t.config.autopause).then(function(e){t.config.autopause=e}),t.embed.getVideoTitle().then(function(n){t.config.title=n,xe.setTitle.call(e)}),t.embed.getCurrentTime().then(function(e){u=e,y.call(t,t.media,"timeupdate")}),t.embed.getDuration().then(function(e){t.media.duration=e,y.call(t,t.media,"durationchange")}),t.embed.getTextTracks().then(function(e){t.media.textTracks=e,ue.setup.call(t)}),t.embed.on("cuechange",function(e){var n=e.cues,i=(void 0===n?[]:n).map(function(e){return t=e.text,n=document.createDocumentFragment(),i=document.createElement("div"),n.appendChild(i),i.innerHTML=t,n.firstChild.innerText;var t,n,i});ue.updateCues.call(t,i)}),t.embed.on("loaded",function(){t.embed.getPaused().then(function(e){Pe.call(t,!e),e||y.call(t,t.media,"playing")}),h.element(t.embed.element)&&t.supported.ui&&t.embed.element.setAttribute("tabindex",-1)}),t.embed.on("play",function(){Pe.call(t,!0),y.call(t,t.media,"playing")}),t.embed.on("pause",function(){Pe.call(t,!1)}),t.embed.on("timeupdate",function(e){t.media.seeking=!1,u=e.seconds,y.call(t,t.media,"timeupdate")}),t.embed.on("progress",function(e){t.media.buffered=e.percent,y.call(t,t.media,"progress"),1===parseInt(e.percent,10)&&y.call(t,t.media,"canplaythrough"),t.embed.getDuration().then(function(e){e!==t.media.duration&&(t.media.duration=e,y.call(t,t.media,"durationchange"))})}),t.embed.on("seeked",function(){t.media.seeking=!1,y.call(t,t.media,"seeked")}),t.embed.on("ended",function(){t.media.paused=!0,y.call(t,t.media,"ended")}),t.embed.on("error",function(e){t.media.error=e,y.call(t,t.media,"error")}),t.on("enterfullscreen exitfullscreen",function(e){var n=t.fullscreen.target;if(n===t.elements.container){var i="enterfullscreen"===e.type,s=a(Ne.ratio.split(":").map(Number),2),r=s[0]>s[1]?"width":"height";n.style[r]=i?"".concat(Ne.padding,"%"):null}}),setTimeout(function(){return xe.build.call(t)},0)}};function Se(e){e&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===e&&(this.media.paused=!e,y.call(this,this.media,e?"play":"pause"))}var Ae,Ee={setup:function(){var e=this;A(this.elements.wrapper,this.config.classNames.embed,!0),Ee.setAspectRatio.call(this),h.object(window.YT)&&h.function(window.YT.Player)?Ee.ready.call(this):(Ce(this.config.urls.youtube.sdk).catch(function(t){e.debug.warn("YouTube API failed to load",t)}),window.onYouTubeReadyCallbacks=window.onYouTubeReadyCallbacks||[],window.onYouTubeReadyCallbacks.push(function(){Ee.ready.call(e)}),window.onYouTubeIframeAPIReady=function(){window.onYouTubeReadyCallbacks.forEach(function(e){e()})})},getTitle:function(e){var t=this;if(h.function(this.embed.getVideoData)){var n=this.embed.getVideoData().title;if(h.empty(n))return this.config.title=n,void xe.setTitle.call(this)}var i=this.config.keys.google;h.string(i)&&!h.empty(i)&&te(J(this.config.urls.youtube.api,e,i)).then(function(e){h.object(e)&&(t.config.title=e.items[0].snippet.title,xe.setTitle.call(t))}).catch(function(){})},setAspectRatio:function(){var e=this.config.ratio.split(":");this.elements.wrapper.style.paddingBottom="".concat(100/e[0]*e[1],"%")},ready:function(){var e=this,t=e.media.getAttribute("id");if(h.empty(t)||!t.startsWith("youtube-")){var n=e.media.getAttribute("src");h.empty(n)&&(n=e.media.getAttribute(this.config.attributes.embed.id));var i,a,s=(i=n,h.empty(i)?null:i.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/)?RegExp.$2:i),r=(a=e.provider,"".concat(a,"-").concat(Math.floor(1e4*Math.random()))),o=x("div",{id:r,poster:e.poster});e.media=P(o,e.media);var l=function(e){return"https://img.youtube.com/vi/".concat(s,"/").concat(e,"default.jpg")};ke(l("maxres"),121).catch(function(){return ke(l("sd"),121)}).catch(function(){return ke(l("hq"))}).then(function(t){return xe.setPoster.call(e,t.src)}).then(function(t){t.includes("maxres")||(e.elements.poster.style.backgroundSize="cover")}).catch(function(){}),e.embed=new window.YT.Player(r,{videoId:s,playerVars:{autoplay:e.config.autoplay?1:0,hl:e.config.hl,controls:e.supported.ui?0:1,rel:0,showinfo:0,iv_load_policy:3,modestbranding:1,disablekb:1,playsinline:1,widget_referrer:window?window.location.href:null,cc_load_policy:e.captions.active?1:0,cc_lang_pref:e.config.captions.language},events:{onError:function(t){if(!e.media.error){var n=t.data,i={2:"The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.",5:"The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",100:"The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.",101:"The owner of the requested video does not allow it to be played in embedded players.",150:"The owner of the requested video does not allow it to be played in embedded players."}[n]||"An unknown error occured";e.media.error={code:n,message:i},y.call(e,e.media,"error")}},onPlaybackRateChange:function(t){var n=t.target;e.media.playbackRate=n.getPlaybackRate(),y.call(e,e.media,"ratechange")},onReady:function(t){if(!h.function(e.media.play)){var n=t.target;Ee.getTitle.call(e,s),e.media.play=function(){Se.call(e,!0),n.playVideo()},e.media.pause=function(){Se.call(e,!1),n.pauseVideo()},e.media.stop=function(){n.stopVideo()},e.media.duration=n.getDuration(),e.media.paused=!0,e.media.currentTime=0,Object.defineProperty(e.media,"currentTime",{get:function(){return Number(n.getCurrentTime())},set:function(t){e.paused&&!e.embed.hasPlayed&&e.embed.mute(),e.media.seeking=!0,y.call(e,e.media,"seeking"),n.seekTo(t)}}),Object.defineProperty(e.media,"playbackRate",{get:function(){return n.getPlaybackRate()},set:function(e){n.setPlaybackRate(e)}});var i=e.config.volume;Object.defineProperty(e.media,"volume",{get:function(){return i},set:function(t){i=t,n.setVolume(100*i),y.call(e,e.media,"volumechange")}});var a=e.config.muted;Object.defineProperty(e.media,"muted",{get:function(){return a},set:function(t){var i=h.boolean(t)?t:a;a=i,n[i?"mute":"unMute"](),y.call(e,e.media,"volumechange")}}),Object.defineProperty(e.media,"currentSrc",{get:function(){return n.getVideoUrl()}}),Object.defineProperty(e.media,"ended",{get:function(){return e.currentTime===e.duration}}),e.options.speed=n.getAvailablePlaybackRates(),e.supported.ui&&e.media.setAttribute("tabindex",-1),y.call(e,e.media,"timeupdate"),y.call(e,e.media,"durationchange"),clearInterval(e.timers.buffering),e.timers.buffering=setInterval(function(){e.media.buffered=n.getVideoLoadedFraction(),(null===e.media.lastBuffered||e.media.lastBuffered<e.media.buffered)&&y.call(e,e.media,"progress"),e.media.lastBuffered=e.media.buffered,1===e.media.buffered&&(clearInterval(e.timers.buffering),y.call(e,e.media,"canplaythrough"))},200),setTimeout(function(){return xe.build.call(e)},50)}},onStateChange:function(t){var n=t.target;switch(clearInterval(e.timers.playing),e.media.seeking&&[1,2].includes(t.data)&&(e.media.seeking=!1,y.call(e,e.media,"seeked")),t.data){case-1:y.call(e,e.media,"timeupdate"),e.media.buffered=n.getVideoLoadedFraction(),y.call(e,e.media,"progress");break;case 0:Se.call(e,!1),e.media.loop?(n.stopVideo(),n.playVideo()):y.call(e,e.media,"ended");break;case 1:e.media.paused&&!e.embed.hasPlayed?e.media.pause():(Se.call(e,!0),y.call(e,e.media,"playing"),e.timers.playing=setInterval(function(){y.call(e,e.media,"timeupdate")},50),e.media.duration!==n.getDuration()&&(e.media.duration=n.getDuration(),y.call(e,e.media,"durationchange")));break;case 2:e.muted||e.embed.unMute(),Se.call(e,!1)}y.call(e,e.elements.container,"statechange",!1,{code:t.data})}}})}}},Le={setup:function(){this.media?(A(this.elements.container,this.config.classNames.type.replace("{0}",this.type),!0),A(this.elements.container,this.config.classNames.provider.replace("{0}",this.provider),!0),this.isEmbed&&A(this.elements.container,this.config.classNames.type.replace("{0}","video"),!0),this.isVideo&&(this.elements.wrapper=x("div",{class:this.config.classNames.video}),k(this.media,this.elements.wrapper),this.elements.poster=x("div",{class:this.config.classNames.poster}),this.elements.wrapper.appendChild(this.elements.poster)),this.isHTML5?$.extend.call(this):this.isYouTube?Ee.setup.call(this):this.isVimeo&&Ne.setup.call(this)):this.debug.warn("No media element found!")}},Oe=function(){function t(n){var i=this;e(this,t),this.player=n,this.publisherId=n.config.ads.publisherId,this.playing=!1,this.initialized=!1,this.elements={container:null,displayContainer:null},this.manager=null,this.loader=null,this.cuePoints=null,this.events={},this.safetyTimer=null,this.countdownTimer=null,this.managerPromise=new Promise(function(e,t){i.on("loaded",e),i.on("error",t)}),this.load()}return n(t,[{key:"load",value:function(){var e=this;this.enabled&&(h.object(window.google)&&h.object(window.google.ima)?this.ready():Ce(this.player.config.urls.googleIMA.sdk).then(function(){e.ready()}).catch(function(){e.trigger("error",new Error("Google IMA SDK failed to load"))}))}},{key:"ready",value:function(){var e=this;this.startSafetyTimer(12e3,"ready()"),this.managerPromise.then(function(){e.clearSafetyTimer("onAdsManagerLoaded()")}),this.listeners(),this.setupIMA()}},{key:"setupIMA",value:function(){this.elements.container=x("div",{class:this.player.config.classNames.ads}),this.player.elements.container.appendChild(this.elements.container),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(this.player.config.ads.language),this.elements.displayContainer=new google.ima.AdDisplayContainer(this.elements.container),this.requestAds()}},{key:"requestAds",value:function(){var e=this,t=this.player.elements.container;try{this.loader=new google.ima.AdsLoader(this.elements.displayContainer),this.loader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(t){return e.onAdsManagerLoaded(t)},!1),this.loader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(t){return e.onAdError(t)},!1);var n=new google.ima.AdsRequest;n.adTagUrl=this.tagUrl,n.linearAdSlotWidth=t.offsetWidth,n.linearAdSlotHeight=t.offsetHeight,n.nonLinearAdSlotWidth=t.offsetWidth,n.nonLinearAdSlotHeight=t.offsetHeight,n.forceNonLinearFullSlot=!1,n.setAdWillPlayMuted(!this.player.muted),this.loader.requestAds(n)}catch(e){this.onAdError(e)}}},{key:"pollCountdown",value:function(){var e=this;if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0]))return clearInterval(this.countdownTimer),void this.elements.container.removeAttribute("data-badge-text");this.countdownTimer=setInterval(function(){var t=re(Math.max(e.manager.getRemainingTime(),0)),n="".concat(Z("advertisement",e.player.config)," - ").concat(t);e.elements.container.setAttribute("data-badge-text",n)},100)}},{key:"onAdsManagerLoaded",value:function(e){var t=this;if(this.enabled){var n=new google.ima.AdsRenderingSettings;n.restoreCustomPlaybackStateOnAdBreakComplete=!0,n.enablePreloading=!0,this.manager=e.getAdsManager(this.player,n),this.cuePoints=this.manager.getCuePoints(),h.empty(this.cuePoints)||this.cuePoints.forEach(function(e){if(0!==e&&-1!==e&&e<t.player.duration){var n=t.player.elements.progress;if(h.element(n)){var i=100/t.player.duration*e,a=x("span",{class:t.player.config.classNames.cues});a.style.left="".concat(i.toString(),"%"),n.appendChild(a)}}}),this.manager.setVolume(this.player.volume),this.manager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(e){return t.onAdError(e)}),Object.keys(google.ima.AdEvent.Type).forEach(function(e){t.manager.addEventListener(google.ima.AdEvent.Type[e],function(e){return t.onAdEvent(e)})}),this.trigger("loaded")}}},{key:"onAdEvent",value:function(e){var t=this,n=this.player.elements.container,i=e.getAd(),a=function(e){var n="ads".concat(e.replace(/_/g,"").toLowerCase());y.call(t.player,t.player.media,n)};switch(e.type){case google.ima.AdEvent.Type.LOADED:this.trigger("loaded"),a(e.type),this.pollCountdown(!0),i.isLinear()||(i.width=n.offsetWidth,i.height=n.offsetHeight);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:a(e.type),this.loadAds();break;case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:a(e.type),this.pauseContent();break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:a(e.type),this.pollCountdown(),this.resumeContent();break;case google.ima.AdEvent.Type.STARTED:case google.ima.AdEvent.Type.MIDPOINT:case google.ima.AdEvent.Type.COMPLETE:case google.ima.AdEvent.Type.IMPRESSION:case google.ima.AdEvent.Type.CLICK:a(e.type)}}},{key:"onAdError",value:function(e){this.cancel(),this.player.debug.warn("Ads error",e)}},{key:"listeners",value:function(){var e,t=this,n=this.player.elements.container;this.player.on("ended",function(){t.loader.contentComplete()}),this.player.on("seeking",function(){return e=t.player.currentTime}),this.player.on("seeked",function(){var n=t.player.currentTime;h.empty(t.cuePoints)||t.cuePoints.forEach(function(i,a){e<i&&i<n&&(t.manager.discardAdBreak(),t.cuePoints.splice(a,1))})}),window.addEventListener("resize",function(){t.manager&&t.manager.resize(n.offsetWidth,n.offsetHeight,google.ima.ViewMode.NORMAL)})}},{key:"play",value:function(){var e=this,t=this.player.elements.container;this.managerPromise||this.resumeContent(),this.managerPromise.then(function(){e.elements.displayContainer.initialize();try{e.initialized||(e.manager.init(t.offsetWidth,t.offsetHeight,google.ima.ViewMode.NORMAL),e.manager.start()),e.initialized=!0}catch(t){e.onAdError(t)}}).catch(function(){})}},{key:"resumeContent",value:function(){this.elements.container.style.zIndex="",this.playing=!1,this.player.currentTime<this.player.duration&&this.player.play()}},{key:"pauseContent",value:function(){this.elements.container.style.zIndex=3,this.playing=!0,this.player.pause()}},{key:"cancel",value:function(){this.initialized&&this.resumeContent(),this.trigger("error"),this.loadAds()}},{key:"loadAds",value:function(){var e=this;this.managerPromise.then(function(){e.manager&&e.manager.destroy(),e.managerPromise=new Promise(function(t){e.on("loaded",t),e.player.debug.log(e.manager)}),e.requestAds()}).catch(function(){})}},{key:"trigger",value:function(e){for(var t=this,n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];var s=this.events[e];h.array(s)&&s.forEach(function(e){h.function(e)&&e.apply(t,i)})}},{key:"on",value:function(e,t){return h.array(this.events[e])||(this.events[e]=[]),this.events[e].push(t),this}},{key:"startSafetyTimer",value:function(e,t){var n=this;this.player.debug.log("Safety timer invoked from: ".concat(t)),this.safetyTimer=setTimeout(function(){n.cancel(),n.clearSafetyTimer("startSafetyTimer()")},e)}},{key:"clearSafetyTimer",value:function(e){h.nullOrUndefined(this.safetyTimer)||(this.player.debug.log("Safety timer cleared from: ".concat(e)),clearTimeout(this.safetyTimer),this.safetyTimer=null)}},{key:"enabled",get:function(){return this.player.isHTML5&&this.player.isVideo&&this.player.config.ads.enabled&&!h.empty(this.publisherId)}},{key:"tagUrl",get:function(){var e={AV_PUBLISHERID:"58c25bb0073ef448b1087ad6",AV_CHANNELID:"5a0458dc28a06145e4519d21",AV_URL:window.location.hostname,cb:Date.now(),AV_WIDTH:640,AV_HEIGHT:480,AV_CDIM2:this.publisherId};return"".concat("https://go.aniview.com/api/adserver6/vast/","?").concat(ce(e))}}]),t}(),Ve={insertElements:function(e,t){var n=this;h.string(t)?_(e,this.media,{src:t}):h.array(t)&&t.forEach(function(t){_(e,n.media,t)})},change:function(e){var t=this;W(e,"sources.length")?($.cancelRequests.call(this),this.destroy.call(this,function(){t.options.quality=[],T(t.media),t.media=null,h.element(t.elements.container)&&t.elements.container.removeAttribute("class");var n=e.sources,i=e.type,s=a(n,1)[0],r=s.provider,o=void 0===r?he.html5:r,l=s.src,c="html5"===o?i:"div",u="html5"===o?{}:{src:l};Object.assign(t,{provider:o,type:i,supported:j.check(i,o,t.config.playsinline),media:x(c,u)}),t.elements.container.appendChild(t.media),h.boolean(e.autoplay)&&(t.config.autoplay=e.autoplay),t.isHTML5&&(t.config.crossorigin&&t.media.setAttribute("crossorigin",""),t.config.autoplay&&t.media.setAttribute("autoplay",""),h.empty(e.poster)||(t.poster=e.poster),t.config.loop.active&&t.media.setAttribute("loop",""),t.config.muted&&t.media.setAttribute("muted",""),t.config.playsinline&&t.media.setAttribute("playsinline","")),xe.addStyleHook.call(t),t.isHTML5&&Ve.insertElements.call(t,"source",n),t.config.title=e.title,Le.setup.call(t),t.isHTML5&&Object.keys(e).includes("tracks")&&Ve.insertElements.call(t,"track",e.tracks),(t.isHTML5||t.isEmbed&&!t.supported.ui)&&xe.build.call(t),t.isHTML5&&t.media.load(),t.fullscreen.update()},!0)):this.debug.warn("Invalid source format")}},Ie=function(){function t(n,i){var a=this;if(e(this,t),this.timers={},this.ready=!1,this.loading=!1,this.failed=!1,this.touch=j.touch,this.media=n,h.string(this.media)&&(this.media=document.querySelectorAll(this.media)),(window.jQuery&&this.media instanceof jQuery||h.nodeList(this.media)||h.array(this.media))&&(this.media=this.media[0]),this.config=G({},de,t.defaults,i||{},function(){try{return JSON.parse(a.media.getAttribute("data-plyr-config"))}catch(e){return{}}}()),this.elements={container:null,captions:null,buttons:{},display:{},progress:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}}},this.captions={active:null,currentTrack:-1,meta:new WeakMap},this.fullscreen={active:!1},this.options={speed:[],quality:[]},this.debug=new ve(this.config.debug),this.debug.log("Config",this.config),this.debug.log("Support",j),!h.nullOrUndefined(this.media)&&h.element(this.media))if(this.media.plyr)this.debug.warn("Target already setup");else if(this.config.enabled)if(j.check().api){var s=this.media.cloneNode(!0);s.autoplay=!1,this.elements.original=s;var r=this.media.tagName.toLowerCase(),o=null,l=null;switch(r){case"div":if(o=this.media.querySelector("iframe"),h.element(o)){if(l=le(o.getAttribute("src")),this.provider=function(e){return/^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.?be)\/.+$/.test(e)?he.youtube:/^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(e)?he.vimeo:null}(l.toString()),this.elements.container=this.media,this.media=o,this.elements.container.className="",l.search.length){var c=["1","true"];c.includes(l.searchParams.get("autoplay"))&&(this.config.autoplay=!0),c.includes(l.searchParams.get("loop"))&&(this.config.loop.active=!0),this.isYouTube?(this.config.playsinline=c.includes(l.searchParams.get("playsinline")),this.config.hl=l.searchParams.get("hl")):this.config.playsinline=!0}}else this.provider=this.media.getAttribute(this.config.attributes.embed.provider),this.media.removeAttribute(this.config.attributes.embed.provider);if(h.empty(this.provider)||!Object.keys(he).includes(this.provider))return void this.debug.error("Setup failed: Invalid provider");this.type=me.video;break;case"video":case"audio":this.type=r,this.provider=he.html5,this.media.hasAttribute("crossorigin")&&(this.config.crossorigin=!0),this.media.hasAttribute("autoplay")&&(this.config.autoplay=!0),(this.media.hasAttribute("playsinline")||this.media.hasAttribute("webkit-playsinline"))&&(this.config.playsinline=!0),this.media.hasAttribute("muted")&&(this.config.muted=!0),this.media.hasAttribute("loop")&&(this.config.loop.active=!0);break;default:return void this.debug.error("Setup failed: unsupported type")}this.supported=j.check(this.type,this.provider,this.config.playsinline),this.supported.api?(this.eventListeners=[],this.listeners=new _e(this),this.storage=new ee(this),this.media.plyr=this,h.element(this.elements.container)||(this.elements.container=x("div"),k(this.media,this.elements.container)),xe.addStyleHook.call(this),Le.setup.call(this),this.config.debug&&v.call(this,this.elements.container,this.config.events.join(" "),function(e){a.debug.log("event: ".concat(e.type))}),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&xe.build.call(this),this.listeners.container(),this.listeners.global(),this.fullscreen=new ye(this),this.config.ads.enabled&&(this.ads=new Oe(this)),this.config.autoplay&&this.play(),this.lastSeekTime=0):this.debug.error("Setup failed: no support")}else this.debug.error("Setup failed: no support");else this.debug.error("Setup failed: disabled by config");else this.debug.error("Setup failed: no suitable element passed")}return n(t,[{key:"play",value:function(){return h.function(this.media.play)?this.media.play():null}},{key:"pause",value:function(){this.playing&&h.function(this.media.pause)&&this.media.pause()}},{key:"togglePlay",value:function(e){(h.boolean(e)?e:!this.playing)?this.play():this.pause()}},{key:"stop",value:function(){this.isHTML5?(this.pause(),this.restart()):h.function(this.media.stop)&&this.media.stop()}},{key:"restart",value:function(){this.currentTime=0}},{key:"rewind",value:function(e){this.currentTime=this.currentTime-(h.number(e)?e:this.config.seekTime)}},{key:"forward",value:function(e){this.currentTime=this.currentTime+(h.number(e)?e:this.config.seekTime)}},{key:"increaseVolume",value:function(e){var t=this.media.muted?0:this.volume;this.volume=t+(h.number(e)?e:0)}},{key:"decreaseVolume",value:function(e){this.increaseVolume(-e)}},{key:"toggleCaptions",value:function(e){ue.toggle.call(this,e,!1)}},{key:"airplay",value:function(){j.airplay&&this.media.webkitShowPlaybackTargetPicker()}},{key:"toggleControls",value:function(e){if(this.supported.ui&&!this.isAudio){var t=E(this.elements.container,this.config.classNames.hideControls),n=void 0===e?void 0:!e,i=A(this.elements.container,this.config.classNames.hideControls,n);if(i&&this.config.controls.includes("settings")&&!h.empty(this.config.settings)&&oe.toggleMenu.call(this,!1),i!==t){var a=i?"controlshidden":"controlsshown";y.call(this,this.media,a)}return!i}return!1}},{key:"on",value:function(e,t){v.call(this,this.elements.container,e,t)}},{key:"once",value:function(e,t){g.call(this,this.elements.container,e,t)}},{key:"off",value:function(e,t){b(this.elements.container,e,t)}},{key:"destroy",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.ready){var i=function(){document.body.style.overflow="",t.embed=null,n?(Object.keys(t.elements).length&&(T(t.elements.buttons.play),T(t.elements.captions),T(t.elements.controls),T(t.elements.wrapper),t.elements.buttons.play=null,t.elements.captions=null,t.elements.controls=null,t.elements.wrapper=null),h.function(e)&&e()):(function(){this&&this.eventListeners&&(this.eventListeners.forEach(function(e){var t=e.element,n=e.type,i=e.callback,a=e.options;t.removeEventListener(n,i,a)}),this.eventListeners=[])}.call(t),P(t.elements.original,t.elements.container),y.call(t,t.elements.original,"destroyed",!0),h.function(e)&&e.call(t.elements.original),t.ready=!1,setTimeout(function(){t.elements=null,t.media=null},200))};this.stop(),this.isHTML5?(clearTimeout(this.timers.loading),xe.toggleNativeControls.call(this,!0),i()):this.isYouTube?(clearInterval(this.timers.buffering),clearInterval(this.timers.playing),null!==this.embed&&h.function(this.embed.destroy)&&this.embed.destroy(),i()):this.isVimeo&&(null!==this.embed&&this.embed.unload().then(i),setTimeout(i,200))}}},{key:"supports",value:function(e){return j.mime.call(this,e)}},{key:"isHTML5",get:function(){return Boolean(this.provider===he.html5)}},{key:"isEmbed",get:function(){return Boolean(this.isYouTube||this.isVimeo)}},{key:"isYouTube",get:function(){return Boolean(this.provider===he.youtube)}},{key:"isVimeo",get:function(){return Boolean(this.provider===he.vimeo)}},{key:"isVideo",get:function(){return Boolean(this.type===me.video)}},{key:"isAudio",get:function(){return Boolean(this.type===me.audio)}},{key:"playing",get:function(){return Boolean(this.ready&&!this.paused&&!this.ended)}},{key:"paused",get:function(){return Boolean(this.media.paused)}},{key:"stopped",get:function(){return Boolean(this.paused&&0===this.currentTime)}},{key:"ended",get:function(){return Boolean(this.media.ended)}},{key:"currentTime",set:function(e){if(this.duration){var t=h.number(e)&&e>0;this.media.currentTime=t?Math.min(e,this.duration):0,this.debug.log("Seeking to ".concat(this.currentTime," seconds"))}},get:function(){return Number(this.media.currentTime)}},{key:"buffered",get:function(){var e=this.media.buffered;return h.number(e)?e:e&&e.length&&this.duration>0?e.end(0)/this.duration:0}},{key:"seeking",get:function(){return Boolean(this.media.seeking)}},{key:"duration",get:function(){var e=parseFloat(this.config.duration),t=(this.media||{}).duration,n=h.number(t)&&t!==1/0?t:0;return e||n}},{key:"volume",set:function(e){var t=e;h.string(t)&&(t=Number(t)),h.number(t)||(t=this.storage.get("volume")),h.number(t)||(t=this.config.volume),t>1&&(t=1),t<0&&(t=0),this.config.volume=t,this.media.volume=t,!h.empty(e)&&this.muted&&t>0&&(this.muted=!1)},get:function(){return Number(this.media.volume)}},{key:"muted",set:function(e){var t=e;h.boolean(t)||(t=this.storage.get("muted")),h.boolean(t)||(t=this.config.muted),this.config.muted=t,this.media.muted=t},get:function(){return Boolean(this.media.muted)}},{key:"hasAudio",get:function(){return!this.isHTML5||!!this.isAudio||Boolean(this.media.mozHasAudio)||Boolean(this.media.webkitAudioDecodedByteCount)||Boolean(this.media.audioTracks&&this.media.audioTracks.length)}},{key:"speed",set:function(e){var t=null;h.number(e)&&(t=e),h.number(t)||(t=this.storage.get("speed")),h.number(t)||(t=this.config.speed.selected),t<.1&&(t=.1),t>2&&(t=2),this.config.speed.options.includes(t)?(this.config.speed.selected=t,this.media.playbackRate=t):this.debug.warn("Unsupported speed (".concat(t,")"))},get:function(){return Number(this.media.playbackRate)}},{key:"quality",set:function(e){var t=this.config.quality,n=this.options.quality;if(n.length){var i=[!h.empty(e)&&Number(e),this.storage.get("quality"),t.selected,t.default].find(h.number),a=!0;if(!n.includes(i)){var s=function(e,t){return h.array(e)&&e.length?e.reduce(function(e,n){return Math.abs(n-t)<Math.abs(e-t)?n:e}):null}(n,i);this.debug.warn("Unsupported quality option: ".concat(i,", using ").concat(s," instead")),i=s,a=!1}t.selected=i,this.media.quality=i,a&&this.storage.set({quality:i})}},get:function(){return this.media.quality}},{key:"loop",set:function(e){var t=h.boolean(e)?e:this.config.loop.active;this.config.loop.active=t,this.media.loop=t},get:function(){return Boolean(this.media.loop)}},{key:"source",set:function(e){Ve.change.call(this,e)},get:function(){return this.media.currentSrc}},{key:"download",get:function(){var e=this.config.urls.download;return h.url(e)?e:this.source}},{key:"poster",set:function(e){this.isVideo?xe.setPoster.call(this,e,!1).catch(function(){}):this.debug.warn("Poster can only be set for video")},get:function(){return this.isVideo?this.media.getAttribute("poster"):null}},{key:"autoplay",set:function(e){var t=h.boolean(e)?e:this.config.autoplay;this.config.autoplay=t},get:function(){return Boolean(this.config.autoplay)}},{key:"currentTrack",set:function(e){ue.set.call(this,e,!1)},get:function(){var e=this.captions,t=e.toggled,n=e.currentTrack;return t?n:-1}},{key:"language",set:function(e){ue.setLanguage.call(this,e,!1)},get:function(){return(ue.getCurrentTrack.call(this)||{}).language}},{key:"pip",set:function(e){if(j.pip){var t=h.boolean(e)?e:!this.pip;h.function(this.media.webkitSetPresentationMode)&&this.media.webkitSetPresentationMode(t?pe:"inline"),h.function(this.media.requestPictureInPicture)&&(!this.pip&&t?this.media.requestPictureInPicture():this.pip&&!t&&document.exitPictureInPicture())}},get:function(){return j.pip?h.empty(this.media.webkitPresentationMode)?this.media===document.pictureInPictureElement:this.media.webkitPresentationMode===pe:null}}],[{key:"supported",value:function(e,t,n){return j.check(e,t,n)}},{key:"loadSprite",value:function(e,t){return ne(e,t)}},{key:"setup",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=null;return h.string(e)?i=Array.from(document.querySelectorAll(e)):h.nodeList(e)?i=Array.from(e):h.array(e)&&(i=e.filter(h.element)),h.empty(i)?null:i.map(function(e){return new t(e,n)})}}]),t}();return Ie.defaults=(Ae=de,JSON.parse(JSON.stringify(Ae))),Ie}())}),D={"04":{"N-eyf":"4j2LpBHEYOY","N-ey":"GLuOSjTap-M","N-vi":"BlacvxT1Xdk","C-vi":"4WtA-PbZf-s","R-vi":"7IGcDVP4YBY","R-ey":"VE6Lx58yI3I","W-vi":"Jxdu1X_LtaE"},22:{"N-eyf":"lkKsggceTb4","N-ey":"pnLXBP9Jzqk","N-vi":"CFFkrk9RwVg","C-vi":"5nWcsLwsVoY","R-vi":"jb8CK2i_EAo","R-ey":"9xwoE-o9HiY","W-vi":"z1C8pfXya-s"},23:{"N-eyf":"rMRwxgB7tu4","N-ey":"3-UyrpT3FXM","N-vi":"u8N8XXlZbtA","C-vi":"TcjujDC0pg0","R-vi":"eayOxTz01Vg","R-ey":"qszBAwr75R4","W-vi":"lW_lNF5gXdQ"}},B={debug:!1,controls:[],clickToPlay:!1,fullscreen:{enabled:!1,fallback:!1,iosNative:!1}},U=function(){function e(t,n){w(this,e),this.elementId=this.getElementId(t,n),this.filmId=this.getFilmId(n),this.element=this.createElement(t,this.elementId,this.filmId),this.film=this.createFilm(t,this.element)}return _(e,[{key:"getElementId",value:function(e,t){return e.screen.attr("id")+t.recordId+t.filmType}},{key:"getFilmId",value:function(e){return D[e.recordId][e.filmType]}},{key:"createElement",value:function(e,n,i){var a=t('\n\n  <div id="'.concat(n,'">\n    <iframe src="https://www.youtube.com/embed/').concat(i,"?").concat("modestbranding=1&showinfo=0&playsinline=1&enablejsapi=1",'"\n      crossorigin></iframe>\n  </div>\n          '));return e.screen.append(a),a}},{key:"createFilm",value:function(e,t){var n=new q(t,B);return n.cinema=e,n.on("ready",function(t){var n=t.detail.plyr;e.curtain.show(),e.loader.hide(),n.muted=!0,n.rewind(0),n.play()}),n.on("pause",function(){e.curtain.show(),e.loader.hide()}),n.on("seeking",function(){e.curtain.show(),e.loader.show()}),n.on("seeked",function(t){t.detail.plyr.$hidden||(e.loader.hide(),e.curtain.hide())}),n}}]),e}(),H=new(function(){function e(){w(this,e),this.films={},this.filmTypes=[{id:"N-eyf",disabled:!0},{id:"N-vi",disabled:!1},{id:"N-ey",disabled:!0},{id:"C-vi",disabled:!1},{id:"R-vi",disabled:!1},{id:"R-ey",disabled:!0},{id:"W-vi",disabled:!1}],this.activeRecordId=n.observable(null),this.activeFilmType=n.observable(null),this.activeDataItem=n.observable(null)}return _(e,[{key:"showFilm",value:function(e,t,n){if(n&&null!==e&&t){this.activeRecordId(e),this.activeFilmType(t),this.activeDataItem(n);var i=n.time,a=i.begin,s=i.end,r=this.getFilm(e,t).film,o=this;o.curtain.show(),o.loader.show(),a/=1e3,s/=1e3,r.$hidden=!0,r._playCount&&1===r._playCount?(r.currentTime=a-2.5,r._playCount=2):r._playCount&&r._playCount>1?(r.currentTime=a-.8,r._playCount=3):(r._playCount=1,setTimeout(function(){o.showFilm(e,t,n)},4e3)),void 0!==r._pauseFunction&&r.off("timeupdate",r._pauseFunction),r._pauseFunction=function(e){var t=e.detail.plyr;1!==!t._playCount&&(t.currentTime>=s-.01?(t.muted=!1,t.off("timeupdate",t._pauseFunction),delete t._pauseFunction,t.pause()):t.currentTime>=a-.1&&(delete t.$hidden,t.muted=!1,o.loader.hide(),o.curtain.hide()))},r.on("timeupdate",r._pauseFunction),r.muted=!0,r.play()}}},{key:"getFilm",value:function(e,t){var n=e+t,i=n in this.films?this.films[n]:new U(this,{recordId:e,filmType:t});return this.films[n]=i,this.hideAllBut(n),i}},{key:"pauseAll",value:function(){var e=this.films;Object.keys(e).forEach(function(t){return e[t].film.pause()})}},{key:"hideAllBut",value:function(e){var t=this.films;Object.keys(t).forEach(function(n){t[n].element[n===e?"show":"hide"]()})}},{key:"screen",get:function(){return t("#bmpp-videoPlayer")}},{key:"curtain",get:function(){return t(this.screen).find(".bmpp-videoCurtain")}},{key:"loader",get:function(){return t(this.screen).find(".bmpp-videoLoader")}}]),e}()),j={viewModel:{createViewModel:function(e){return{resultsData:e.resultsData,cinema:H}}},template:'\n\n  <div class="ui basic segment" data-bind="with: resultsData">\n\n    \x3c!-- ko ifnot: version === \'test\' --\x3e\n      '.concat('\n\n  <div data-bind="foreach: results" class="bmpp-searchResult">\n\n    <div class="ui label bmpp-recordLabel bmpp-initialRecordLabel"\n      data-bind="text: \'Запись \' + record_id,\n        visible: $index() === 0"></div>\n\n    <div class="divider" data-bind="visible: $index() > 0">\n      <div class="ui label bmpp-recordLabel"\n        data-bind="text: \'Запись \' + record_id,\n          visible: previousItem && previousItem.record_id !== record_id"></div>\n    </div>\n\n    <div class="bmpp-unitValue bmpp-context"\n      data-bind="text: left_context"></div>\n    <div class="bmpp-transcription bmpp-context"\n      data-bind="html: left_context"></div>\n\n    <div class="bmpp-unitValue"\n      data-bind="text: value, click: $component.cinema.showFilm\n        .bind($component.cinema, record_id, participant + \'-vi\', $data)\n        "></div>\n    <div class="bmpp-transcription"\n      data-bind="html: value, click: $component.cinema.showFilm\n        .bind($component.cinema, record_id, participant + \'-vi\', $data)\n        "></div>\n\n    <div class="bmpp-unitValue bmpp-context"\n      data-bind="text: right_context"></div>\n    <div class="bmpp-transcription bmpp-context"\n      data-bind="html: right_context"></div>\n\n  </div>\n\n',"\n    \x3c!-- /ko --\x3e\n\n    \x3c!-- ko if: version === 'test' --\x3e\n      ").concat('\n\n  <div data-bind="foreach: results" class="bmpp-searchResult">\n\n    <div class="ui label bmpp-recordLabel bmpp-initialRecordLabel"\n      data-bind="text: \'Запись \' + record_id,\n        visible: $index() === 0"></div>\n\n    <div class="divider" data-bind="visible: $index() > 0">\n      <div class="ui label bmpp-recordLabel"\n        data-bind="text: \'Запись \' + record_id,\n          visible: previousItem && previousItem.record_id !== record_id"></div>\n    </div>\n\n    <div class="bmpp-unitValue bmpp-context"\n      data-bind="text: before_context"></div>\n    <div class="bmpp-transcription bmpp-context"\n      data-bind="html: before_context_transcription"></div>\n\n    <div class="bmpp-unitValue"\n      data-bind="text: value, click: $component.cinema.showFilm\n        .bind($component.cinema, record_id, participant + \'-vi\', $data)\n        "></div>\n    <div class="bmpp-transcription"\n      data-bind="html: value_transcription, click: $component.cinema.showFilm\n        .bind($component.cinema, record_id, participant + \'-vi\', $data)\n        "></div>\n\n    <div class="bmpp-unitValue bmpp-context"\n      data-bind="text: after_context"></div>\n    <div class="bmpp-transcription bmpp-context"\n      data-bind="html: after_context_transcription"></div>\n\n  </div>\n\n',"\n    \x3c!-- /ko --\x3e\n\n  </div>\n\n")},$=/[A-Za-z]+(\d+).*/g,z=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];w(this,e),this.record_id=this.getRecordId(t.record_id),this.time=t.time,this.participant=t.participant,this.value=t.value,this.left_context=t.left_context,this.right_context=t.right_context,this.setup(),this.setupIfTest(t,n)}return _(e,[{key:"getRecordId",value:function(e){var t=e.split($);return 3===t.length?t[1]:"NoID"}},{key:"setup",value:function(){this.previousItem=null}},{key:"setupIfTest",value:function(e,t){t&&(this.value_transcription=e.value_transcription,this.before_context=e.before_context,this.before_context_transcription=e.before_context_transcription,this.after_context=e.after_context,this.after_context_transcription=e.after_context_transcription)}},{key:"setPreviousItem",value:function(e){this.previousItem=e}}]),e}(),W=function(){function e(t){w(this,e),this.version=t.version,this.results=this.getResults(t.results),this.setupIfTest(t)}return _(e,[{key:"getResults",value:function(e){var t=this,n=e.map(function(e){return new z(e,t.isTestResults)});return n.forEach(function(e,t,n){var i=t>0?n[t-1]:null;e.setPreviousItem(i)}),n}},{key:"setupIfTest",value:function(e){this.isTestResults&&(this.subcorpus=e.subcorpus,this.query=e.query)}},{key:"isTestResults",get:function(){return"test"===this.version}}]),e}();function G(e){var t=null,i=null;return{resultsData:n.computed(function(){var n=e.resultsRawData();if(null!==n&&n!==t){var a=new W(n);t=n,i=a}else null===n&&n!==t&&(t=null,i=null);return i}),cinema:H}}G.prototype.dispose=function(){this.resultsData.dispose()};for(var J={viewModel:{createViewModel:G},template:'\n\n  <div class="bmpp-resultsPane_video">\n\n    <div id="bmpp-videoPlayer">\n      <div class="bmpp-videoCurtain">\n        <div class="bmpp-videoLoader" style="display: none;"></div>\n      </div>\n    </div>\n\n    <div class="bmpp-videoChoices" data-bind="foreach: cinema.filmTypes">\n      <div data-bind="\n        text: id,\n        css: {\n          disabled: disabled || !$component.cinema.activeDataItem(),\n          current: $component.cinema.activeFilmType() === id\n        },\n        click: $component.cinema.showFilm.bind(\n          $component.cinema, $component.cinema.activeRecordId(),\n          id, $component.cinema.activeDataItem())\n        "></div>\n    </div>\n\n    <div class="bmpp-resultsInfo">\n\n      \x3c!-- ko if: resultsData() && resultsData().version === \'test\' --\x3e\n      <div style="margin-bottom: .33em; color: #a00;">\n        NB: Отображаются результаты условной выдачи!\n      </div>\n      \x3c!-- /ko --\x3e\n\n      <div style="margin-bottom: .33em;">\n        <em>Область поиска:</em>&#x2002;<span\n          data-bind="text: $root.subcorpusBanner"></span>\n      </div>\n\n      \x3c!-- ko if: resultsData() && resultsData().version === \'test\' --\x3e\n      <div style="margin-bottom: .33em;">\n        <em>Условие поиска:</em>&#x2002;<span\n        data-bind="text: resultsData().query"></span>\n      </div>\n      \x3c!-- /ko --\x3e\n      \x3c!-- ko if: resultsData() && resultsData().version !== \'test\'\n        && $root.queryTree.unitType() --\x3e\n      <div style="margin-bottom: .33em;" data-bind="with: $root.queryTree">\n        <em>Условие поиска:</em>&#x2002;<span data-bind="text:\n        unitType().hasAbbr ? unitType().abbr : unitType().name"></span\n        >\x3c!-- ko if: $root.chosenUnitProperties().length > 0 --\x3e, со следующими\n        свойствами: <span data-bind="foreach: $root.chosenUnitProperties"\n        >\x3c!-- ko if: $index() === 0 --\x3e<span\n        data-bind="textLowercaseFirstChar: name"></span><span\n        >:&#x2002;</span>\x3c!-- /ko --\x3e\x3c!-- ko ifnot: $index() === 0 --\x3e<span\n        data-bind="textLowercaseFirstChar: name"></span><span\n        >:&#x2002;</span>\x3c!-- /ko --\x3e<span data-bind="text: banner"></span\n        ><span data-bind="text:\n        $index() &lt; $root.chosenUnitProperties().length - 1 ?\n        \';&#x2002;\' : \'.\'"></span></span>\x3c!-- /ko --\x3e\x3c!-- ko if:\n        $root.chosenUnitProperties().length === 0 --\x3e.\x3c!-- /ko --\x3e\n      </div>\n      \x3c!-- /ko --\x3e\n\n      <div data-bind="if: $root.resultsNumber() !== null">\n        <em>Всего найдено:</em>&#x2002;<span\n          data-bind="text: $root.resultsNumber"></span>\n        \x3c!-- ko if: $root.resultsNumber() % 100 - $root.resultsNumber() % 10 === 10\n          || [5, 6, 7, 8, 9, 0].indexOf($root.resultsNumber() % 10) > 0 --\x3e\n          совпадений.\n        \x3c!-- /ko --\x3e\n        \x3c!-- ko if: $root.resultsNumber() % 100 - $root.resultsNumber() % 10 !== 10\n          && $root.resultsNumber() % 10 === 1 --\x3e\n          совпадение.\n        \x3c!-- /ko --\x3e\n        \x3c!-- ko if: $root.resultsNumber() % 100 - $root.resultsNumber() % 10 !== 10\n          && [2, 3, 4].indexOf($root.resultsNumber() % 10) > 0 --\x3e\n          совпадения.\n        \x3c!-- /ko --\x3e\n      </div>\n\n    </div>\n\n  </div>\n\n  <div class="bmpp-resultsPane_results" data-bind="if: resultsData">\n    <div data-bind="text: JSON.stringify(resultsData, null, 2)">\n    </div>\n    <results-list params="resultsData: resultsData"></results-list>\n\n    <div style="padding: 1em; background-color: #eee">\n      <header class="ui header">JSON ответа</header>\n      <code style="white-space: pre-wrap"\n        data-bind="text: $root.responseJSON"></code>\n    </div>\n\n    <div style="padding: 1em">\n      <header class="ui header">JSON запроса</header>\n      <code style="white-space: pre-wrap"\n        data-bind="text: $root.queryJSON"></pre></code>\n    </div>\n\n    <div style="padding: 1em; color: white; background-color: #a00;"\n         data-bind="visible: $root.resultsError">\n      <code style="white-space: pre-wrap"\n         data-bind="text: $root.resultsError"></code>\n    </div>\n\n  </div>\n\n'},Q=[{id:"voc",name:"Вокальные действия",unitsHeader:"Вокальные единицы",color:"red",types:[{name:"Верхний уровень сегментации",types:[{name:"Элементарная дискурсивная единица (ЭДЕ)",abbr:"ЭДЕ",id:"u_vEDU"},{name:"Изолированный смех",id:"u_vLaughLine"},{name:"Изолированный кластер заполненных пауз",id:"u_vFilledLine"},{name:"Самостоятельное неречевое вокальное явление",id:"u_vNonVerbalLine"}]},{name:"Нижний уровень сегментации",types:[{name:"Слово",id:"u_vWord"},{name:"Cмех",id:"u_vLaughSegm"},{name:"Заполненная пауза",id:"u_vFilledSegm"},{name:"Пауза со вдохом",id:"u_vHPause"},{name:"Неречевое вокальное действие",id:"u_vOtherSegm"},{name:"Абсолютная пауза",id:"u_v--AbsolutePause"}]},{name:"Параллельный уровень сегментации",types:[{name:"Вокальное явление, накладывающееся на речь",id:"u_vCollat"}]}]},{id:"ocul",name:"Направление взора",unitsHeader:"Единицы окуломоторного канала",color:"orange",types:[{name:"Фиксация",id:"u_oFixation"}]},{id:"facial",name:"Мимика",unitsHeader:"Единицы канала мимики",color:"yellow",disabled:!0,types:[]},{id:"ceph",name:"Жесты головы",unitsHeader:"Единицы цефалической жестикуляции",color:"green",types:[{name:"Базовый уровень сегментации",types:[{name:"Движение",id:"u_c1"},{name:"Неподвижность",id:"u_c2"}]},{name:"Дополнительный уровень сегментации",types:[{name:"Жест",id:"u_c3"},{name:"Адаптор",id:"u_c4"},{name:"Смена позы",id:"u_c5"}]}]},{id:"manu",name:"Жесты рук",unitsHeader:"Единицы мануальной жестикуляции",color:"teal",types:[{name:"Первый уровень сегментации",types:[{name:"Движение",id:"u_mMovement",tiers:["-mLtMovement","-mRtMovement"]},{name:"Неподвижность",id:"u_mStillness",tiers:["-mLtStillness","-mRtStillness"]}]},{name:"Второй уровень сегментации",types:[{name:"Жест",id:"u_mGesture",tiers:["-mGesture"]},{name:"Адаптор",id:"u_mAdaptor",tiers:["-mAdaptor"]},{name:"Смена позы",id:"u_mPostureAccomodator",tiers:["-mPostureAccomodator"]}]},{name:"Третий уровень сегментации",types:[{name:"Мануальная поза",id:"u_mPosture",tiers:["-mPosture"]},{name:"Фаза перехода",id:"u_mPostureChange",tiers:["-mPostureChange"]},{name:"Двигательная цепочка",id:"u_mMovementChain",tiers:["-mMovementChain"]},{name:"Жестовая цепочка",id:"u_mGestureChain",tiers:["-mGestureChain"]}]}]},{id:"torso",name:"Движения тела",unitsHeader:"Единицы жестикуляции тела",color:"blue",disabled:!0,types:[]},{id:"prox",name:"Проксемика",unitsHeader:"Единицы проксемики",color:"violet",disabled:!0,types:[]}],K=function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;w(this,e),this.id=t.id,this.name=t.name,this.channel=n,this.group=i,this.hasAbbr=Boolean(t.abbr),this.abbr=t.abbr||"",t.tiers&&(this.tiers=t.tiers)},Y=function(){function e(t,n){w(this,e),this.name=t.name,this.channel=n,this.units=[],this.totalNumberOfUnits=0,this.populateUnits(t)}return _(e,[{key:"populateUnits",value:function(e){var t=!0,n=!1,i=void 0;try{for(var a,s=e.types[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var r=a.value;this.units.push(new K(r,this.channel,this)),this.totalNumberOfUnits+=1}}catch(e){n=!0,i=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw i}}}}]),e}(),X=function(){function e(t){w(this,e),this.id=t.id,this.name=t.name||"",this.unitsHeader=t.unitsHeader||"",this.color=t.color,this.disabled=t.disabled,this.groups=[],this.units=[],this.totalNumberOfUnits=0,this.populateGroupsAndUnits(t)}return _(e,[{key:"populateGroupsAndUnits",value:function(e){var t=!0,n=!1,i=void 0;try{for(var a,s=e.types[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var r=a.value;if(r.types){var o=new Y(r,this);this.groups.push(o),this.totalNumberOfUnits+=o.totalNumberOfUnits}else this.units.push(new K(r,this)),this.totalNumberOfUnits+=1}}catch(e){n=!0,i=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw i}}}},{key:"getSingleUnit",value:function(){if(1===this.totalNumberOfUnits){var e,t=(e=this.units.slice()).concat.apply(e,L(this.groups.map(function(e){return e.units.slice()})));if(t.length>0)return t[0]}return null}}]),e}(),Z=[],ee=0;ee<Q.length;ee++){var te=Q[ee];Z.push(new X(te))}var ne='\n\n  <header class="ui header">Единицы поиска</header>\n\n  <p>Чтобы выбрать единицу поиска, сначала укажите область разметки\n  в верхнем меню, а затем нажмите на нужный вам тип единицы.</p>\n\n',ie='\n\n  <li data-bind="click: $component.iHaveChosenUnitType.bind($data),\n                 css: { active: $component.node.unitType() &&\n                                $component.node.unitType().id === id }">\n    <span class="unitSelectionContainer">\n      <span class="unit" data-bind="text: name"></span>\n    </span>\n  </li>\n\n',ae='\n\n  <div>\n    \x3c!-- ko foreach: channelViewModels --\x3e\n    <button class="ui button bmpp-channelSlug"\n      data-bind="css: buttonCSS, text: channel.id,\n        popup: tooltip, popupOpts: channelPopupOpts,\n        popupAdditionalShowOnClick: disabled,\n        event: { click: onClick, mouseover: onMouseOver,\n                 mouseout: onMouseOut }">\n    </button>\n    \x3c!-- /ko --\x3e\n\n    <i class="disabled grey question circle outline icon bmpp-channelsHelp"\n      data-bind="popup: channelsHelp.html, popupOpts: channelsHelp.opts"></i>\n  </div>\n\n  \x3c!-- ko if: activeChannel --\x3e\n  <div data-bind="with: activeChannel" style="margin-top: 2em">\n    <header class="ui tiny header"\n      data-bind="text: channel.unitsHeader"></header>\n    <div style="column-count: 2">\n\n      \x3c!-- ko if: channel.groups --\x3e\n      <ul class="bmpp-unitGroups" data-bind="foreach: channel.groups">\n        <li>\n          <header data-bind="text: name"></header>\n          <ul class="bmpp-units" data-bind="foreach: units">\n            '.concat(ie,'\n          </ul>\n        </li>\n      </ul>\n      \x3c!-- /ko --\x3e\n\n      \x3c!-- ko if: channel.units --\x3e\n      <ul class="bmpp-units" data-bind="foreach: channel.units">\n        ').concat(ie,"\n      </ul>\n      \x3c!-- /ko --\x3e\n\n    </div>\n  </div>\n  \x3c!-- /ko --\x3e\n\n"),se="\n\n  \x3c!-- ko if: node.isEditStateForUnitType --\x3e\n  ".concat(ae,"\n  \x3c!-- /ko --\x3e\n\n  \x3c!-- ko ifnot: node.isEditStateForUnitType --\x3e\n  ").concat('\n  <div>\n    \x3c!-- ko with: activeChannel --\x3e\n    <button class="ui button bmpp-channelSlug"\n      data-bind="css: channel.color, text: channel.id,\n        popup: tooltip, popupOpts: channelPopupOpts">\n    </button>\n    \x3c!-- /ko --\x3e\n\n    \x3c!-- ko with: node.unitType --\x3e\n    <span class="bmpp-unitTypeAndGroup">\n      \x3c!-- ko if: group --\x3e\n        <span data-bind="textLowercaseFirstChar: group.name"\n          class="bmpp-unitTypeGroup"></span>\n      \x3c!-- /ko --\x3e\n      <span class="bmpp-unitType"\n      data-bind="css: { \'bmpp-unitTypeWithGroup\': group }">\n        Тип единицы:\n        <strong data-bind="text: hasAbbr ? abbr : name"\n          style="padding-left: .5em;"></strong>\n      </span>\n    </span>\n    \x3c!-- /ko --\x3e\n\n    \x3c!-- ko if: node.chosenUnitProperties().length > 0 --\x3e\n    <div data-bind="foreach: node.chosenUnitProperties"\n      style="margin: 1.5em 0 2.5em 0"\n      >\x3c!-- ko if: $index() === 0 --\x3e<span class="bmpp-bannerPropname"\n      data-bind="text: name"></span><span class="bmpp-bannerText"\n      >:&#x2002;</span>\x3c!-- /ko --\x3e\x3c!-- ko ifnot: $index() === 0 --\x3e<span\n      class="bmpp-bannerPropname" data-bind="textLowercaseFirstChar: name"\n      ></span><span class="bmpp-bannerText">:&#x2002;</span>\x3c!-- /ko --\x3e<span\n      data-bind="text: banner" class="bmpp-bannerPropvalue"></span><span\n      class="bmpp-bannerText" data-bind="text: $index() &lt; $parent.node.\n      chosenUnitProperties().length - 1 ? \';&#x2002;\' : \'.\'"></span\n    ></div>\n    \x3c!-- /ko --\x3e\n\n    <div style="position: absolute; bottom: 0.8em;">\n      <span data-bind="click: goEditUnitType" class="bmpp-editUrl">\n        Изменить тип единицы\n      </span>\n      <span data-bind="click: goEditUnitProperties" class="bmpp-editUrl"\n        style="margin-left: 1em">\n        <span data-bind="text: isAnyUnitPropertySet() ? \'Изменить\' : \'Задать\'">\n        </span> свойства единицы\n      </span>\n    </div>\n  </div>\n',"\n  \x3c!-- /ko --\x3e\n\n"),re=function(){function e(t,i,a){w(this,e);var s=this;this.channel=t,this.isActive=n.computed(function(){var e=i();return e&&e.channel&&e.channel.id===s.channel.id}),this.isMouseOver=n.observable(!1),this.onMouseOver=function(){s.isMouseOver(!0)},this.onMouseOut=function(){s.isMouseOver(!1)},this.disabled=this.channel.disabled||0===s.channel.totalNumberOfUnits,this.onClick=function(){s.disabled||(1===s.channel.totalNumberOfUnits?(i(s),a.call(s.channel.getSingleUnit())):i(s))},this.buttonCSS=n.computed(function(){var e=s.isActive(),t=s.isMouseOver();return i()?e||t?s.channel.color:"".concat(s.channel.color," basic"):s.channel.color})}return _(e,[{key:"tooltip",get:function(){return this.disabled?this.channel.name+'\n\n  <div style="font-size: smaller; font-style: italic">\n    Аннотация пока не готова.\n  </div>\n\n':this.channel.name}},{key:"channelPopupOpts",get:function(){return{variation:"basic",delay:{show:700,hide:0},duration:400,transition:"fade",onVisible:function(e){setTimeout(function(e){t(e).popup("hide")}.bind(this,e),1700)}}}}]),e}(),oe={viewModel:function(){function e(t){w(this,e);var i=t.node,a=i.unitType(),s=a&&a.channel,r=n.observable(null),o=t.queryPartsNonReadiness,l=function(){i.isEditStateForUnitType(!0)},c=function(){i.unitType(this),i.isEditStateForUnitType(!1),t.isQueryNew(!0)},u=n.computed(function(){return i.unitProperties().some(function(e){return null!==e.value()})}).extend({rateLimit:500}),d=[];o.push(i.isEditStateForUnitType);var p=!0,h=!1,m=void 0;try{for(var f,v=Z[Symbol.iterator]();!(p=(f=v.next()).done);p=!0){var b=f.value,g=new re(b,r,c);d.push(g),s&&s.id===b.id&&r(g)}}catch(e){h=!0,m=e}finally{try{p||null==v.return||v.return()}finally{if(h)throw m}}a||l(),this.node=i,this.channelViewModels=d,this.channelsHelp={html:ne,opts:{variation:"basic",delay:{show:400,hide:0},duration:400}},this.activeChannel=r,this.queryPartsNonReadiness=o,this.goEditUnitType=l,this.goEditUnitProperties=function(){t.editNodeProperties(i)},this.iHaveChosenUnitType=c,this.iHaveChosenUnitProperties=function(){t.finishEditingNodeProperties(),t.isQueryNew(!0)},this.isAnyUnitPropertySet=u}return _(e,[{key:"dispose",value:function(){this.queryPartsNonReadiness.remove(this.node.isEditStateForUnitType)}}]),e}(),template:se},le={viewModel:{createViewModel:function(e,t){return e.property}},template:'\n\n  <div class="ui top attached segment">\n    <div class="ui top attached large label">\n      <header class="bmpp-propertyHeader" data-bind="text: name,\n        click: onHeaderClick.bind($component),\n        css: { clickable: $component.isHeaderClickable }">\n      </header>\n      \x3c!-- ko if: help --\x3e\n        <i class="disabled question circle outline icon bmpp-nearLabelIcon"\n          data-bind="popup: help"></i>\n      \x3c!-- /ko --\x3e\n    </div>\n    <div class="ui hidden divider"></div>\n\n    \x3c!-- ko if: type === \'text\' --\x3e\n      <text-property params="property: $component"></text-property>\n    \x3c!-- /ko --\x3e\n\n    \x3c!-- ko if: type === \'interval\' --\x3e\n      <interval-property params="property: $component"></interval-property>\n    \x3c!-- /ko --\x3e\n\n    \x3c!-- ko if: type === \'list\' --\x3e\n      <list-property params="property: $component"></list-property>\n    \x3c!-- /ko --\x3e\n  </div>\n\n  <div class="ui bottom attached info mini message" style="margin-bottom: 1em;">\n    <div class="ui grid" style="margin: 0!important; padding: 0 !important">\n      <div class="ui eight wide column"\n        style="margin: 0!important; padding: 0 !important">\n\n        \x3c!-- ko if: jsonProperties().length === 0 --\x3e\n          Свойство не будет включено в запрос\n        \x3c!-- /ko --\x3e\n        \x3c!-- ko if: banner --\x3e\n          <em data-bind="text: name"></em>:\n          <span data-bind="text: banner"></span>\n        \x3c!-- /ko --\x3e\n\n      </div>\n      <div class="ui eight wide column"\n        style="margin: 0!important; padding: 0 0 0 1em !important;">\n\n        <code style="font-size: smaller;">\n        \x3c!-- ko foreach: jsonProperties --\x3e\n          <span data-bind="text: JSON.stringify(prop, null, 1)"></span>:\n          <span data-bind="text: JSON.stringify(value, null, 1)"></span>\x3c!--\n            ko if: $index() !== $component.jsonProperties().length - 1 --\x3e,\n            \x3c!-- /ko --\x3e\n        \x3c!-- /ko --\x3e\n        </code>\n\n      </div>\n    </div>\n  </div>\n\n'},ce={viewModel:{createViewModel:function(e,n){for(var i=e.records,a=e.recordPhases,s={variation:"basic",delay:{show:400,hide:0},duration:400},r=[{html:"\n\n  <p>При выборе одного или нескольких вариантов поиск будет\n  вестись только по указанным записям. В&nbsp;настоящий момент\n  для поиска доступны 4 из 6 записей.</p>\n\n",selector:".bmpp-recordsHelp"},{html:"\n\n  <p>При выборе одного или нескольких вариантов поиск будет\n  вестись только по указанным этапам: рассказу, разговору или\n  пересказу.</p>\n\n",selector:".bmpp-recordsPhasesHelp"}],o=0;o<r.length;o++){var l=r[o],c=l.html,u=l.selector;s.html=c,t(n.element).find(u).popup(s)}return{records:i,recordPhases:a,subcorpusClearSelection:function(){i.areAllUnchecked()||i.clearSelection(),a.areAllUnchecked()||a.clearSelection()}}}},template:'\n\n  <h1 class="ui header">Область поиска</h1>\n  <div class="ui grid">\n    <div class="ten wide column" data-bind="with: records">\n      <div class="ui padded segment bmpp-subcorpusForm">\n        <div class="ui top attached large label">\n          <header data-bind="click: invertSelection">\n            Записи\n          </header>\n          <i class="disabled question circle outline icon\n                    bmpp-nearLabelIcon bmpp-recordsHelp"></i>\n        </div>\n\n        <div class="ui form" data-bind="foreach: fields">\n          <div class="field">\n            <bmpp-checkbox params="value: value, label: label,\n              disabled: disabled, tabindex: $index,\n              disabledTooltip: \'Запись пока не готова\'"></bmpp-checkbox>\n          </div>\n        </div>\n\n      </div>\n    </div>\n\n    <div class="six wide column" data-bind="with: recordPhases">\n      <div class="ui padded segment bmpp-subcorpusForm">\n        <div class="ui top attached large label">\n          <header data-bind="click: invertSelection">\n            Этапы записей\n          </header>\n          <i class="disabled question circle outline icon\n             bmpp-nearLabelIcon bmpp-recordsPhasesHelp"></i>\n        </div>\n        <form class="ui form" data-bind="foreach: fields">\n          <div class="field">\n            <bmpp-checkbox params="value: value, label: label,\n              tabindex: $index() + $root.subcorpus.records.fields.length">\n            </bmpp-checkbox>\n          </div>\n        </form>\n\n      </div>\n    </div>\n\n    <div>\n      <button class="ui small button three wide column"\n        data-bind="click: subcorpusClearSelection">Очистить</button>\n      <button class="ui small button three wide column">Отмена</button>\n    </div>\n\n  </div>\n\n'},ue={viewModel:{createViewModel:function(e,t){return e.property}},template:'\n\n  <div class="ui small input">\n    <input type="text" data-bind="value: value, valueUpdate: \'input\',\n      attr: { placeholder: placeholder }">\n  </div>\n\n'},de={viewModel:{createViewModel:function(e,n){var i={on:"focus",inline:!0,position:"bottom left",variation:"basic fluid",preserve:!0,closable:!1,hideOnScroll:!1,delay:{show:50,hide:300},duration:300,lastResort:!0};return t(n.element).find('.bmpp-editableListItem input[type="text"]').popup(i),{virtualKeyboardPopupOpts:i,listProperty:e.valueList.listProperty,valueList:e.valueList}}},template:'\n\n  <ul data-bind="foreach: valueList.items" class="bmpp-valueList">\n    <li>\n      <bmpp-checkbox params="label: name,\n        value: userChecked, disabled: disabled"></bmpp-checkbox>\n\n      \x3c!-- ko if: editable --\x3e\n        <div class="ui mini input bmpp-editableListItem">\n\n          <input type="text"\n            data-bind="value: value, valueUpdate: \'input\',\n              inlinePopup: $component.virtualKeyboardPopupOpts">\n\n          \x3c!-- ko if: $component.listProperty.virtualKeyboard --\x3e\n          <div class="ui basic popup hidden">\n            \x3c!-- ko foreach: $component.listProperty.validChars --\x3e\n              <button class="ui mini button" data-bind="text: $data,\n                click: $component.listProperty.insertText($data, $element,\n                  $parent.value)"></button>\n            \x3c!-- /ko --\x3e\n          </div>\n          \x3c!-- /ko --\x3e\n\n        </div>\n      \x3c!-- /ko --\x3e\n\n      \x3c!-- ko if: $component.listProperty.displayValues &&\n                  [true, false, null, undefined].indexOf(value) < 0 &&\n                  !editable --\x3e\n        \x3c!-- ko if: value instanceof Array --\x3e\n          (\x3c!-- ko foreach: value --\x3e<span data-bind="if: $index() > 0">,\n            </span><span data-bind="text: $data" class="bmpp-listItemValue">\n            </span>\x3c!-- /ko --\x3e)\n        \x3c!-- /ko --\x3e\n        \x3c!-- ko ifnot: value instanceof Array --\x3e\n          (<span data-bind="text: value" class="bmpp-listItemValue"></span>)\n        \x3c!-- /ko --\x3e\n      \x3c!-- /ko --\x3e\n\n      \x3c!-- ko if: childList --\x3e\n        <bmpp-value-list params="valueList: childList"></bmpp-value-list>\n      \x3c!-- /ko --\x3e\n\n    </li>\n  </ul>\n\n'};var pe={type:"list",name:"Рука",id:"p_mHand",valueList:{orValues:[{name:"Левая",value:"Lt"},{name:"Правая",value:"Rt"}]}};function he(e,t){var n=JSON.parse(JSON.stringify(e));return n.id=t,n}var me={type:"list",name:"Изолированность",valueList:{orValues:[{name:"Внутри ЭДЕ",value:"In"},{name:"Отдельно",value:"Out"}]}},fe=he(me,"p_vHInOutEDU"),ve=he(me,"p_vLInOutEDU"),be=he(me,"p_vOInOutEDU"),ge={type:"list",name:"Соседство с изолированными паузами",valueList:{orValues:[{name:"Непосредственно перед паузой",value:"Before"},{name:"Непосредственно после паузы",value:"After"},{name:"Непосредственно между паузами",value:"Between"},{name:"Не соседствует с паузами",value:!1}]}},ye=he(ge,"p_vHNearPause"),ke=he(ge,"p_vLNearPause"),we=he(ge,"p_vONearPause"),xe=he(ge,"p_vWNearPause"),_e=[{type:"interval",name:"Длительность",id:"duration",step:20,units:"миллисекунд",unitsBanner:"мс",fromOnlyBanner:"не менее ##",toOnlyBanner:"не более ##",fromToEqualBanner:"ровно ##",help:'<header class="ui header">Интервал длительности единицы</header>\n  <p>Чтобы отобрать единицы, длительность которых не меньше указанной,\n  заполните только левое поле. Чтобы отобрать единицы, длительность которых\n  не больше указанной, заполните только правое поле. Свойство не будет\n  учитываться в запросе, если ничего не задать.</p>'},{type:"list",name:"Участники",id:"participants",valueList:{orValues:[{name:"Рассказчик",value:"N"},{name:"Комментатор",value:"C",disabledInChannels:["ocul"]},{name:"Пересказчик",value:"R"}]}},{type:"list",name:"Совпадение участников",id:"same_participant",valueList:{xorValues:[{name:"Да",value:!0},{name:"Нет",value:!1}]}}],Te=_e,Ce={u_vEDU:_e.concat([{type:"list",name:"Иллокутивно-фазовое значение",id:"p_vIllocPhase",displayValues:!0,valueList:{orValues:[{name:"Иллокутивное",orValues:[{name:"Завершение сообщения",value:"."},{name:"Вопрос",value:"?"},{name:"Директив",value:"¡"},{name:"Обращение",value:"@"},{name:"Полуутверждение",value:"¿"},{name:"Неполнота информации",value:"…"},{name:"Восклицательность",value:"!"}]},{name:"Фазовое",orValues:[{name:"Стандартная незавершенность",value:","},{name:"Незавершенность, восполняемая последующим контекстом",value:":"},{name:"Неполнота информации в контексте незавершенности",value:",,,"},{name:"Начальная часть сплита",value:"—"}]},{name:"Обрыв",addNameToChildNames:!0,orValues:[{name:"При самоисправлении",value:"=="},{name:"При апосиопезе",value:"~"},{name:"При вмешательстве собеседника",value:"≈≈"}]}]}},{type:"interval",name:"Число слов",id:"p_vWordsCount",fromOnlyBanner:"## и более",toOnlyBanner:"## и менее"},{type:"interval",name:"Число абсолютных пауз",id:"p_vPausesCount",fromOnlyBanner:"## и более",toOnlyBanner:"## и менее"},{type:"interval",name:"Число заполненных пауз",id:"p_vFilledCount",fromOnlyBanner:"## и более",toOnlyBanner:"## и менее"},{type:"list",name:"Начинается с заполненной паузы",id:"p_vStartFilled",valueList:{xorValues:[{name:"Да",value:"Yes"},{name:"Нет",value:!1}]}},{type:"list",name:"Комбинация иллокутивно-фазовых значений",id:"p_vCombIllocPhase",valueList:{orValues:[{name:"Не-сообщение + незавершенность",value:"NonStNonFinal"},{name:"Не-сообщение + неполнота информации",value:"NonStDots"},{name:"Не-сообщение + восклицательность",value:"NonStExclam"},{name:"Незавершенность + обрыв",value:"NonFinalTrunc"},{name:"Прочее",value:"Other"}]}},{type:"interval",name:"Число точек прерывания",id:"p_vInterruptCount",fromOnlyBanner:"## и более",toOnlyBanner:"## и менее"},{type:"interval",name:"Число акцентов",id:"p_vAccentsCount",fromOnlyBanner:"## и более",toOnlyBanner:"## и менее"},{type:"interval",name:"Число главных акцентов",id:"p_vMainAccentsCount",fromOnlyBanner:"## и более",toOnlyBanner:"## и менее"},{type:"interval",name:"Число вторичных акцентов после главного",id:"p_vAccentsAfterMainCount",fromOnlyBanner:"## и более",toOnlyBanner:"## и менее"},{type:"list",name:"Движение тона в главном акценте",id:"p_vMainAccents",displayValues:!0,valueList:{orValues:[{name:"Восходящее",value:"/"},{name:"Нисходящее",value:"\\"},{name:"Ровное",value:"–"},{name:"Восходяще-нисходящее",value:["/\\","/↓","↑\\"]},{name:"Восходяще-ровное",value:["/–","/→"]},{name:"Нисходяще-восходящее",value:["\\/","\\↑"]},{name:"Другой вариант",editable:!0}]},virtualKeyboard:!0,validChars:["/","\\","–","↑","↓","→"],substitute:[[/[-\u2014\u2012]/g,"–"]]},{type:"list",name:"Входит в конструкцию со вставкой",id:"p_vParenth",valueList:{xorValues:[{name:"Да",orValues:[{name:"Непосредственно предшествует вставке",value:"Enter"},{name:"Первая ЭДЕ сложной вставки",value:"Start"},{name:"Последняя ЭДЕ сложной вставки",value:"Final"},{name:"Внутренняя ЭДЕ сложной вставки",value:"Inside"},{name:"Единственная ЭДЕ простой вставки",value:"Full"},{name:"Непосредственно следует за вставкой",value:"Return"},{name:"Первая ЭДЕ односторонней вставки",value:"*Start"}]},{name:"Нет",value:!1}]}},{type:"list",name:"Входит в конструкцию со сплитом",id:"p_vInSplit",valueList:{xorValues:[{name:"Да",value:"InSplit"},{name:"Нет",value:!1}]}},{type:"list",name:"Входит в совместное построение реплик",id:"p_vCoConstr",valueList:{xorValues:[{name:"Да",orValues:[{name:"Достраивается другим участником",value:"Prelim"},{name:"Достраивает реплику другого участника",value:"Final"},{name:"И то, и другое",value:"Both"}]},{name:"Нет",value:!1}]}},{type:"list",name:"Входит в конструкцию с (полу)прямой цитацией",id:"p_vCitation",valueList:{xorValues:[{name:"Да",orValues:[{name:"Вводит чужую речь (авторская ремарка)",value:"Frame"},{name:"Первая ЭДЕ сложной цитации",value:"Begin"},{name:"Последняя ЭДЕ сложной цитации",value:"End"},{name:"Внутренняя ЭДЕ сложной цитации",value:"Within"},{name:"Единственная ЭДЕ простой цитации",value:"Whole"}]},{name:"Нет",value:!1}]}}]),u_vWord:_e.concat([{type:"text",name:"Словарная форма",id:"p_vWForm",placeholder:"…"},xe,{type:"list",name:"Идеофон",id:"p_vOnom",valueList:{xorValues:[{name:"Да",value:"Onom"},{name:"Нет",value:!1}]}},{type:"list",name:"Оборванное слово",id:"p_vTruncated",valueList:{xorValues:[{name:"Да",value:"Truncated"},{name:"Нет",value:!1}]}},{type:"interval",name:"Позиция от начала ЭДЕ",id:"p_vWordNum",fromOnlyBanner:"##‐я и дальше",toOnlyBanner:"##‐я и ближе",fromLabel:"с",toLabel:"по",fromToBanner:"##–##"},{type:"interval",name:"Позиция от конца ЭДЕ",id:"p_vWordNumReversed",fromOnlyBanner:"##‐я и дальше",toOnlyBanner:"##‐я и ближе",fromLabel:"с",toLabel:"по",fromToBanner:"##–##"},{type:"list",name:"Точка прерывания",id:"p_vInterrupt",valueList:{xorValues:[{name:"Да",orValues:[{name:"При самоисправлении внутри ЭДЕ",value:"Mild"},{name:"При самоисправлении на границе ЭДЕ",value:"Severe"},{name:"При вмешательстве внутри ЭДЕ",value:"Mild-other"},{name:"При вмешательстве на границе ЭДЕ",value:"Severe-other"}]},{name:"Нет",value:!1}]}},{type:"list",name:"С акцентом",id:"with_accent",displayValues:!0,valueList:{xorValues:[{name:"Да",orValues:[{name:"С восходящим тоном",value:"/"},{name:"С нисходящим тоном",value:"\\"},{name:"С ровным тоном",value:"–"},{name:"С восходяще-нисходящим тоном",value:["/\\","/↓","↑\\"]},{name:"С восходяще-ровным тоном",value:["/–","/→"]},{name:"С нисходяще-восходящим тоном",value:["\\/","\\↑"]},{name:"Другой вариант",editable:!0}]},{name:"Нет",value:!1}]},virtualKeyboard:!0,validChars:["/","\\","–","↑","↓","→"],substitute:[[/[-\u2014\u2012]/g,"–"]]},{type:"list",name:"С главным акцентом",id:"p_vMainAccent",valueList:{xorValues:[{name:"Да",value:"Main"},{name:"Нет",value:!1}]}},{type:"list",name:"Редуцированное произнесение",id:"p_vReduction",valueList:{xorValues:[{name:"Да",orValues:[{name:"Всего слова",value:"Full"},{name:"Части слова",value:"Part"}]},{name:"Нет",value:!1}]}},{type:"list",name:"Смещенный тональный регистр",id:"p_vRegister",valueList:{xorValues:[{name:"Да",orValues:[{name:"Повышенный",value:"Hi"},{name:"Сниженный",value:"Lo"}]},{name:"Нет",value:!1}]}},{type:"list",name:"Удлиненная реализация фонем",id:"p_vLength",valueList:{xorValues:[{name:"Да",value:"Len"},{name:"Нет",value:!1}]}},{type:"list",name:"Темп произнесения",id:"p_vTempo",valueList:{orValues:[{name:"Нейтральный",value:!1},{name:"Ускоренный",value:"Fast"},{name:"Замедленный",value:"Slow"}]}},{type:"list",name:"Эмфатическое произнесение",id:"p_vEmph",valueList:{xorValues:[{name:"Да",value:"Emph"},{name:"Нет",value:!1}]}},{type:"list",name:"Нестандартное лексическое ударение",id:"p_vStress",valueList:{xorValues:[{name:"Да",value:"Stress"},{name:"Нет",value:!1}]}},{type:"list",name:"Особенности произнесения начала / конца словоформы",id:"p_vStops",valueList:{orValues:[{name:"Гласный («шва»-) призвук в начале словоформы",value:"Schw-st"},{name:"Гортанная смычка («твердый приступ») в начале словоформы",value:"Gl-st"},{name:"Гласный («шва»-) призвук в конце словоформы",value:"Schw-en"},{name:"Гортанная смычка («твердый приступ») в конце словоформы",value:"Gl-en"},{name:"Губная смычка в конце словоформы",value:"Lab-en"},{name:"Придыхание в конце словоформы",value:"Asp-en"}]}}]),u_vLaughSegm:_e.concat([ve,ke]),u_vHPause:_e.concat([fe,ye]),u_vOtherSegm:_e.concat([be,we,{type:"list",name:"Тип действия",id:"p_vOForm",valueList:{orValues:[{name:"Цоканье",value:"f1"},{name:"Чмоканье",value:"f2"},{name:"Фырканье",value:"f3"},{name:"Шмыганье",value:"f4"},{name:"Сглатывание",value:"f5"},{name:"Откашливание",value:"f6"},{name:"Свист",value:"f7"},{name:"Вздох",value:"f8"},{name:"Кашель",value:"f9"}]}}]),u_vCollat:_e.concat([{type:"list",name:"Тип явления",id:"p_vCollatForm",valueList:{orValues:[{name:"Смех",value:"{laugh}"},{name:"Улыбка",value:"{smile}"},{name:"Скрипучий голос",value:"{creaky}"}]}}]),u_oFixation:_e.concat([{type:"list",name:"Объект взгляда",id:"p_oInterlocutor",displayValues:!0,valueList:{orValues:[{name:"Рассказчик",value:"N"},{name:"Комментатор",value:"C"},{name:"Пересказчик",value:"R"},{name:"Слушатель",value:"L"},{name:"Прочее",value:"Other"}]}},{type:"list",name:"Локус взгляда",id:"p_oLocus",valueList:{orValues:[{name:"Лицо",value:"Face"},{name:"Руки",value:"Hands"},{name:"Тело",value:"Body"},{name:"Прочее",value:"Other"}]}}]),u_mMovement:_e.concat([pe,{type:"list",name:"Тип движения",id:"p_mMtType",valueList:{orValues:[{name:"Подготовка",value:"P"},{name:"Мах",value:"S"},{name:"Ретракция",value:"R"},{name:"Независимая смена положения",value:"PnC-In"},{name:"Зависимая смена положения",value:"PnC-Dp"},{name:"Неструктурированное движение",value:"U"},{name:"Иное",value:"Other"}]}}]),u_mStillness:_e.concat([pe,{type:"list",name:"Тип неподвижности",id:"p_mStType",valueList:{orValues:[{name:"Удержание",value:"Hold"},{name:"Покой",value:"Reset"},{name:"Зависание",value:"Frozen"}]}}]),u_mStroke:_e.concat([{type:"list",name:"Рукость",id:"p_mStrokeHandedness",valueList:{orValues:[{name:"Левая рука",value:"L"},{name:"Правая рука",value:"R"},{name:"Обе руки",value:"B"}]}},{type:"list",name:"Тип длительности",id:"p_mStrokeLenType",valueList:{orValues:[{name:"Короткий",value:"s"},{name:"Средний",value:"m"},{name:"Длинный",value:"l"}]}}]),u_mAdaptor:_e.concat([{type:"list",name:"Тип адаптора",id:"p_mAdType",valueList:{orValues:[{name:"Четкий адаптор",value:"Adaptor1"},{name:"Нечеткий адаптор",value:"Adaptor2"},{name:"Комбинированный адаптор (тип 1)",value:"Adaptor1+2"},{name:"Комбинированный адаптор (тип 2)",value:"Adaptor2+1"},{name:"Другое",value:"Other"}]}}]),u_mGesture:_e.concat([{type:"list",name:"Рукость",id:"p_mGeHandedness",valueList:{orValues:[{name:"Леворучный",value:"Lt"},{name:"Праворучный",value:"Rt"},{name:"Двуручный с симетричной траекторией",value:"Bh-sym"},{name:"Двуручный с идентичной / единой траекторией",value:"Bh-id"},{name:"Двуручный с различной траекторией у разных рук",value:"Bh-dif"},{name:"Прочее",value:"Other"}]}},{type:"list",name:"Фазовая структура",id:"p_mGeStructure",displayValues:!0,valueList:{orValues:[{name:"Мах",value:"S"},{name:"Мах, ретракция",value:"S R"},{name:"Подготовка, мах",value:"P S"},{name:"Подготовка, мах, ретракция",value:"P S R"},{name:"Подготовка-мах",value:"P-S"},{name:"Подготовка-мах, ретракция",value:"P-S R"},{name:"Другой вариант",editable:!0}]},validChars:["P","R","S","-"," "],substitute:[[/[sыЫ]/g,"S"],[/[pрРзЗ]/g,"P"],[/[rкК]/g,"R"],[/\s+/g," "],[/\s*[-_]\s*/g,"-"]]},{type:"list",name:"Функциональный тип",id:"p_mGeFunction",valueList:{orValues:[{name:"Изобразительный жест",value:"Depictive"},{name:"Указательный жест",value:"Pointing"},{name:"Жестовое ударение",value:"Beat"},{name:"Другое",value:"Other"},{name:"Прагматический / метафорический жест",value:"Pragmatic"}]}},{type:"list",name:"Дополнительные признаки",id:"p_mGeTags",valueList:{orValues:[{name:"Двуручный жест («туда-обратно»)",value:"Shuttle"},{name:"Жест с многократным махом",value:"Multi-S"},{name:"Отскок в конце маха",value:"S Rebound"},{name:"Отскок в конце ретракции",value:"R Rebound"},{name:"Многократный отскок в конце маха",value:"Multi Rebound"},{name:"Длинная ретракция",value:"Long R"},{name:"Наложение на текущий жест фазы другого жеста",value:"(Lt|Rt) [PSHR] Overlap"},{name:"Повтор предыдущего жеста",value:"Repeat"},{name:"Обрыв в основном сформированного жеста",value:"GeBreakOff"},{name:"Обрыв жеста без маховой фазы",value:"GeFalstart"}]}}])};function Pe(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0;i<t.length-1;i++){var a=t[i];if(a||0===a)return a}if(t.length>0)return t.slice(-1)[0]}function Ne(e){return[null,void 0,""].indexOf(e)<0}function Se(e,t){return e.replace("##",t.toString())}var Ae=function(){function e(t,i){w(this,e),this.type=t.type,this.unitType=n.observable(i),this.id=t.id,this.name=t.name,this.help=t.help||"",this.value=n.observable(null),this.virtualKeyboard=t.virtualKeyboard||!1,this.validChars=t.validChars,this.validitySusbstitutions=this.getValueSubstitutions(t)}return _(e,[{key:"changeUnitType",value:function(e){this.unitType(e)}},{key:"getValueSubstitutions",value:function(e){var t=[];if(e.substitute&&e.substitute.length&&(t=e.substitute),e.validChars&&e.validChars.length){var n="[^".concat(e.validChars.join("").replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"),"]");t.push([new RegExp(n,"g"),""])}return t}},{key:"makeValueValid",value:function(e){for(var t=0;t<this.validitySusbstitutions.length;t++){var n=E(this.validitySusbstitutions[t],2),i=n[0],a=n[1];e=e.replace(i,a)}return e}},{key:"insertText",value:function(e,n,i){return n=t(n).parents(".bmpp-valueList","li").find('input[type="text"]').get(0),function(){var t=n.selectionStart||0;i(i().slice(0,t)+e+i().slice(t)),t+=e.length,n.selectionStart=t,n.selectionEnd=t,n.focus()}}},{key:"onHeaderClick",value:function(){}},{key:"getJsonProperties",value:function(){return n.computed(function(){var e=this.value(),t=[];return Ne(e)&&t.push({prop:this.id,value:e}),t},this)}},{key:"getBanner",value:function(){return""}},{key:"isHeaderClickable",get:function(){return!1}}],[{key:"createByType",value:function(e,t){var n={interval:Ee,text:Le,list:Ve}[e.type];if(n)return new n(e,t)}}]),e}(),Ee=function(e){function t(e,i){var a;return w(this,t),(a=S(this,C(t).call(this,e,i))).from=n.observable(null),a.to=n.observable(null),a.units=e.units||"",a.from.min=Pe(e.fromMin,e.min,0),a.from.max=Pe(e.fromMax,e.max,null),a.from.step=e.fromStep||e.step||1,a.from.placeholder=e.fromPlaceholder||"",a.from.label=e.fromLabel||"от",a.from.banner=e.fromBanner||"от ##",a.from.onlyBanner=e.fromOnlyBanner||a.from.banner,a.to.min=Pe(e.toMin,e.min,0),a.to.max=Pe(e.toMax,e.max,null),a.to.step=e.toStep||e.step||1,a.to.placeholder=e.toPlaceholder||"",a.to.label=e.toLabel||"до",a.to.banner=e.toBanner||"до ##",a.to.onlyBanner=e.toOnlyBanner||a.to.banner,a.fromToBanner=e.fromToBanner||"".concat(a.from.banner," ").concat(a.to.banner),a.fromToEqualBanner=e.fromToEqualBanner||"##",a.unitsBanner=e.unitsBanner||e.units||"",a.tune(e),a}return T(t,Ae),_(t,[{key:"tune",value:function(e){this.validitySusbstitutions=this.getValueSubstitutions(e),this.tuneValue(),this.jsonProperties=this.getJsonProperties(),this.banner=this.getBanner()}},{key:"tuneValue",value:function(){n.computed(function(){var e=this.from(),t=this.to.peek();Ne(e)&&Ne(t)&&e>t&&this.from(t)},this),n.computed(function(){var e=this.from.peek(),t=this.to();Ne(e)&&Ne(t)&&t<e&&this.to(e)},this),n.computed(function(){var e=this.from(),t=this.to(),n={};Ne(e)||Ne(t)?(Ne(e)&&(n.min=e),Ne(t)&&(n.max=t),this.value(n)):this.value(null)},this)}},{key:"getJsonProperties",value:function(){return n.computed(function(){var e=this.value(),t=[];return Ne(e)&&(Ne(e.min)&&t.push({prop:"".concat(this.id,"_min"),value:e.min}),Ne(e.max)&&t.push({prop:"".concat(this.id,"_max"),value:e.max})),t},this)}},{key:"getValueSubstitutions",value:function(e){var n=A(C(t.prototype),"getValueSubstitutions",this).call(this,e);return n.push([/[^\d]/g,""]),n}},{key:"getBanner",value:function(){return n.computed(function(){var e=this.from(),t=this.to(),n="";return Ne(e)&&Ne(t)&&(n=e===t?Se(this.fromToEqualBanner,e):Se(Se(this.fromToBanner,e),t)),Ne(e)&&!Ne(t)&&(n=Se(this.from.onlyBanner,e)),!Ne(e)&&Ne(t)&&(n=Se(this.to.onlyBanner,t)),n&&this.unitsBanner&&(n+=" "+this.unitsBanner),n},this)}}]),t}(),Le=function(e){function t(e,n){var i;return w(this,t),(i=S(this,C(t).call(this,e,n))).placeholder=e.placeholder||"",i.tune(),i}return T(t,Ae),_(t,[{key:"tune",value:function(){this.jsonProperties=this.getJsonProperties(),this.banner=this.getBanner()}},{key:"getBanner",value:function(){return n.computed(function(){var e=this.value();return Ne(e)?"«".concat(e,"»"):""},this)}}]),t}();function Oe(e,t){var i=n.unwrap(e.value);return i instanceof Array?t=(t=t.filter(function(e){return i.indexOf(e)<0})).concat(i):Ne(i)&&(t=t.filter(function(e){return e!==i})).push(i),t}var Ve=function(e){function t(e,i){var a;return w(this,t),(a=S(this,C(t).call(this,e,i))).displayValues=e.displayValues||!1,a.chosenValues=n.observableArray([]),a.valueList=new Ie(e.valueList,null,N(N(a))),a.tune(),a}return T(t,Ae),_(t,[{key:"tune",value:function(){this.tuneValue(),this.jsonProperties=this.getJsonProperties(),this.banner=this.getBanner()}},{key:"tuneValue",value:function(){n.computed(function(){var e=this.value,t=this.unwrapValues(this.chosenValues());if(t.length>0)if(this.valueList.isXOR&&1===t.length&&this.valueList.items.some(function(e){return e===t[0]})){var n=[];1===(n=Oe(t[0],n)).length?e(n[0]):e(n)}else{var i=[];t.map(function(e){i=Oe(e,i)}),e(i)}else e(null)},this)}},{key:"unwrapValues",value:function(e){return e.map(function(e){return n.isObservable(e)?e():e})}},{key:"onHeaderClick",value:function(){var e=this.valueList;this._lastActiveDepth=-1,this.isHeaderClickable&&(e.isOR?e.invertSelection():e.isXOR&&e.rotateSelection())}},{key:"getBanner",value:function(){return n.computed(function(){return this.chosenValues().map(function(e){for(var t="",n=e.list.depth>0&&e.list.parentItem;n&&n.addNameToChildNames;)t=n.name.slice(0,1).toLowerCase()+n.name.slice(1)+" "+t,n=n.list.depth>0&&n.list.parentItem;return t+(e.editable?"«".concat(e.value(),"»"):e.name.slice(0,1).toLowerCase()+e.name.slice(1))}).join("; ")},this)}},{key:"isHeaderClickable",get:function(){return this.valueList.hasNoChildList}}]),t}(),Ie=function(){function e(t,n,i){var a=this;w(this,e),this.depth=null===n?0:n.list.depth+1,this.isOR=!t.xorValues,this.isXOR=!t.orValues,this.parentItem=n,this.listProperty=i,this.items=(this.isOR?t.orValues:t.xorValues).map(function(e){return new Fe(e,a)})}return _(e,[{key:"checkAll",value:function(){this.items.forEach(function(e){var t=e.childList;e.checked(!0),t&&t.isOR?t.checkAll():t&&t.isXOR&&t.checkFirst()})}},{key:"checkFirst",value:function(){var e=this.items[0],t=e.childList;e.checked(!0),t&&t.isOR?t.checkAll():t&&t.isXOR&&t.checkFirst()}},{key:"uncheckAll",value:function(){this.items.forEach(function(e){e.checked(!1),e.childList&&e.childList.uncheckAll()})}},{key:"uncheckAllBut",value:function(e){this.items.forEach(function(t){t!==e&&t.checked(!1)})}},{key:"invertSelection",value:function(){this.items.forEach(function(e){e.checked(!e.checked())})}},{key:"rotateSelection",value:function(){var e=!1,t=!1;this.items.forEach(function(n){n.checked()?(e=!0,n.checked(!1)):e&&!t&&(n.checked(!0),t=!0)}),e||this.items[0].checked(!0)}},{key:"hasNoChildList",get:function(){return this.items.every(function(e){return!e.childList})}}]),e}();function Re(e,t,n){var i=e.getListItemOnDepth(n),a=t.getListItemOnDepth(n),s=i.list.items.indexOf(i),r=a.list.items.indexOf(a);return s<r?-1:s>r?1:0}function Me(e,t){for(var n=0,i=Re(e,t,n);0===i||e.list.depth<n&&t.list.depth<n;)i=Re(e,t,n+=1);return i}var Fe=function(){function e(t,i){w(this,e),this.list=i,this.name=t.name,this.checked=n.observable(null),this.userChecked=this.getUserChecked(),this.editable=t.editable||!1,this.disabledInChannels=t.disabledInChannels,this.disabled=this.getDisabledInfo(),this.value=this.editable?this.getValidatingValue():t.value,this.childList=t.orValues||t.xorValues?new Ie(t,this,i.listProperty):null,this.addNameToChildNames=t.addNameToChildNames||!1,this.tuneXOR(),this.tuneParentList(),this.tuneChildList(),this.tuneEditable(),this.tuneCumulativeValue()}return _(e,[{key:"getDisabledInfo",value:function(){var e=this.disabledInChannels;return!!(e&&e.length>0)&&n.computed(function(){var t=this.list.listProperty.unitType().channel.id;return e.indexOf(t)>-1},this)}},{key:"getUserChecked",value:function(){return n.computed({read:this.checked,write:function(e){this.list.listProperty._lastActiveDepth=this.list.depth,this.checked(e)}},this)}},{key:"getValidatingValue",value:function(){var e=n.observable("");return n.computed({read:e,write:function(t){var n=e(),i=this.list.listProperty.makeValueValid(t);i!==n?e(i):t!==n&&e.notifySubscribers(i)}},this).extend({notify:"always"})}},{key:"tuneXOR",value:function(){this.list.isXOR&&n.computed(function(){this.checked()&&this.list.uncheckAllBut(this)},this)}},{key:"tuneParentList",value:function(){this.list.depth>0&&n.computed(function(){var e=this.checked(),t=this.list,n=t.parentItem;this.isChangeStraightforward&&(e&&!n.checked.peek()?n.checked(!0):!e&&n.checked.peek()&&t.items.every(function(e){return!e.checked.peek()})&&n.checked(!1))},this)}},{key:"tuneChildList",value:function(){this.childList&&n.computed(function(){var e=this.checked(),t=this.childList;this.isChangeStraightforward&&(e&&t.isOR?t.checkAll():e&&t.isXOR?t.checkFirst():e||t.uncheckAll())},this)}},{key:"tuneEditable",value:function(){this.editable&&(n.computed(function(){this.checked(!!this.value())},this),n.computed(function(){this.checked()&&!this.value.peek()&&(this.isChangeStraightforward&&t(this.userChecked.checkboxComponent).siblings(".ui.input").first().find('input[type="text"]').focus(),this.checked(!1))},this))}},{key:"tuneCumulativeValue",value:function(){n.computed(function(){var e=this.list.listProperty.chosenValues,t=this.disabled,i=this.checked();t=n.isObservable(t)?t():t,Ne(this.value)&&(e.remove(this),i&&!t&&(e.push(this),e.sort(Me)))},this)}},{key:"getListItemOnDepth",value:function(e){return e===this.list.depth?this:this.list.parentItem.getListItemOnDepth(e)}},{key:"isChangeStraightforward",get:function(){return this.list.listProperty._lastActiveDepth===this.list.depth}}]),e}(),qe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];w(this,e),this.parentNode=t,this.childNodes=n.observableArray([]),this.relationsToParentNode=n.observableArray([]),this.depth=n.observable(t&&t.depth()+1||0),this.level=n.observable(0),this.serialNumber=n.observable(0),this.negative=n.observable(i),this.unitType=n.observable(null),this.unitProperties=n.observableArray([]),this.isEditStateForUnitType=n.observable(!0),this.tuneRelations(),this.tuneUnitProperties()}return _(e,[{key:"tuneRelations",value:function(){null!==this.parentNode&&this.addRelation()}},{key:"tuneUnitProperties",value:function(){var e=this,t=this.unitProperties;this.unitType.subscribe(function(e){null===e&&t([]);for(var n=t(),i=[],a=Ce[e.id]||Te,s=function(t){var s=a[t],r=n.find(function(e){return e.id===s.id});if(r)r.changeUnitType(e),i.push(r);else{var o=Ae.createByType(s,e);i.push(o)}},r=0;r<a.length;r++)s(r);t(i)}),this.chosenUnitProperties=n.computed(function(){return e.unitProperties().filter(function(e){return n.unwrap(e.banner)})})}},{key:"addChild",value:function(){var t=new e(this,arguments.length>0&&void 0!==arguments[0]&&arguments[0]);this.childNodes.push(t)}},{key:"addRelation",value:function(){this.relationsToParentNode.push(new De(this.parentNode,this))}},{key:"removeRelation",value:function(e){this.relationsToParentNode.remove(e)}},{key:"seppuku",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,a=this.childNodes()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){i.value.seppuku()}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}this.relationsToParentNode.removeAll(),this.childNodes.removeAll(),this.parentNode.childNodes.remove(this)}}]),e}(),De=function e(t,n){w(this,e),this.parentNode=t,this.childNode=n};var Be=[{id:"pears04",label:"Pears 04",query:"04"},{id:"pears22",label:"Pears 22",query:"22"},{id:"pears23",label:"Pears 23",query:"23"},{id:"pears35",label:"Pears 35",query:"35"},{id:"pears37",label:"Pears 37",query:"37",disabled:!0},{id:"pears39",label:"Pears 39",query:"39",disabled:!0}],Ue=[{id:"narration",label:"Рассказ",query:"telling"},{id:"dialogue",label:"Разговор",query:"talk"},{id:"retelling",label:"Пересказ",query:"retelling"}],He=function e(t,i){w(this,e),this.value=n.observable(!1),this.id=t.id,this.label=t.label,this.disabled=Boolean(t.disabled),this.query=t.query,this.value.subscribe(function(){i(!0)})},je=function(){function e(t,n){w(this,e);var i=this;this.fields=[];var a=!0,s=!1,r=void 0;try{for(var o,l=t[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var c=o.value;this.fields.push(new He(c,n))}}catch(e){s=!0,r=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw r}}this.invertSelection=function(){var e=!0,t=!1,n=void 0;try{for(var a,s=i.fields[Symbol.iterator]();!(e=(a=s.next()).done);e=!0){var r=a.value;r.disabled||r.value(!r.value())}}catch(e){t=!0,n=e}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}},this.clearSelection=function(){var e=!0,t=!1,n=void 0;try{for(var a,s=i.fields[Symbol.iterator]();!(e=(a=s.next()).done);e=!0){var r=a.value;r.disabled||r.value(!1)}}catch(e){t=!0,n=e}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}}}return _(e,[{key:"getAllButDisabledQueryValues",value:function(){var e=[],t=!0,n=!1,i=void 0;try{for(var a,s=this.fields[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var r=a.value;r.disabled||e.push(r.query)}}catch(e){n=!0,i=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw i}}return e}},{key:"getAllCheckedQueryValues",value:function(){var e=[],t=!0,n=!1,i=void 0;try{for(var a,s=this.fields[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var r=a.value;!r.disabled&&r.value()&&e.push(r.query)}}catch(e){n=!0,i=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw i}}return e}},{key:"getQueryValuesForJSON",value:function(){return this.areAllUnchecked?this.getAllButDisabledQueryValues():this.getAllCheckedQueryValues()}},{key:"areAllChecked",get:function(){return this.fields.every(function(e){return e.disabled||e.value()})}},{key:"areAllUnchecked",get:function(){return this.fields.every(function(e){return e.disabled||!e.value()})}}]),e}(),$e={version:"test",subcorpus:"запись 04; этап Рассказ",query:"ЭДЕ, со следующими свойствами: участники: рассказчик; иллокутивно-фазовое значение: неполнота информации в контексте незавершенности; движение тона в главном акценте: восходяще-ровное.",results:[{record_id:"pears04-mult-voc-manu.eaf",participant:"N",time:{begin:6010,end:8490,before_begin:5250,after_end:8590},value:"N-vE005",value_transcription:"(ˀ 0.06) (ɐ 0.53) Мы видим˗м сельский /–пейз<u>а</u>ж,,,",before_context:"N-vN001",before_context_transcription:"(ɥ 0.76)",after_context:"pN-004",after_context_transcription:"(0.10)"},{record_id:"pears04-mult-voc-manu.eaf",participant:"N",time:{begin:8590,end:9490,before_begin:8490,after_end:1e4},value:"N-vE006",value_transcription:"сельская /–м<u>е</u>стность,,,",before_context:"pN-004",before_context_transcription:"(0.10)",after_context:"N-vE007",after_context_transcription:"/–дор<u>о</u>га,,,"},{record_id:"pears04-mult-voc-manu.eaf",participant:"N",time:{begin:9490,end:1e4,before_begin:8590,after_end:10880},value:"N-vE007",value_transcription:"/–дор<u>о</u>га,,,",before_context:"N-vE006",before_context_transcription:"сельская /–м<u>е</u>стность,,,",after_context:"N-vE008",after_context_transcription:"–↑дер<u>е</u>вья<sup>ɯ</sup>, ≈≈"},{record_id:"pears04-mult-voc-manu.eaf",participant:"N",time:{begin:22700,end:23700,before_begin:21180,after_end:24690},value:"N-vE014",value_transcription:"такой /–т<u>о</u>лстый,,,",before_context:"N-vE013",before_context_transcription:"Похож на Дмитрия \\Б<u>ы</u>кова чуть-чуть,",after_context:"N-vE015",after_context_transcription:"/–краснол<u>и</u>цый,,,"},{record_id:"pears04-mult-voc-manu.eaf",participant:"N",time:{begin:23700,end:24690,before_begin:22700,after_end:24880},value:"N-vE015",value_transcription:"/–краснол<u>и</u>цый,,,",before_context:"N-vE014",before_context_transcription:"такой /–т<u>о</u>лстый,,,",after_context:"pN-008",after_context_transcription:"(0.19)"},{record_id:"pears04-mult-voc-manu.eaf",participant:"N",time:{begin:24880,end:25640,before_begin:24690,after_end:28380},value:"N-vE016",value_transcription:"в /–ф<u>а˗а</u>ртуке,,,",before_context:"pN-008",before_context_transcription:"(0.19)",after_context:"N-vE017",after_context_transcription:"у него (ɥ 0.29) на шее красный \\плат<u>о</u>к ↑завязан,"},{record_id:"pears04-mult-voc-manu.eaf",participant:"N",time:{begin:32360,end:33110,before_begin:30800,after_end:35100},value:"N-vE020",value_transcription:"/→зел<u>ё</u>ные,,,",before_context:"N-vE019",before_context_transcription:"\\груши˗и<sup>ə</sup> (ə 0.10) (ˀ 0.10) /больш<u>и</u>е,",after_context:"N-vE021",after_context_transcription:"на /вид совершенно \\твердок<u>а</u>менные<sup>ɯ</sup>."},{record_id:"pears04-mult-voc-manu.eaf",participant:"N",time:{begin:53370,end:54550,before_begin:52790,after_end:54910},value:"N-vE028",value_transcription:"он <em>заполняет</em> /ещ<u>ё</u> →одну,,,",before_context:"pN-012",before_context_transcription:"(0.57)",after_context:"N-vN010",after_context_transcription:"(ɥ 0.36)"},{record_id:"pears04-mult-voc-manu.eaf",participant:"N",time:{begin:181950,end:183520,before_begin:180620,after_end:183960},value:"N-vE107",value_transcription:"велосипедом его /→придав<u>и</u>ло,,,",before_context:"N-vE106",before_context_transcription:"{sw 0.15} (ɐ 0.36) он /\\леж<u>и˗и</u>т<sup>ə</sup>,,,",after_context:"N-vN029",after_context_transcription:"(ɥ 0.15) {sm 0.28}"},{record_id:"pears04-mult-voc-manu.eaf",participant:"N",time:{begin:186460,end:187410,before_begin:184270,after_end:188170},value:"N-vE109",value_transcription:"потирает /→кол<u>ен</u>ку,,,",before_context:"N-vE108",before_context_transcription:"(ə 0.63) он (ɯ 0.31) &lt;п=&gt; || /↓сад<u>и</u>тся˗а,,,",after_context:"N-vE110",after_context_transcription:"там смотрит =="},{record_id:"pears04-mult-voc-manu.eaf",participant:"N",time:{begin:265920,end:267310,before_begin:265280,after_end:267480},value:"N-vE159",value_transcription:"(ɐ 0.25) отдаёт ему /–шл<u>я</u>пу,,,",before_context:"N-vE158",before_context_transcription:"— /–ид<u>ё</u>т,",after_context:"pN-060",after_context_transcription:"(0.17)"},{record_id:"pears04-mult-voc-manu.eaf",participant:"N",time:{begin:281930,end:283890,before_begin:281500,after_end:284240},value:"N-vE169",value_transcription:"(ɐ 0.13) \\вытирает (ɐ 0.49) о /–себ<u>я˗а</u>,,,",before_context:"N-vN042",before_context_transcription:"(ɥ 0.43)",after_context:"pN-064",after_context_transcription:"(0.34)"},{record_id:"pears04-mult-voc-manu.eaf",participant:"N",time:{begin:310320,end:312480,before_begin:309860,after_end:314110},value:"N-vE184",value_transcription:"так спокойно мимо него /–прох<u>о</u>дят вразвалочку,,,",before_context:"pN-070",before_context_transcription:"(0.47)",after_context:"N-vE185",after_context_transcription:"и /он в недоумении на них /–см<u>о</u>трит,"}]},ze="http://multidiscourse.ru:8080/search_annotations/SearchAnnotations";m("Search Engine:",ze);var We=new function(){var e=this,i=this;this.queryPane=Symbol.for("query"),this.subcorpusPane=Symbol.for("subcorpus"),this.resultsPane=Symbol.for("results"),this.resultsOptionsPane=Symbol.for("resoptions"),this.panes=[this.queryPane,this.subcorpusPane,this.resultsPane,this.resultsOptionsPane],this.activePane=n.observable(),this.switchOnQueryPane=function(){i.activePane(i.queryPane)},this.switchOnSubcorpusPane=function(){i.activePane(i.subcorpusPane)},this.switchOnResultsPane=function(){i.activePane(i.resultsPane)},this.switchOnResultsOptionsPane=function(){i.activePane(i.resultsOptionsPane)},this.isQueryPaneOn=n.computed(function(){return e.activePane()===i.queryPane}),this.isSubcorpusPaneOn=n.computed(function(){return e.activePane()===i.subcorpusPane}),this.isResultsPaneOn=n.computed(function(){return e.activePane()===i.resultsPane}),this.isResultsOptionsPaneOn=n.computed(function(){return e.activePane()===i.resultsOptionsPane}),n.computed(function(){var e=i.activePane();e&&(f("/".concat(Symbol.keyFor(e))),H.pauseAll())}),this.queryPaneView=n.observable(null),this.queryPaneView.isTreeVisible=n.computed(function(){return null===i.queryPaneView()}),this.queryPaneView.editNodeProperties=function(e){i.queryPaneView(e)},this.queryPaneView.finishEditingNodeProperties=function(){i.queryPaneView(null)},this.queryPaneView.arePropertiesVisible=n.computed(function(){return i.queryPaneView()instanceof qe}),this.queryPaneView.propertiesNode=n.computed(function(){if(i.queryPaneView.arePropertiesVisible())return i.queryPaneView.peek()}),this.queryPartsNonReadiness=n.observableArray([this.queryPaneView.arePropertiesVisible]),this.isQueryReady=n.computed(function(){var e=!0,t=!1,n=void 0;try{for(var a,s=i.queryPartsNonReadiness()[Symbol.iterator]();!(e=(a=s.next()).done);e=!0)if((0,a.value)())return!1}catch(e){t=!0,n=e}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}return!(!i.queryTree||!i.queryTree.unitType())}).extend({rateLimit:50}),this.isQueryNew=n.observable(!0),this.isSubcorpusNew=n.observable(!1),this.resultsRawData=n.observable(null),this.subcorpus={records:new je(Be,this.isSubcorpusNew),recordPhases:new je(Ue,this.isSubcorpusNew)},this.subcorpusBanner=n.computed(function(){var e,t=i.subcorpus.records,n=i.subcorpus.recordPhases;if(i.resultsRawData()&&"test"===i.resultsRawData().version)return i.resultsRawData().subcorpus;if(t.areAllUnchecked||t.areAllChecked)e="все записи; ";else{var a=t.fields.filter(function(e){return!e.disabled&&e.value()}).map(function(e){return e.query});e=1===a.length?"запись ".concat(a[0],"; "):"записи ".concat(a.join(", "),"; ")}if(n.areAllUnchecked||n.areAllChecked)e+="все этапы.";else{var s=n.fields.filter(function(e){return!e.disabled&&e.value()}).map(function(e){return e.label});1===s.length?e+="этап ".concat(s[0],"."):e+="этапы ".concat(s.join(", "),".")}return e},this),this.queryTree=new qe,this.canSearch=n.computed(function(){var e=i.isQueryReady(),t=i.isQueryNew(),n=i.isSubcorpusNew();return!(!e||!t&&!n)}),this.lastQueryJSON="",this.queryJSON=n.computed(function(){return i.canSearch()&&(i.lastQueryJSON=function(e){for(var t={version:"1.0",record_ids:e.subcorpus.records.getQueryValuesForJSON(),segments:e.subcorpus.recordPhases.getQueryValuesForJSON(),conditions:{}},n=M(e.queryTree),i=0;i<n.length;i++){var a=n[i],s=a.unitType().tiers,r={type:"simple",is_regex:!0,search:".+"},o=s&&s.length>0?s:["-vSForm"];if(o=o.map(function(e){return["N"+e,"R"+e,"C"+e]}).reduce(function(e,t){return e.concat(t)}),r.tiers=o,t.conditions[a.serialNumber().toString()]=r,i>0){var l=a.parentNode,c=a,u=l.serialNumber().toString(),d=c.serialNumber().toString(),p={first_condition_id:u,second_condition_id:d,is_same_tier:l.unitType().channel.id===c.unitType().channel.id,type:"overlaps"};t.conditions["".concat(u,".").concat(d)]=p}}return JSON.stringify(t,null,4)}(i)),i.lastQueryJSON}).extend({rateLimit:500}),this.search=function(){i.canSearch()&&(i.isSearchInProgress(!0),t.ajax(ze,{data:{data:i.queryJSON()}}).done(function(e){i.isQueryNew(!1),i.isSubcorpusNew(!1),i.resultsRawData(e),i.resultsError(null)}).fail(function(e,t,n){i.resultsRawData($e),i.resultsError("Ошибка: ".concat(t,' "').concat(n,'"'))}).always(function(){i.isSearchInProgress(!1),i.canViewResults(!0),i.switchOnResultsPane()}))},this.isSearchInProgress=n.observable(!1),this.canViewResults=n.observable(!1),this.resultsError=n.observable(null),this.resultsNumber=n.computed(function(){var e=i.resultsRawData();return e&&e.results instanceof Array?e.results.length:null}),this.responseJSON=n.computed(function(){return i.resultsRawData()?JSON.stringify(i.resultsRawData(),null,4):""})};!function(e,n){e.bindingHandlers.popup={init:function(n,i,a){var s=e.unwrap(i()),r=a.get("popupOpts")||{};r.html=s,t(n).popup(r),e.unwrap(a.get("popupAdditionalShowOnClick"))&&t(n).click(function(){t(n).popup("show")})}},e.bindingHandlers.inlinePopup={init:function(n,i){var a=e.unwrap(i())||{inline:!0};t(n).popup(a)}},e.bindingHandlers.textLowercaseFirstChar={update:function(n,i){var a=e.unwrap(i());t(n).text(a.slice(0,1).toLowerCase()+a.slice(1))}},e.components.register("text-property",ue),e.components.register("interval-property",g),e.components.register("bmpp-value-list",de),e.components.register("list-property",y),e.components.register("search-unit-property",le),e.components.register("properties-pane",k),e.components.register("bmpp-checkbox",v),e.components.register("query-pane",F),e.components.register("subcorpus-pane",ce),e.components.register("query-node",I),e.components.register("query-node-relations",R),e.components.register("search-unit-choice",oe),e.components.register("results-list",j),e.components.register("results-pane",J),e.applyBindings(n)}(n,We);var Ge=Symbol.keyFor(We.queryPane),Je=Symbol.keyFor(We.subcorpusPane),Qe=Symbol.keyFor(We.resultsPane),Ke=Symbol.keyFor(We.resultsOptionsPane);f.base("/bumppo-ghpages/08"),f("/",function(){We.activePane(We.queryPane)}),f("/".concat(Ge),function(){We.activePane(We.queryPane)}),f("/".concat(Je),function(){We.activePane(We.subcorpusPane)}),f("/".concat(Qe),function(){We.canViewResults()?We.activePane(We.resultsPane):We.activePane(We.queryPane)}),f("/".concat(Ke),function(){We.activePane(We.resultsOptionsPane)}),f({hashbang:!0}),t(".bmpp-sidePane_menuItem").mouseover(function(){t(this).hasClass("disabled")||t(this).addClass("bmpp-sidePane_menuItem--hover")}),t(".bmpp-sidePane_menuItem").mouseout(function(){t(this).removeClass("bmpp-sidePane_menuItem--hover")}),t("#safetyCurtain").fadeOut()}(SVG,jQuery,ko);
//# sourceMappingURL=spa.js.map
